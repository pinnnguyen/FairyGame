import{e as ee,s as A,i as z,x as te,o as a,c as i,z as E,d as D,_ as F,u as e,A as h,l as se,B as t,t as ne,C as o,Q as ae,D as oe,E as le,F as re}from"./entry.e04b7afd.js";import{u as S,B as ie,T as ce,_ as de,a as me,b as _e,c as ue}from"./useBattleRound.23cb2bea.js";import{_ as fe}from"./ButtonCancel.116b3a26.js";import{_ as pe}from"./ButtonConfirm.70ea9dbb.js";import{_ as ye}from"./index.cdedaa16.js";import{s as ve}from"./useMessage.c0dcb7e6.js";import{u as V}from"./usePlayer.703c932a.js";import{u as he}from"./useSocket.cfb86e86.js";const xe=D(()=>F(()=>import("./battle-result.3d357447.js"),["./battle-result.3d357447.js","./entry.e04b7afd.js","./entry.da1dee1c.css","./ButtonConfirm.70ea9dbb.js","./ButtonCancel.116b3a26.js","./index.cdedaa16.js","./usePlayer.703c932a.js","./useBattleRound.23cb2bea.js"],import.meta.url).then(l=>l.default||l)),be=D(()=>F(()=>import("./refresh-mid.39719989.js"),["./refresh-mid.39719989.js","./index.cdedaa16.js","./entry.e04b7afd.js","./entry.da1dee1c.css","./usePlayer.703c932a.js"],import.meta.url).then(l=>l.default||l)),Ee={key:2,class:"h-screen bg-white"},ge={class:"h-[40%] bg-bg_pve bg-cover"},Be={class:"text-center pt-2 text-base font-semibold flex items-center justify-center"},Ce={class:"flex justify-between p-2 pt-2"},ke={class:"flex items-center justify-start"},we={class:"flex items-center justify-end"},Re={class:"flex justify-around mt-8"},Te={class:"p-4 h-[25%] overflow-scroll"},$e={class:"flex items-center flex-col justify-center fixed w-full bottom-2"},Pe={class:"flex items-center"},Ie=t("span",{class:"z-9 text-10"}," V\u1EC1 th\xE0nh ",-1),je=t("span",{class:"z-9 text-10"}," \u1EA2i ti\u1EBFp ",-1),Le=ee({__name:"index",setup(l){const{loading:d,state:n,receiver:g,playerEffect:B,realTime:C,battleRounds:M,battleResult:x,inRefresh:N,refreshTime:L,reward:O}=A(S()),{startBattle:H}=S(),{playerInfo:m}=A(V()),{loadPlayer:G}=V(),{_socket:b}=he(),_=z(!1),u=z(!1);te(()=>{var r,s,f,p,c;console.log("battle mounted"),b.emit("battle:join",`${(r=m.value)==null?void 0:r._id}-battle-pve`,{kind:ie.PVE,player:{userId:(s=m.value)==null?void 0:s.userId},target:{type:ce.MONSTER,id:(c=(p=(f=m.value)==null?void 0:f.mid)==null?void 0:p.current)==null?void 0:c.monsterId}}),b.on("battle:start",async y=>{await H(y)})});const k=()=>{b.emit("battle:refresh")},K=async()=>{try{d.value=!0;const r=await $fetch("/api/mid/set",{method:"POST"});G(r),d.value=!1}catch{ve("H\xE3y v\u01B0\u1EE3t \u1EA3i tr\u01B0\u1EDBc \u0111\xF3 \u0111\u1EC3 ti\u1EBFp t\u1EE5c"),d.value=!1}},Q=()=>{x.value.show=!1,k()};return(r,s)=>{const f=xe,p=le,c=re,y=de,Y=me,q=_e,J=ue,U=be,W=fe,X=pe,Z=ye;return a(),i(Z,null,{default:E(()=>{var w,R,T,$,P,I,j;return[e(x).show?(a(),i(f,{key:0,"battle-result":e(x),reward:e(O),onClose:Q},null,8,["battle-result","reward"])):h("",!0),e(d)?(a(),i(p,{key:1})):(a(),se("div",Ee,[t("div",ge,[t("div",Be," ["+ne((T=(R=(w=e(m))==null?void 0:w.mid)==null?void 0:R.current)==null?void 0:T.name)+"] ",1),t("div",Ce,[t("div",null,[t("div",ke,[t("div",{class:"flex items-center",onClick:s[0]||(s[0]=v=>_.value=!e(_))},[o(c,{format:"webp",class:"h-[35px] border border-[#d0d0d0] bg-[#d0d0d0] rounded-full",src:"/pve/player-avatar.png"})])]),e(_)?(a(),i(y,{key:0,name:e(n).player.name,hp:e(n).player.hp,damage:e(n).player.damage,def:e(n).player.def,onClose:s[1]||(s[1]=v=>_.value=!1)},null,8,["name","hp","damage","def"])):h("",!0)]),t("div",null,[t("div",we,[t("div",{class:"flex justify-end",onClick:s[2]||(s[2]=v=>u.value=!e(u))},[o(c,{format:"webp",class:"h-[35px] bg-black border border-[#d0d0d0] bg-[#d0d0d0] rounded-full",src:"/pve/monter-avatar.png"})])]),e(u)?(a(),i(y,{key:0,name:($=e(n).enemy)==null?void 0:$.name,hp:(P=e(n).enemy)==null?void 0:P.hp,damage:(I=e(n).enemy)==null?void 0:I.damage,def:(j=e(n).enemy)==null?void 0:j.def,onClose:s[3]||(s[3]=v=>u.value=!1)},null,8,["name","hp","damage","def"])):h("",!0)])]),t("div",Re,[o(Y,{"player-effect":e(B),state:e(n),receiver:e(g),"real-time":e(C)},null,8,["player-effect","state","receiver","real-time"]),o(q,{"player-effect":e(B),state:e(n),receiver:e(g),"real-time":e(C)},null,8,["player-effect","state","receiver","real-time"])])]),t("div",Te,[o(J,{"battle-rounds":e(M)},null,8,["battle-rounds"])]),t("div",$e,[e(N)?(a(),i(U,{key:0,"refresh-time":e(L),onRefreshFinished:k},null,8,["refresh-time"])):h("",!0),t("div",Pe,[o(W,{class:"mx-2","class-name":"h-[23px]",onClick:s[4]||(s[4]=ae(v=>e(oe)("/"),["stop"]))},{default:E(()=>[Ie]),_:1}),o(X,{class:"mx-2",onClick:K},{default:E(()=>[je]),_:1})])])]))]}),_:1})}}});export{Le as default};
