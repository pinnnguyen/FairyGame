import{e as ae,s as M,i as N,x as oe,o as a,c as i,z as E,d as L,_ as O,u as e,A as h,l as le,B as t,t as re,C as o,G as ie,H as ce,I as de,J as _e}from"./entry.5e8a55ee.js";import{u as D,B as me,T as ue,_ as fe,a as pe,b as ye,c as ve,d as he}from"./useBattleRound.9c8c5cd4.js";import{_ as xe}from"./ButtonConfirm.ef25d3da.js";import{_ as be}from"./index.ef37a08c.js";import{s as Ee}from"./useMessage.232be54a.js";import{u as F}from"./usePlayer.4510c797.js";import{u as ge}from"./useSocket.c2536292.js";const Be=L(()=>O(()=>import("./battle-result.0606d1c5.js"),["./battle-result.0606d1c5.js","./entry.5e8a55ee.js","./entry.1769143d.css","./ButtonConfirm.ef25d3da.js","./useBattleRound.9c8c5cd4.js","./index.ef37a08c.js","./usePlayer.4510c797.js"],import.meta.url).then(l=>l.default||l)),Ce=L(()=>O(()=>import("./refresh-mid.6d9035c2.js"),["./refresh-mid.6d9035c2.js","./index.ef37a08c.js","./entry.5e8a55ee.js","./entry.1769143d.css","./usePlayer.4510c797.js"],import.meta.url).then(l=>l.default||l)),ke={key:2,class:"h-screen bg-white"},we={class:"h-[40%] bg-bg_pve bg-cover"},Re={class:"text-center pt-2 text-base font-semibold flex items-center justify-center"},Te={class:"flex justify-between p-2 pt-2"},$e={class:"flex items-center justify-start"},Ie={class:"flex items-center justify-end"},Pe={class:"flex justify-around mt-8"},je={class:"p-4 h-[25%] overflow-scroll"},Ae={class:"flex items-center flex-col justify-center fixed w-full bottom-2"},ze={class:"flex items-center"},Se=t("span",{class:"z-9 text-10"}," V\u1EC1 th\xE0nh ",-1),Ve=t("span",{class:"z-9 text-10"}," \u1EA2i ti\u1EBFp ",-1),Ge=ae({__name:"index",setup(l){const{loading:d,state:n,receiver:g,playerEffect:B,realTime:C,battleRounds:H,battleResult:x,inRefresh:G,refreshTime:J,reward:K}=M(D()),{startBattle:Y}=D(),{playerInfo:_}=M(F()),{loadPlayer:q}=F(),{_socket:b}=ge(),m=N(!1),u=N(!1);oe(()=>{var r,s,f,p,c;console.log("battle mounted"),b.emit("battle:join",`${(r=_.value)==null?void 0:r._id}-battle-pve`,{kind:me.PVE,player:{userId:(s=_.value)==null?void 0:s.userId},target:{type:ue.MONSTER,id:(c=(p=(f=_.value)==null?void 0:f.mid)==null?void 0:p.current)==null?void 0:c.monsterId}}),b.on("battle:start",async y=>{await Y(y)})});const k=()=>{b.emit("battle:refresh")},Q=async()=>{try{d.value=!0;const r=await $fetch("/api/mid/set",{method:"POST"});q(r),d.value=!1}catch{Ee("H\xE3y v\u01B0\u1EE3t \u1EA3i tr\u01B0\u1EDBc \u0111\xF3 \u0111\u1EC3 ti\u1EBFp t\u1EE5c"),d.value=!1}},U=()=>{x.value.show=!1,k()};return(r,s)=>{const f=Be,p=de,c=_e,y=fe,W=pe,X=ye,Z=ve,ee=Ce,te=he,se=xe,ne=be;return a(),i(ne,null,{default:E(()=>{var w,R,T,$,I,P,j,A,z,S,V;return[e(x).show?(a(),i(f,{key:0,"battle-result":e(x),reward:e(K),onClose:U},null,8,["battle-result","reward"])):h("",!0),e(d)?(a(),i(p,{key:1})):(a(),le("div",ke,[t("div",we,[t("div",Re," ["+re((T=(R=(w=e(_))==null?void 0:w.mid)==null?void 0:R.current)==null?void 0:T.name)+"] ",1),t("div",Te,[t("div",null,[t("div",$e,[t("div",{class:"flex items-center",onClick:s[0]||(s[0]=v=>m.value=!e(m))},[o(c,{format:"webp",class:"h-[35px] border border-[#d0d0d0] bg-[#d0d0d0] rounded-full",src:"/pve/player-avatar.png"})])]),e(m)?(a(),i(y,{key:0,name:($=e(n).player)==null?void 0:$.name,hp:(I=e(n).player)==null?void 0:I.hp,damage:(P=e(n).player)==null?void 0:P.damage,def:(j=e(n).player)==null?void 0:j.def,onClose:s[1]||(s[1]=v=>m.value=!1)},null,8,["name","hp","damage","def"])):h("",!0)]),t("div",null,[t("div",Ie,[t("div",{class:"flex justify-end",onClick:s[2]||(s[2]=v=>u.value=!e(u))},[o(c,{format:"webp",class:"h-[35px] bg-black border border-[#d0d0d0] bg-[#d0d0d0] rounded-full",src:"/pve/monter-avatar.png"})])]),e(u)?(a(),i(y,{key:0,name:(A=e(n).enemy)==null?void 0:A.name,hp:(z=e(n).enemy)==null?void 0:z.hp,damage:(S=e(n).enemy)==null?void 0:S.damage,def:(V=e(n).enemy)==null?void 0:V.def,onClose:s[3]||(s[3]=v=>u.value=!1)},null,8,["name","hp","damage","def"])):h("",!0)])]),t("div",Pe,[o(W,{"player-effect":e(B),state:e(n),receiver:e(g),"real-time":e(C)},null,8,["player-effect","state","receiver","real-time"]),o(X,{"player-effect":e(B),state:e(n),receiver:e(g),"real-time":e(C)},null,8,["player-effect","state","receiver","real-time"])])]),t("div",je,[o(Z,{"battle-rounds":e(H)},null,8,["battle-rounds"])]),t("div",Ae,[e(G)?(a(),i(ee,{key:0,"refresh-time":e(J),onRefreshFinished:k},null,8,["refresh-time"])):h("",!0),t("div",ze,[o(te,{class:"mx-2","class-name":"h-[23px]",onClick:s[4]||(s[4]=ie(v=>e(ce)("/"),["stop"]))},{default:E(()=>[Se]),_:1}),o(se,{class:"mx-2",onClick:Q},{default:E(()=>[Ve]),_:1})])])]))]}),_:1})}}});export{Ge as default};
