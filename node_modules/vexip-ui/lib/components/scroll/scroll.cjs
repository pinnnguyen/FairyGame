"use strict";var r=require("vue");require("../scrollbar/index.cjs");require("../resize-observer/index.cjs");require("../../common/config/src/index.cjs");var b=require("@vexip-ui/utils"),Ce=require("./props.cjs"),ke=require("./hooks.cjs"),Re=require("../../_virtual/plugin-vue_export-helper.cjs"),De=require("../scrollbar/scrollbar.cjs"),Ne=require("../resize-observer/resize-observer.cjs"),f=require("../../common/config/src/props.cjs"),$e=require("../../common/config/src/namespace.cjs");const qe=Object.freeze(["horizontal","horizontal-exact","vertical","both"]),le=b.USE_TOUCH?"touchmove":"mousemove",re=b.USE_TOUCH?"touchend":"mouseup",Le=r.defineComponent({name:"Scroll",components:{Scrollbar:De,ResizeObserver:Ne},props:Ce.scrollProps,emits:[],setup(t){const l=f.useProps("scroll",t,{scrollClass:null,mode:{default:"vertical",validator:e=>qe.includes(e)},width:"",height:"",deltaX:20,deltaY:20,disabled:!1,pointer:b.USE_TOUCH,wheel:!0,scrollX:{default:0,static:!0},scrollY:{default:0,static:!0},useXBar:!1,useYBar:!1,barFade:1500,barClass:null,autoplay:!1,playWaiting:500,noBuffer:!1,noTransition:!1,onBeforeScroll:{default:null,isFunc:!0},useBarTrack:!1,wrapperTag:"div"}),C=b.createEventEmitter(),h=$e.useNameHelper("scroll"),k=r.ref(!1),w=r.ref(!1),v=r.ref(-1),c=r.computed(()=>l.mode==="horizontal-exact"?"horizontal":l.mode),{wrapperElement:s,contentElement:R,wrapper:te,isReady:P,currentScroll:n,percentX:d,percentY:m,xScrollLimit:$,yScrollLimit:q,enableXScroll:g,enableYScroll:y,xBarLength:ne,yBarLength:oe,handleResize:ae,verifyScroll:z,computePercent:L,refresh:ie}=ke.useScrollWrapper({mode:c,disabled:r.toRef(l,"disabled"),width:r.toRef(l,"width"),height:r.toRef(l,"height"),scrollX:r.toRef(l,"scrollX"),scrollY:r.toRef(l,"scrollY"),onResize:e=>{f.emitEvent(l.onResize,e)},onBeforeRefresh:E,onAfterRefresh:Y}),T=r.ref(!1),se=r.computed(()=>c.value!=="both"&&(b.isTrue(l.autoplay)||l.autoplay>1e3)&&(c.value==="horizontal"&&g.value||c.value==="vertical"&&y.value));r.watch(()=>l.autoplay,()=>{E(),r.nextTick(Y)}),r.watch(()=>l.playWaiting,()=>{E(),r.nextTick(Y)});let j,x,W;r.onBeforeUnmount(E);function Y(){if(!se.value)return;E();const e=c.value==="horizontal"?"width":"height",o=c.value==="horizontal"?$:q,i=c.value==="horizontal"?"x":"y",a=l.playWaiting<20?20:l.playWaiting;let u=.5;typeof l.autoplay=="number"&&(u=te[e]/l.autoplay*16);const p=()=>{n[i]-=u,n[i]<=o.value?(n[i]=o.value,T.value=!1,L(),B(),W=setTimeout(()=>{M(0,0,500),x=setTimeout(()=>{T.value=!0,p()},500+a)},a)):(L(),B(),T.value&&requestAnimationFrame(p))};j=setTimeout(()=>{T.value=!0,p()},a)}function E(){T.value=!1,clearTimeout(j),clearTimeout(x),clearTimeout(W)}const ue=r.computed(()=>[h.b(),h.bs("vars"),h.bm(c.value),{[h.bm("inherit")]:l.inherit}]),ce=r.computed(()=>{const{width:e,height:o}=l;return{width:e?typeof e=="string"?Number.isNaN(Number(e))?e:`${Number(e)}px`:`${e}px`:void 0,height:o?typeof o=="string"?Number.isNaN(Number(o))?o:`${Number(o)}px`:`${o}px`:void 0}}),pe=r.computed(()=>[h.be("wrapper"),l.scrollClass,{[h.bem("wrapper","scrolling")]:w.value,[h.bem("wrapper","no-ready")]:!P.value,[h.bem("wrapper","using-bar")]:k.value,[h.bem("wrapper","no-transition")]:l.noTransition}]),fe=r.computed(()=>({transform:`translate3d(${n.x}px, ${n.y}px, 0)`,transitionDuration:v.value<0?void 0:`${v.value}ms`}));r.watch(g,e=>{f.emitEvent(l.onXEnabledChange,e)}),r.watch(y,e=>{f.emitEvent(l.onYEnabledChange,e)}),r.watch(P,e=>{e&&f.emitEvent(l.onReady)});const V=r.ref(),H=r.ref();function B(){var e,o;(e=V.value)==null||e.handleScroll(d.value),(o=H.value)==null||o.handleScroll(m.value)}function ve(e){if(!l.pointer||e.button>0||b.USE_TOUCH)return!1;G(e)}function de(e){if(!l.pointer||e.touches.length!==1)return!1;G(e)}let A=0,F=0,O=0,U=0,X=!1,D=null,I=0;function G(e){if(!g.value&&!y.value)return!1;e.cancelable&&e.preventDefault(),Z(),v.value=0;const o="touches"in e?e.touches[0]:e;A=n.x,F=n.y,O=o.clientX,U=o.clientY,X=!1,D=e.target,I=Date.now(),document.addEventListener(le,J),document.addEventListener(re,K),f.emitEvent(l.onScrollStart,{clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value})}function J(e){var u;e.stopPropagation(),b.USE_TOUCH||e.preventDefault();const o="touches"in e?e.touches[0]:e,i=o.clientX-O>0?1:-1,a=o.clientY-U>0?1:-1;if(((u=l.onBeforeScroll)==null?void 0:u.call(l,{signX:i,signY:a}))===!1)return!1;w.value=!0,g.value&&(n.x=A+o.clientX-O,X=!0),y.value&&(n.y=F+o.clientY-U,X=!0),l.noBuffer?z():L(),B(),N(c.value)}function K(e){!X&&D&&e.target===D&&Date.now()-I<=500&&D.dispatchEvent(new MouseEvent("click",e)),document.removeEventListener(le,J),document.removeEventListener(re,K),v.value=-1,X=!1,he(),z(),B(),f.emitEvent(l.onScrollEnd,{clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value}),Y()}function me(e,o){var S;const i=y.value&&o==="vertical",a=g.value&&o==="horizontal",u=e.deltaY>0?-1:1;if(l.wheel&&(i||a)&&((S=l.onBeforeScroll)==null?void 0:S.call(l,{signX:-u,signY:-u}))!==!1)e.preventDefault(),e.stopPropagation();else return!0;if(c.value!=="both"&&c.value!==o)return!1;Z();const p=u*(o==="horizontal"?l.deltaX:l.deltaY);i?n.y+=p:a&&(n.x+=p),z(),B(),N(o),f.emitEvent(l.onWheel,{type:o,sign:-u,clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value}),Y()}let Q;function Z(){E(),clearTimeout(Q)}function he(){l.noBuffer?Q=setTimeout(()=>{w.value=!1},300):w.value=!1}function Se(e){k.value=!0,f.emitEvent(l.onBarScrollStart,{type:e,clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value})}function be(e){k.value=!1,f.emitEvent(l.onBarScrollEnd,{type:e,clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value})}function ge(e){d.value=e,n.x=e*$.value/100,f.emitEvent(l.onBarScroll,{type:"horizontal",clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value}),N("horizontal")}function ye(e){m.value=e,n.y=e*q.value/100,f.emitEvent(l.onBarScroll,{type:"vertical",clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value}),N("vertical")}function N(e){f.emitEvent(l.onScroll,{type:e,clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value}),C.emit("scroll",{type:e,clientX:-n.x,clientY:-n.y,percentX:d.value,percentY:m.value})}function Be(){s.value&&(s.value.scrollTop=0,s.value.scrollLeft=0)}function M(e,o,i){ee(i),r.nextTick(()=>{let a=!1;g.value&&Math.abs(n.x+e)>.01&&(n.x=-e,a=!0),y.value&&Math.abs(n.y+o)>.01&&(n.y=-o,a=!0),z(),B(),a||(v.value=-1)})}function _(e,o,i){ee(i),r.nextTick(()=>{let a=!1;e&&g&&(n.x-=e,a=!0),o&&y&&(n.y-=o,a=!0),z(),B(),a||(v.value=-1)})}function ee(e){typeof e=="number"&&(v.value=e,v.value===0&&r.nextTick(()=>{v.value=-1}))}function Ee(){return[0,-$.value]}function we(){return[0,-q.value]}function ze(e,o,i=0){if(!R.value||(typeof e=="string"&&(e=R.value.querySelector(e)),!b.isElement(e)))return;const a=R.value.getBoundingClientRect(),u=e.getBoundingClientRect();let p=0,S=0;c.value!=="vertical"&&(p=u.left-a.left+i),c.value!=="horizontal"&&(S=u.top-a.top+i),M(p,S,o)}function Te(e,o,i=0){if(!s.value||(typeof e=="string"&&(e=s.value.querySelector(e)),!b.isElement(e)))return;const a=s.value.getBoundingClientRect(),u=e.getBoundingClientRect();let p=0,S=0;c.value!=="vertical"&&(u.left<a.left+i?p=u.left-a.left-i:u.right>a.right-i&&(p=u.right-a.right+i)),c.value!=="horizontal"&&(u.top<a.top+i?S=u.top-a.top-i:u.bottom>a.bottom-i&&(S=u.bottom-a.bottom+i)),_(p,S,o)}function Ye(e){C.on("scroll",e)}function Xe(e){C.off("scroll",e)}return{props:l,nh:h,percentX:d,percentY:m,transitionDuration:v,currentScroll:n,className:ue,style:ce,wrapperClass:pe,wrapperStyle:fe,xBarLength:ne,yBarLength:oe,enableXScroll:g,enableYScroll:y,wrapper:s,content:R,xBar:V,yBar:H,handleResize:ae,handleMouseDown:ve,handleTouchStart:de,handleWheel:me,handleBarScrollStart:Se,handleBarScrollEnd:be,handleXBarScroll:ge,handleYBarScroll:ye,ensureScrollOffset:Be,refresh:ie,scrollTo:M,scrollBy:_,getXScrollLimit:Ee,getYScrollLimit:we,scrollToElement:ze,ensureInView:Te,addScrollListener:Ye,removeScrollListener:Xe}}});function Oe(t,l,C,h,k,w){const v=r.resolveComponent("ResizeObserver"),c=r.resolveComponent("Scrollbar");return r.openBlock(),r.createElementBlock("div",{ref:"wrapper",class:r.normalizeClass(t.className),style:r.normalizeStyle(t.style),onMousedown:l[5]||(l[5]=(...s)=>t.handleMouseDown&&t.handleMouseDown(...s)),onTouchstart:l[6]||(l[6]=(...s)=>t.handleTouchStart&&t.handleTouchStart(...s)),onScroll:l[7]||(l[7]=(...s)=>t.ensureScrollOffset&&t.ensureScrollOffset(...s)),onWheel:[l[8]||(l[8]=r.withModifiers(s=>t.handleWheel(s,t.mode==="horizontal-exact"?"horizontal":"vertical"),["exact"])),l[9]||(l[9]=r.withModifiers(s=>t.handleWheel(s,"horizontal"),["shift"]))]},[r.createVNode(v,{throttle:"","on-resize":t.handleResize},{default:r.withCtx(()=>[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(t.props.wrapperTag||"div"),{ref:"content",class:r.normalizeClass(t.wrapperClass),style:r.normalizeStyle(t.wrapperStyle),onTransitionend:l[0]||(l[0]=s=>t.transitionDuration=-1)},{default:r.withCtx(()=>[r.renderSlot(t.$slots,"default")]),_:3},40,["class","style"]))]),_:3},8,["on-resize"]),t.props.useXBar?(r.openBlock(),r.createBlock(c,{key:0,ref:"xBar",inherit:"",placement:"bottom",class:r.normalizeClass([t.nh.bem("bar","horizontal"),t.props.barClass]),fade:t.props.barFade,"bar-length":t.xBarLength,disabled:!t.enableXScroll,duration:t.transitionDuration,"use-track":t.props.useBarTrack,onScrollStart:l[1]||(l[1]=s=>t.handleBarScrollStart("horizontal")),onScroll:t.handleXBarScroll,onScrollEnd:l[2]||(l[2]=s=>t.handleBarScrollEnd("horizontal"))},null,8,["class","fade","bar-length","disabled","duration","use-track","onScroll"])):r.createCommentVNode("",!0),t.props.useYBar?(r.openBlock(),r.createBlock(c,{key:1,ref:"yBar",inherit:"",placement:"right",class:r.normalizeClass([t.nh.bem("bar","vertical"),t.props.barClass]),fade:t.props.barFade,"bar-length":t.yBarLength,disabled:!t.enableYScroll,duration:t.transitionDuration,"use-track":t.props.useBarTrack,onScrollStart:l[3]||(l[3]=s=>t.handleBarScrollStart("vertical")),onScroll:t.handleYBarScroll,onScrollEnd:l[4]||(l[4]=s=>t.handleBarScrollEnd("vertical"))},null,8,["class","fade","bar-length","disabled","duration","use-track","onScroll"])):r.createCommentVNode("",!0)],38)}var Ue=Re(Le,[["render",Oe]]);module.exports=Ue;
