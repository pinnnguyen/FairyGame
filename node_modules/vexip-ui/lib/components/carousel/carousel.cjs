"use strict";var e=require("vue");require("../icon/index.cjs");require("../../common/config/src/index.cjs");var D=require("@vexip-ui/hooks"),P=require("@vexip-ui/utils"),q=require("@vexip-ui/icons"),ae=require("./props.cjs"),le=require("./symbol.cjs"),se=require("../../_virtual/plugin-vue_export-helper.cjs"),ne=require("../icon/icon.cjs"),$=require("../../common/config/src/props.cjs"),ue=require("../../common/config/src/namespace.cjs");const ve=e.defineComponent({name:"Carousel",components:{Icon:ne},props:ae.carouselProps,emits:["update:active"],setup(i,{emit:w}){const t=$.useProps("carousel",i,{active:{default:0,static:!0},viewSize:{default:3,validator:r=>r>0},vertical:!1,disabled:!1,loop:!1,arrow:{default:"outside",validator:r=>["outside","inside","none"].includes(r)},arrowTrigger:{default:"hover",validator:r=>["hover","always"].includes(r)},autoplay:{default:!1,validator:r=>typeof r=="number"?r>500:!0},pointer:{default:"none",validator:r=>["outside","inside","none"].includes(r)},speed:300,activeOffset:0,height:null,ignoreHover:!1}),g=ue.useNameHelper("carousel"),s=e.ref(new Set),o=e.ref(0),p=e.ref(!1),u=e.ref(t.arrowTrigger==="always"),d=e.reactive({width:0,height:0}),n=e.reactive({width:0,height:0,offset:0}),c=e.reactive({width:0,height:0}),{wrapper:y,isHover:F}=D.useHover(),C=e.ref(),E=e.ref(),z=e.computed(()=>t.disabled||s.value.size<=t.viewSize),W=e.computed(()=>({[g.b()]:!0,[g.bs("vars")]:!0,[g.bm("inherit")]:t.inherit,[g.bm("vertical")]:t.vertical,[g.bm("disabled")]:z.value})),U=e.computed(()=>({height:t.vertical&&t.height?`${t.height}${typeof t.height=="number"?"px":""}`:void 0})),X=e.computed(()=>({width:d.width?`${d.width}px`:void 0,height:d.height?`${d.height}px`:void 0})),Y=e.computed(()=>({width:n.width?`${n.width}px`:void 0,height:n.height?`${n.height}px`:void 0,transform:n.offset?`translate${t.vertical?"Y":"X"}(${n.offset}px) translateZ(0)`:void 0,transitionDuration:p.value?"0ms":`${t.speed}ms`})),Z=e.computed(()=>z.value||!t.loop&&o.value<=0),V=e.computed(()=>z.value||!t.loop&&o.value>=s.value.size-t.viewSize),G=e.computed(()=>t.vertical?[q.ArrowUp,q.ArrowDown]:[q.ArrowLeft,q.ArrowRight]);e.watch(()=>t.active,r=>{O(r-t.activeOffset)}),e.watch(o,r=>{const a=(r+t.activeOffset)%s.value.size;$.emitEvent(t.onChange,a),w("update:active",a)}),e.watch(F,r=>{t.ignoreHover||(r?te():re())}),e.watch(()=>t.viewSize,A),e.watch(()=>t.autoplay,B);const M=P.debounceMinor(()=>{Array.from(s.value).forEach((r,a)=>{r.label=a})}),R=P.debounceMinor(()=>{s.value.forEach(r=>{r.width=c.width,r.height=c.height})}),L=P.debounceMinor(()=>{n.width=c.width*s.value.size,n.height=c.height*s.value.size});e.provide(le.CAROUSEL_STATE,e.reactive({vertical:e.toRef(t,"vertical"),increaseItem:J,decreaseItem:K,isItemActive:Q,handleSelect:ee}));let m=!1,I=!1;p.value=!0;let k;e.onMounted(()=>{H(),O(t.active-t.activeOffset),j(),setTimeout(()=>{p.value=!1,m=!1,B()},0),window.addEventListener("resize",A),y.value&&(k=new MutationObserver(()=>{A()}),k.observe(y.value,{attributes:!0,childList:!0,characterData:!0,attributeFilter:["style"]}))}),e.onBeforeUnmount(()=>{k==null||k.disconnect(),k=null,window.removeEventListener("resize",A)});function J(r){s.value.add(r),M(),R(),L()}function K(r){s.value.delete(r),M(),L()}function Q(r){return(o.value+t.activeOffset)%s.value.size===r}function H(){if(!y.value)return;let r=0,a=0;t.arrow==="outside"&&(t.vertical?(r=C.value?C.value.offsetHeight:0,a=E.value?E.value.offsetHeight:0):(r=C.value?C.value.offsetWidth:0,a=E.value?E.value.offsetWidth:0)),t.vertical?(d.width=0,d.height=y.value.offsetHeight-r-a,c.width=0,c.height=d.height/t.viewSize):(d.width=y.value.offsetWidth-r-a,d.height=0,c.width=d.width/t.viewSize,c.height=0)}function A(){H(),R(),L(),n.offset>0?N(0):S(0),setTimeout(()=>{p.value=!1,m=!1},0)}function N(r=1){if(z.value||m)return;const a=t.vertical?c.height:c.width,v=Array.from(s.value),l=v.length,f=(o.value-r+l)%l;if(f>=l-t.viewSize){if(!t.loop)return;if(n.offset<0)if(r<o.value)n.offset=-f*a;else{n.offset=a*(l-f);for(let h=f;h<l;++h)v[h].offset=-l*a}else{for(let h=0;h<l;++h)v[h].offset=h<f?0:-l*a;n.offset=a*(l-f)}o.value=f}else o.value=f,n.offset=-o.value*a;I=o.value<=l-t.viewSize,m=!0}function S(r=1){if(z.value||m)return;const a=t.vertical?c.height:c.width,v=Array.from(s.value),l=v.length,f=o.value+r;if(f>s.value.size-t.viewSize){if(!t.loop)return;if(n.offset>0)n.offset=a*(l-f);else{const h=f+t.viewSize-l;for(let T=0,oe=v.length;T<oe;++T)v[T].offset=T<h?l*a:0;n.offset=-f*a}o.value=f%l}else o.value=f,n.offset=-o.value*a;I=o.value<=l-t.viewSize,m=!0}function O(r){if(z.value||m||r===o.value)return;const a=s.value.size;if(r=r%a+(r<0?a:0),t.loop){let v,l;r>o.value?(v=r-o.value,l=a-r+o.value):(v=a-o.value+r,l=o.value-r),v<l?S(v):v>l?N(l):n.offset>0?N(v):S(v)}else r<o.value?N(o.value-r):S(r-o.value)}function j(){I?(s.value.forEach(r=>{r.offset=0}),I=!1,p.value=!0,requestAnimationFrame(()=>{n.offset=-o.value*(t.vertical?c.height:c.width),requestAnimationFrame(()=>{p.value=!1,m=!1})})):m=!1}function x(){N(1),$.emitEvent(t.onPrev,(o.value+t.activeOffset)%s.value.size)}function _(){S(1),$.emitEvent(t.onNext,(o.value+t.activeOffset)%s.value.size)}function ee(r){$.emitEvent(t.onSelect,r)}const{timer:b}=D.useSetTimeout();function B(){if(clearInterval(b.play),!t.autoplay)return;let r=4e3;typeof t.autoplay=="number"&&(r=t.autoplay),b.play=window.setInterval(()=>{!t.loop&&V.value?O(0):S()},r)}function te(){t.autoplay&&(clearTimeout(b.hover),b.hover=setTimeout(()=>{clearInterval(b.play)},250)),t.arrowTrigger==="hover"&&t.arrow==="inside"&&(u.value=!0)}function re(){t.autoplay&&(clearTimeout(b.hover),b.hover=setTimeout(()=>{B()},250)),t.arrowTrigger==="hover"&&(u.value=!1)}function ie(r){return t.loop?!1:!(r>=t.activeOffset-1&&r<s.value.size-t.activeOffset-1)}return{props:t,nh:g,itemStates:s,currentActive:o,arrowActive:u,className:W,style:U,listStyle:X,trackStyle:Y,disabledPrev:Z,disabledNext:V,arrowIcons:G,wrapper:y,prev:C,next:E,handlePrevClick:x,handleNextClick:_,handleWheel:O,handleAfterMove:j,isPointerDisabled:ie,refresh:A}}}),fe=["onClick"];function ce(i,w,t,g,s,o){const p=e.resolveComponent("Icon");return e.openBlock(),e.createElementBlock("div",{ref:"wrapper",class:e.normalizeClass(i.className),role:"list",style:e.normalizeStyle(i.style)},[e.createElementVNode("div",{style:e.normalizeStyle({position:"relative",display:"flex",flexDirection:i.props.vertical?"column":"row",width:"100%"})},[i.props.arrow!=="none"?(e.openBlock(),e.createElementBlock("div",{key:0,ref:"prev",class:e.normalizeClass([i.nh.bem("arrow",i.props.arrow),i.nh.bem("arrow","prev"),i.arrowActive?i.nh.bem("arrow","show"):""])},[e.createElementVNode("div",{class:e.normalizeClass({[i.nh.be("handler")]:!0,[i.nh.bem("handler","disabled")]:i.disabledPrev}),onClick:w[0]||(w[0]=(...u)=>i.handlePrevClick&&i.handlePrevClick(...u))},[e.renderSlot(i.$slots,"prev-arrow",{disabled:i.disabledPrev},()=>[e.createVNode(p,{icon:i.arrowIcons[0],scale:1.5},null,8,["icon","scale"])])],2)],2)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(i.nh.be("list")),style:e.normalizeStyle(i.listStyle)},[e.createElementVNode("div",{class:e.normalizeClass(i.nh.be("track")),style:e.normalizeStyle(i.trackStyle),onTransitionend:w[1]||(w[1]=e.withModifiers((...u)=>i.handleAfterMove&&i.handleAfterMove(...u),["self"]))},[e.renderSlot(i.$slots,"default")],38)],6),i.props.arrow!=="none"?(e.openBlock(),e.createElementBlock("div",{key:1,ref:"next",class:e.normalizeClass([i.nh.bem("arrow",i.props.arrow),i.nh.bem("arrow","next"),i.arrowActive?i.nh.bem("arrow","show"):""])},[e.createElementVNode("div",{class:e.normalizeClass({[i.nh.be("handler")]:!0,[i.nh.bem("handler","disabled")]:i.disabledNext}),onClick:w[2]||(w[2]=(...u)=>i.handleNextClick&&i.handleNextClick(...u))},[e.renderSlot(i.$slots,"next-arrow",{disabled:i.disabledNext},()=>[e.createVNode(p,{icon:i.arrowIcons[1],scale:1.5},null,8,["icon","scale"])])],2)],2)):e.createCommentVNode("",!0)],4),i.props.pointer!=="none"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(i.nh.bem("pointers",i.props.pointer))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.itemStates.size,u=>(e.openBlock(),e.createElementBlock("div",{key:u,class:e.normalizeClass({[i.nh.be("pointer")]:!0,[i.nh.bem("pointer","active")]:u-1===(i.currentActive+i.props.activeOffset)%i.itemStates.size,[i.nh.bem("pointer","disabled")]:i.isPointerDisabled(u-i.props.activeOffset-1)}),onClick:d=>i.handleWheel(u-i.props.activeOffset-1)},[e.renderSlot(i.$slots,"pointer",{active:u-1===(i.currentActive+i.props.activeOffset)%i.itemStates.size},()=>[e.createElementVNode("span",{class:e.normalizeClass(i.nh.be("pointer-inner"))},null,2)])],10,fe))),128))],2)):e.createCommentVNode("",!0)],6)}var de=se(ve,[["render",ce]]);module.exports=de;
