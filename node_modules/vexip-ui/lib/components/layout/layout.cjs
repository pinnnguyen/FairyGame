"use strict";var r=require("vue");require("../menu/index.cjs");require("../native-scroll/index.cjs");require("../../common/config/src/index.cjs");var G=require("@vexip-ui/hooks"),J=require("@vexip-ui/utils"),j=require("./layout-main.cjs"),E=require("./layout-header.cjs"),R=require("./layout-footer.cjs"),U=require("./layout-aside.cjs"),K=require("./props.cjs"),h=require("./helper.cjs"),W=require("./symbol.cjs"),X=require("../menu/menu.cjs"),w=require("../native-scroll/native-scroll.cjs"),c=require("../../common/config/src/props.cjs"),Z=require("../../common/config/src/namespace.cjs"),ee=r.defineComponent({name:"Layout",components:{LayoutAside:U,LayoutFooter:R,LayoutHeader:E,LayoutMain:j,Menu:X,NativeScroll:w},props:K.layoutProps,emits:["update:reduced","update:sign-type","update:color"],setup(H,{slots:a,emit:p,expose:F}){const n=c.useProps("layout",H,{noAside:!1,footer:!1,tag:"section",menus:{default:()=>[],static:!0},menuProps:null,logo:"",signName:"",config:()=>["nav","theme","color"],user:null,actions:()=>[],reduced:!1,avatarCircle:!1,signType:"aside",headerFixed:"lg",asideFixed:"lg",copyright:"",links:()=>[],colors:()=>["#339af0","#f03e3e","#be4bdb","#7950f2","#1b9e44","#f76707"],color:"",miniHeaderSign:"lg",verticalLinks:"md",onReducedChange:null,onSignClick:null,onMenuSelect:null,onUserAction:null}),o=Z.useNameHelper("layout"),T=r.ref(0),i=r.ref(n.reduced),l=r.ref(n.signType),y=r.ref(!1),f=r.ref(n.color),{isMounted:P}=G.useMounted(),v=r.ref(),d=r.ref(),b=r.ref(null),x=r.ref(null),N=h.useMediaQuery(r.toRef(n,"headerFixed")),M=h.useMediaQuery(r.toRef(n,"asideFixed")),D=h.useMediaQuery(r.toRef(n,"miniHeaderSign")),u=r.reactive({isLayout:!0,locked:!1,affixed:!1,scrollY:0,affixMatched:N,expanded:!1,reduced:i,navConfig:r.computed(()=>!n.noAside)}),B=r.computed(()=>[o.b(),o.bs("vars"),{[o.bm("inherit")]:n.inherit,[o.bm("no-aside")]:n.noAside,[o.bm("header-main")]:l.value==="header"}]),C=r.computed(()=>(P.value,J.isClient?document.documentElement:null)),m=r.computed(()=>n.noAside||l.value==="header"||u.expanded),S=r.computed(()=>{var e,t;return((e=x.value)==null?void 0:e.menu)||((t=b.value)==null?void 0:t.menu)||null});r.provide(W.LAYOUT_STATE,u),F({scroll:d,menu:S,expandMenuByLabel:O}),r.watch(N,e=>{u.affixMatched=e,u.affixed=!u.affixMatched&&u.scrollY>=50}),r.watch(()=>n.reduced,e=>{i.value=e}),r.watch(()=>u.locked,e=>{var t;!v.value||!((t=d.value)!=null&&t.content)||(e?(v.value.style.transitionDuration="0ms",d.value.content.style.transitionDuration="0ms"):(v.value.style.transitionDuration="",d.value.content.style.transitionDuration=""))}),r.watch(l,e=>{c.emitEvent(n.onNavChange,e),p("update:sign-type",e)}),r.watch(()=>n.color,e=>{var t;f.value=e||((t=n.colors)==null?void 0:t[0])||Q()}),r.watch(f,e=>{c.emitEvent(n.onColorChange,e),p("update:color",e)});function Q(){return C.value?getComputedStyle(C.value).getPropertyValue("--vxp-color-primary-base"):"#339af0"}function g(e=!i.value){i.value=e,c.emitEvent(n.onReducedChange,e),p("update:reduced",e)}function Y(e){c.emitEvent(n.onSignClick,e)}function k(e,t){c.emitEvent(n.onMenuSelect,e,t)}function I({clientY:e}){u.scrollY=e,u.affixed=!u.affixMatched&&e>=50}function $(e,t){c.emitEvent(n.onUserAction,e,t)}function O(e){var t;(t=S.value)==null||t.expandItemByLabel(e)}function s(){return{reduced:i.value,toggleReduce:g}}function q(){if(!n.logo&&!n.signName&&!a.sign)return null;if(a.sign)return a.sign(s());const e=n.signName&&!(m.value&&!D.value);return r.createVNode("div",{class:[o.be("sign"),!e&&o.bem("sign","logo-only")],onClick:Y},[[n.logo&&r.createVNode("div",{class:o.be("logo")},[r.createVNode("img",{src:n.logo,alt:"Logo"},null)]),e&&r.createVNode("span",{class:o.be("sign-name")},[n.signName])]])}function A(){return a.header?a.header(s()):r.createVNode(E,{ref:b,"sign-type":l.value,"onUpdate:sign-type":e=>l.value=e,"user-dropped":y.value,"onUpdate:user-dropped":e=>y.value=e,color:f.value,"onUpdate:color":e=>f.value=e,user:n.user,actions:n.actions,config:n.config,"avatar-circle":n.avatarCircle,menus:n.noAside?n.menus:[],"menu-props":n.noAside?n.menuProps:null,colors:n.colors,onUserAction:$,onReducedChange:g,onMenuSelect:k},{left:a["header-left"]||a.headerLeft||(()=>m.value?q():null),default:a["header-main"]||a.headerMain||null,right:a["header-right"]||a.headerRight||null,user:a["header-user"]||a.headerUser||null,avatar:a["header-avatar"]||a.headerAvatar||null})}function L(){return a.aside?a.aside(s()):n.noAside?null:r.createVNode(U,{ref:x,reduced:i.value,"onUpdate:reduced":e=>i.value=e,menus:n.menus,"menu-props":n.menuProps,fixed:n.asideFixed,onReducedChange:g,onMenuSelect:k},{top:a["aside-top"]||a.asideTop||(()=>m.value?null:q()),default:a["aside-main"]||a.asideMain||null,bottom:a["aside-bottom"]||a.asideBottom||null,expand:a["aside-expand"]||a.asideExpand||null})}function _(){return a.default?a.default(s()):r.createVNode(j,{style:{minHeight:`${T.value}px`}},{default:a.main})}function z(){return a.footer?a.footer(s()):r.createVNode(R,{copyright:n.copyright,links:n.links,"vertical-links":n.verticalLinks},{links:a["footer-links"]||a.footerLinks||null,copyright:a["footer-copyright"]||a.footerCopyright||null})}function V(){return r.createVNode(w,{ref:d,"scroll-class":[o.be("scroll"),M.value&&o.bem("scroll","away"),i.value&&o.bem("scroll","reduced")],height:"100%","use-y-bar":!0,"bar-class":o.be("scrollbar"),onScroll:I},{default:()=>[_(),n.footer&&z()]})}return()=>{const e=n.tag||"section";return r.createVNode(e,{class:B.value},{default:()=>[l.value==="aside"?[L(),r.createVNode("section",{ref:v,class:[o.be("section"),{[o.bem("section","away")]:M.value,[o.bem("section","reduced")]:i.value,[o.bem("section","locked")]:u.locked}]},[r.createVNode("div",{class:o.be("container")},[A(),V()])])]:[A(),r.createVNode("section",{class:o.be("section")},[r.createVNode("div",{class:o.be("container")},[L(),V()])])]]})}}});module.exports=ee;
