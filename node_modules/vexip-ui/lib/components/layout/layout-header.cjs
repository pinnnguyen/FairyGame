"use strict";var e=require("vue");require("../avatar/index.cjs");require("../dropdown/index.cjs");require("../dropdown-list/index.cjs");require("../dropdown-item/index.cjs");require("../icon/index.cjs");require("../menu/index.cjs");require("../switch/index.cjs");var s=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var K=require("@vexip-ui/hooks"),L=require("@vexip-ui/utils"),Q=require("./props.cjs"),q=require("./helper.cjs"),i=require("../../common/config/src/props.cjs"),W=require("../../common/config/src/namespace.cjs"),X=require("../../common/config/src/locale/index.cjs"),T=require("../icon/icon.cjs"),Y=require("../switch/switch.cjs"),Z=require("../menu/menu.cjs"),ee=require("../dropdown/dropdown.cjs"),E=require("../avatar/avatar.cjs"),re=require("../dropdown/dropdown-list.cjs"),ne=require("../dropdown/dropdown-item.cjs"),ae=e.defineComponent({name:"LayoutHeader",props:Q.layoutHeaderProps,emits:["update:sign-type","update:color","update:user-dropped"],setup(M,{slots:u,emit:b,expose:P}){var w,x,S;const r=i.useProps("layout",M,{tag:"header",logo:"",signName:"",user:{default:()=>({name:""}),static:!0},userDropped:!1,avatarCircle:!1,config:()=>["nav","theme","color"],actions:()=>[],signType:"aside",colors:()=>["#339af0","#f03e3e","#be4bdb","#7950f2","#1b9e44","#f76707"],color:"",menus:{default:()=>[],static:!0},menuProps:null,onNavChange:null,onColorChange:null,onUserAction:null,onSignClick:null}),a=W.useNameHelper("layout"),f=X.useLocale("layout"),l=q.useLayoutState(),g=e.ref(r.signType),h=e.ref(r.userDropped),C=e.ref(null),{isMounted:A}=K.useMounted(),c=e.computed(()=>(A.value,L.isClient?document.documentElement:null)),d=e.ref(r.color||((w=r.colors)==null?void 0:w[0])||y()),N=e.ref((S=(x=c.value)==null?void 0:x.classList.contains("dark"))!=null?S:!1),D=e.computed(()=>[a.be("header"),{[a.bs("vars")]:!l.isLayout,[a.bem("header","inherit")]:l.isLayout||r.inherit,[a.bem("header","affixed")]:l.affixed}]),U=e.computed(()=>{var n;return(n=r.actions)!=null&&n.length?r.actions:[{label:"signOut",name:f.value.signOut,icon:s.ArrowRightFromBracket}]}),B=e.computed(()=>!!(r.logo||r.signName||u.left)),H=e.computed(()=>{var n,o;return!!(((n=r.menus)==null?void 0:n.length)||((o=r.menuProps)==null?void 0:o.router))});P({menu:C,expandMenuByLabel:$}),e.watch(()=>r.signType,n=>{g.value=n}),e.watch(()=>r.color,n=>{var o;d.value=n||((o=r.colors)==null?void 0:o[0])||y()}),e.watch(()=>r.userDropped,n=>{h.value=n}),e.watch(d,q.computeSeriesColors),e.onBeforeMount(()=>{q.computeSeriesColors(d.value)});function y(){return c.value?getComputedStyle(c.value).getPropertyValue("--vxp-color-primary-base"):"#339af0"}function R(n,o){i.emitEvent(r.onUserAction,n,o)}function k(n){const o=[()=>{l.locked=!0},()=>{g.value=n,i.emitEvent(r.onNavChange,n),b("update:sign-type",n)},()=>{l.locked=!1}],p=()=>{var t;(t=o.shift())==null||t(),o.length&&requestAnimationFrame(p)};p()}function F(n=!l.reduced){l.reduced=n,i.emitEvent(r.onReducedChange,n)}function j(n){d.value=n,i.emitEvent(r.onColorChange,n),b("update:color",n)}function O(n){i.emitEvent(r.onSignClick,n)}function v(n=!h.value){h.value=n,i.emitEvent(r.onDropChange,n),b("update:user-dropped",n)}function I(n,o){v(!1),i.emitEvent(r.onMenuSelect,n,o)}function $(n){var o;(o=C.value)==null||o.expandItemByLabel(n)}function z(n){!L.isClient||requestAnimationFrame(()=>{N.value=n,c.value&&(n?c.value.classList.add("dark"):c.value.classList.remove("dark"))})}function m(){return{reduced:l.reduced,toggleReduce:F,handleColorChange:j,toggleUserDrop:v}}function V(){return e.createVNode(T,null,{default:()=>[e.createVNode(s.Check,null,null)]})}function _(){return e.createVNode("div",{class:a.be("config-unit")},[e.createVNode("div",{class:[a.be("brief-block"),a.bem("brief-block","aside")],onClick:()=>k("aside")},[g.value==="aside"&&V()]),e.createVNode("div",{class:a.be("brief-block"),onClick:()=>k("header")},[g.value==="header"&&V()])])}function G(){return e.createVNode("div",{class:a.be("config-unit")},[e.createVNode(Y,{value:N.value,class:[a.be("theme-mode"),N.value&&a.bem("theme-mode","dark")],"open-icon":s.Moon,"close-icon":s.Sun,"aria-label":"theme",onChange:z},null)])}function J(){var n;return(n=r.colors)!=null&&n.length?e.createVNode("div",{class:a.be("config-unit")},[r.colors.map(o=>e.createVNode("div",{class:a.be("major-color"),style:{backgroundColor:o},onClick:()=>j(o)},[d.value===o&&V()]))]):null}return()=>{const n=r.tag||"header";return e.createVNode(n,{class:D.value},{default:()=>[B.value&&e.createVNode("div",{class:a.be("header-left")},[u.left?u.left(m()):r.signType==="header"?e.createVNode("div",{class:a.be("sign"),onClick:O},[r.logo&&e.createVNode("div",{class:a.be("logo")},[e.createVNode("img",{src:r.logo,alt:"Logo"},null)]),r.signName&&e.createVNode("span",{class:a.be("sign-name")},[r.signName])]):null]),e.createVNode("div",{class:a.be("header-main")},[u.default?u.default(m()):H.value?e.createVNode(Z,e.mergeProps({ref:C},r.menuProps||{},{horizontal:!0,transfer:!0,options:r.menus,onSelect:I}),null):null]),u.right&&e.createVNode("div",{class:a.be("header-right")},[u.right(m())]),u.user?u.user(m()):e.createVNode(ee,{class:a.be("user"),transfer:!0,placement:"bottom-end",visible:h.value,trigger:"custom",onClickOutside:()=>v(!1)},{default:()=>{var o;return u.avatar?u.avatar(m()):typeof((o=r.user)==null?void 0:o.avatar)=="string"?e.createVNode(E,{src:r.user.avatar,icon:s.User,circle:r.avatarCircle,onClick:()=>v()},null):e.createVNode(E,{icon:r.user.avatar||s.User,circle:r.avatarCircle,onClick:()=>v()},null)},drop:()=>e.createVNode(re,null,{default:()=>{var o,p;return[((o=r.user)==null?void 0:o.name)&&e.createVNode("li",{class:a.be("user-profile")},[e.createVNode("span",{class:a.be("user-name")},[r.user.name]),r.user.email&&e.createVNode("span",{class:a.be("user-email")},[r.user.email])]),(p=r.config)!=null&&p.length?e.createVNode("li",{class:a.be("config")},[r.config.includes("nav")&&l.navConfig&&[e.createVNode("div",{class:a.be("config-label")},[f.value.signType]),_()],r.config.includes("theme")&&[e.createVNode("div",{class:a.be("config-label")},[f.value.themeMode]),G()],r.config.includes("color")&&[e.createVNode("div",{class:a.be("config-label")},[f.value.majorColor]),J()]]):null,U.value.map(t=>e.createVNode(ne,{class:a.be("user-action"),label:t.label,disabled:t.disabled,divided:t.divided,onSelect:()=>R(t.label,t.meta||{})},{default:()=>[t.icon&&e.createVNode(T,{icon:t.icon,style:{marginRight:"6px"}},null),t.name||t.label]}))]}})})]})}}});module.exports=ae;
