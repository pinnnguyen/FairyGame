"use strict";var r=require("vue");require("../scrollbar/index.cjs");require("../resize-observer/index.cjs");require("../../common/config/src/index.cjs");var q=require("@vexip-ui/utils"),he=require("./props.cjs"),Se=require("./hooks.cjs"),be=require("../../_virtual/plugin-vue_export-helper.cjs"),ye=require("../scrollbar/scrollbar.cjs"),ge=require("../resize-observer/resize-observer.cjs"),i=require("../../common/config/src/props.cjs"),Be=require("../../common/config/src/namespace.cjs");const Ye=Object.freeze(["horizontal","vertical","both"]),U="mousemove",x="mouseup",Ee=r.defineComponent({name:"NativeScroll",components:{Scrollbar:ye,ResizeObserver:ge},props:he.nativeScrollProps,emits:[],setup(o){const e=i.useProps("nativeScroll",o,{scrollClass:null,scrollStyle:()=>({}),mode:{default:"vertical",validator:l=>Ye.includes(l)},width:"",height:"",disabled:!1,pointer:!1,scrollX:{default:0,static:!0},scrollY:{default:0,static:!0},useXBar:!1,useYBar:!1,barFade:1500,barClass:null,autoplay:!1,playWaiting:500,onBeforeScroll:{default:null,isFunc:!0},appear:!1,barDuration:null,useBarTrack:!1,wrapperTag:"div"}),Y=q.createEventEmitter(),v=Be.useNameHelper("native-scroll"),E=r.ref(!1),k=r.ref(!1),{contentElement:s,currentScroll:t,percentX:n,percentY:c,xScrollLimit:b,yScrollLimit:y,enableXScroll:f,enableYScroll:m,xBarLength:G,yBarLength:I,handleResize:J,setScrollX:N,setScrollY:L,computePercent:X,refresh:K,scrollTo:P,scrollBy:Q,scrollToElement:Z}=Se.useScrollWrapper({mode:r.toRef(e,"mode"),disabled:r.toRef(e,"disabled"),appear:r.toRef(e,"appear"),width:r.toRef(e,"width"),height:r.toRef(e,"height"),scrollX:r.toRef(e,"scrollX"),scrollY:r.toRef(e,"scrollY"),onResize:l=>{i.emitEvent(e.onResize,l)},onBeforeRefresh:h,onAfterRefresh:z}),g=r.ref(!1),_=r.computed(()=>e.mode!=="both"&&(q.isTrue(e.autoplay)||e.autoplay>1e3)&&(e.mode==="horizontal"&&f.value||e.mode==="vertical"&&m.value));r.watch(()=>e.autoplay,()=>{h(),r.nextTick(z)}),r.watch(()=>e.playWaiting,()=>{h(),r.nextTick(z)});let j,D,M;r.onBeforeUnmount(h);function z(){if(!_.value||!s.value)return;h();const l=e.mode,a=l==="horizontal"?"offsetWidth":"offsetHeight",u=l==="horizontal"?b:y,p=l==="horizontal"?"x":"y",d=e.playWaiting<20?20:e.playWaiting,B=l==="horizontal"?N:L;let C=.5;typeof e.autoplay=="number"&&(C=s.value[a]/e.autoplay*16);const S=()=>{B(t[p]+C),t[p]>=u.value?(B(u.value),g.value=!1,X(),w(),M=setTimeout(()=>{P(0,0,500),D=setTimeout(()=>{g.value=!0,S()},500+d)},d)):(X(),w(),g.value&&requestAnimationFrame(S))};j=setTimeout(()=>{g.value=!0,S()},d)}function h(){g.value=!1,clearTimeout(j),clearTimeout(D),clearTimeout(M)}const ee=r.computed(()=>[v.b(),v.bm(e.mode),{[v.bm("inherit")]:e.inherit}]),le=r.computed(()=>{const{width:l,height:a}=e;return{width:l?typeof l=="string"?Number.isNaN(Number(l))?l:`${Number(l)}px`:`${l}px`:void 0,height:a?typeof a=="string"?Number.isNaN(Number(a))?a:`${Number(a)}px`:`${a}px`:void 0}}),re=r.computed(()=>[v.be("wrapper"),e.scrollClass,{[v.bem("wrapper","scrolling")]:k.value,[v.bem("wrapper","using-bar")]:E.value}]);r.watch(f,l=>{i.emitEvent(e.onXEnabledChange,l)}),r.watch(m,l=>{i.emitEvent(e.onYEnabledChange,l)});const W=r.ref(),V=r.ref();function w(){var l,a;(l=W.value)==null||l.handleScroll(n.value),(a=V.value)==null||a.handleScroll(c.value)}function oe(l){if(!e.pointer||l.button!==0||q.USE_TOUCH)return!1;te(l)}let A=0,O=0,R=0,$=0;function te(l){if(!f.value&&!m.value)return!1;l.preventDefault(),se(),A=t.x,O=t.y,R=l.clientX,$=l.clientY,document.addEventListener(U,F),document.addEventListener(x,H),i.emitEvent(e.onScrollStart,{clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value})}function F(l){var p;l.stopPropagation(),l.preventDefault();const a=l.clientX-R>0?1:-1,u=l.clientY-$>0?1:-1;if(((p=e.onBeforeScroll)==null?void 0:p.call(e,{signX:a,signY:u}))===!1)return!1;k.value=!0,f.value&&N(A-(l.clientX-R)),m.value&&L(O-(l.clientY-$)),X(),w(),T(e.mode)}function H(){document.removeEventListener(U,F),document.removeEventListener(x,H),i.emitEvent(e.onScrollEnd,{clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value}),z()}function ne(l,a){var B;const u=m.value&&a==="vertical",p=f.value&&a==="horizontal",d=l.deltaY>0?1:-1;if(i.emitEvent(e.onWheel,l,a),(u||p)&&((B=e.onBeforeScroll)==null?void 0:B.call(e,{signX:d,signY:d}))!==!1){const C=u?y.value:b.value,S=u?t.y:t.x;if(d>0?S<C:S>0)return l.stopPropagation(),!1}}function ae(l,a){var u;if(l.stopPropagation(),l.preventDefault(),s.value){const p=s.value.scrollLeft-t.x>0?1:-1,d=s.value.scrollTop-t.y>0?1:-1;if(((u=e.onBeforeScroll)==null?void 0:u.call(e,{signX:p,signY:d}))===!1){s.value.scrollTop=t.y,s.value.scrollLeft=t.x;return}t.y=s.value.scrollTop,t.x=s.value.scrollLeft}X(),w(),T(a)}function se(){h()}function ie(l){E.value=!0,i.emitEvent(e.onBarScrollStart,{type:l,clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value})}function ce(l){E.value=!1,i.emitEvent(e.onBarScrollEnd,{type:l,clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value})}function ue(l){n.value=l,N(l*b.value/100),i.emitEvent(e.onBarScroll,{type:"horizontal",clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value}),T("horizontal")}function pe(l){c.value=l,L(l*y.value/100),i.emitEvent(e.onBarScroll,{type:"vertical",clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value}),T("vertical")}function T(l){i.emitEvent(e.onScroll,{type:l,clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value}),Y.emit("scroll",{type:l,clientX:t.x,clientY:t.y,percentX:n.value,percentY:c.value})}function de(){return[0,b.value]}function ve(){return[0,y.value]}function fe(l){Y.on("scroll",l)}function me(l){Y.off("scroll",l)}return{props:e,nh:v,percentX:n,percentY:c,currentScroll:t,xScrollLimit:b,yScrollLimit:y,className:ee,style:le,wrapperClass:re,xBarLength:G,yBarLength:I,enableXScroll:f,enableYScroll:m,wrapper:r.ref(),content:s,xBar:W,yBar:V,handleResize:J,handleMouseDown:oe,handleScroll:ae,handleWheel:ne,handleBarScrollStart:ie,handleBarScrollEnd:ce,handleXBarScroll:ue,handleYBarScroll:pe,refresh:K,scrollTo:P,scrollBy:Q,scrollToElement:Z,getXScrollLimit:de,getYScrollLimit:ve,addScrollListener:fe,removeScrollListener:me}}});function Xe(o,e,Y,v,E,k){const s=r.resolveComponent("ResizeObserver"),t=r.resolveComponent("Scrollbar");return r.openBlock(),r.createElementBlock("div",{ref:"wrapper",class:r.normalizeClass(o.className),style:r.normalizeStyle(o.style),onMousedown:e[6]||(e[6]=(...n)=>o.handleMouseDown&&o.handleMouseDown(...n)),onWheel:[e[7]||(e[7]=r.withModifiers(n=>o.handleWheel(n,"vertical"),["exact"])),e[8]||(e[8]=r.withModifiers(n=>o.handleWheel(n,"horizontal"),["shift"]))]},[r.createVNode(s,{throttle:"","on-resize":o.handleResize},{default:r.withCtx(()=>[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(o.props.wrapperTag||"div"),{ref:"content",class:r.normalizeClass(o.wrapperClass),style:r.normalizeStyle(o.props.scrollStyle),onScroll:[e[0]||(e[0]=r.withModifiers(n=>o.handleScroll(n,"vertical"),["exact"])),e[1]||(e[1]=r.withModifiers(n=>o.handleScroll(n,"horizontal"),["shift"]))]},{default:r.withCtx(()=>[r.renderSlot(o.$slots,"default")]),_:3},40,["class","style"]))]),_:3},8,["on-resize"]),o.props.useXBar?(r.openBlock(),r.createBlock(t,{key:0,ref:"xBar",inherit:"",placement:"bottom",class:r.normalizeClass([o.nh.bem("bar","horizontal"),o.props.barClass]),fade:o.props.barFade,"bar-length":o.xBarLength,disabled:!o.enableXScroll,appear:o.props.appear,duration:o.props.barDuration,"use-track":o.props.useBarTrack,onScrollStart:e[2]||(e[2]=n=>o.handleBarScrollStart("horizontal")),onScroll:o.handleXBarScroll,onScrollEnd:e[3]||(e[3]=n=>o.handleBarScrollEnd("horizontal"))},null,8,["class","fade","bar-length","disabled","appear","duration","use-track","onScroll"])):r.createCommentVNode("",!0),o.props.useYBar?(r.openBlock(),r.createBlock(t,{key:1,ref:"yBar",inherit:"",placement:"right",class:r.normalizeClass([o.nh.bem("bar","vertical"),o.props.barClass]),fade:o.props.barFade,"bar-length":o.yBarLength,disabled:!o.enableYScroll,appear:o.props.appear,duration:o.props.barDuration,"use-track":o.props.useBarTrack,onScrollStart:e[4]||(e[4]=n=>o.handleBarScrollStart("vertical")),onScroll:o.handleYBarScroll,onScrollEnd:e[5]||(e[5]=n=>o.handleBarScrollEnd("vertical"))},null,8,["class","fade","bar-length","disabled","appear","duration","use-track","onScroll"])):r.createCommentVNode("",!0)],38)}var ze=be(Ee,[["render",Xe]]);module.exports=ze;
