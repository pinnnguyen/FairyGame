"use strict";var t=require("vue"),ne=require("./time-wheel.cjs");require("../button/index.cjs");require("../calendar-panel/index.cjs");require("../icon/index.cjs");var le=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var k=require("@vexip-ui/utils"),S=require("@vexip-ui/icons"),re=require("./symbol.cjs"),oe=require("../../_virtual/plugin-vue_export-helper.cjs"),ie=require("../button/button.cjs"),ue=require("../calendar/calendar-panel.cjs"),de=require("../icon/icon.cjs"),q=require("../../common/config/src/locale/index.cjs"),se=require("../../common/config/src/namespace.cjs");const ce=t.defineComponent({name:"DatePanel",components:{Button:ie,CalendarPanel:ue,Icon:de,TimeWheel:ne,AngleRight:S.AngleRight,AngleLeft:S.AngleLeft,AnglesRight:S.AnglesRight,AnglesLeft:S.AnglesLeft},props:{type:{default:"date",validator:e=>re.datePickerTypes.includes(e)},enabled:{type:Object,default:()=>({})},startValue:{type:Object,default:()=>({})},endValue:{type:Object,default:()=>({})},valueType:{type:String,default:"start"},shortcuts:{type:Array,default:()=>[]},column:{type:String,default:"date"},confirmText:{type:String,default:null},cancelText:{type:String,default:null},today:{type:[Number,String,Date],default:()=>new Date},disabledDate:{type:Function,default:()=>!1},noAction:{type:Boolean,default:!1},steps:{type:Array,default:()=>[1,1,1]},isRange:{type:Boolean,default:!1},startActivated:{type:Object,default:()=>({})},endActivated:{type:Object,default:()=>({})},min:{type:[Number,String,Date],default:null},max:{type:[Number,String,Date],default:null},disabledTime:{type:Object,default:()=>({})},hasError:{type:Boolean,default:!1}},emits:["click","shortcut","toggle-col","change","cancel","confirm","hover","type-change"],setup(e,{emit:r}){const E=k.toDate(e.today),y=t.ref("date"),i=t.ref(E.getFullYear()),v=t.ref(E.getMonth()+1),d=t.ref(0),s=t.ref(0),f=t.ref([]),A=t.ref(),{isHover:w}=le.useHover(A),M=t.computed(()=>({...q.useLocale("calendar").value,...q.useLocale("datePicker").value})),V=t.computed(()=>{const a=e.startActivated;return a.year&&a.month&&a.date}),C=t.computed(()=>{const a=e.endActivated;return a.year&&a.month&&a.date}),l=t.computed(()=>e.type==="datetime"),h=t.computed(()=>e.valueType==="start"?e.startValue:e.endValue),D=t.computed(()=>e.valueType==="start"?e.startActivated:e.endActivated),N=t.computed(()=>e.isRange&&(e.valueType==="start"&&C.value||e.valueType==="end"&&V.value)),L=t.computed(()=>N.value?[V.value?B("start"):"",C.value?B("end"):""]:e.valueType==="start"?V.value?B(e.valueType):"":C.value?B(e.valueType):"");t.watch(()=>e.column,a=>{(a==="year"||a==="month"||a==="date")&&(y.value=a,P())},{immediate:!0}),t.watch(i,a=>{f.value=k.range(12,Math.floor(a/10)*10,1)},{immediate:!0}),t.watch(w,a=>{a&&R(y.value)});function B(a){const n=a==="start"?e.startValue:e.endValue;return`${n.year}-${n.month}-${n.date}`}function H(a){return M.value[`month${a}`]}function z(a){y.value=a,R(a)}function $(a,n){if(a==="year")i.value+=n;else{v.value+=n;const o=new Date(i.value,v.value-1,1);i.value=o.getFullYear(),v.value=o.getMonth()+1}}function F(a){r("click",a)}function I(a){let{value:n,name:o}=e.shortcuts[a];typeof n=="function"&&(n=n()),r("shortcut",o,n)}function O(a){g("year",a.getFullYear()),g("month",a.getMonth()+1),g("date",a.getDate())}function W(a){j(a)||(i.value=a,g("year",a),e.type!=="year"&&z("month"))}function G(a){T(a)||(v.value=a,g("year",i.value),g("month",a),e.type!=="month"&&z("date"))}function R(a){r("toggle-col",a)}function g(a,n){r("change",a,n)}function J(){y.value==="year"?f.value=k.range(12,f.value[0]-10,1):$("year",-1)}function K(){y.value==="year"?f.value=k.range(12,f.value[10],1):$("year",1)}function Q(){r("cancel")}function U(){r("confirm")}function X(a){r("hover",a)}function Z(a){return a?e.startActivated.year&&e.startValue.year===a||e.endActivated.year&&e.endValue.year===a:!1}function p(a){if(!a)return!1;const n=100*i.value+a;return e.startActivated.month&&100*e.startValue.year+e.startValue.month===n||e.endActivated.month&&100*e.endValue.year+e.endValue.month===n}function j(a){if(e.isRange&&(e.valueType==="end"&&e.startActivated.year&&a<e.startValue.year||e.valueType==="start"&&e.endActivated.year&&e.endValue.year<a))return!0;if(e.type==="year")return e.disabledDate(new Date(a,0));for(let n=1;n<=12;++n)if(!T(n,a))return!1;return!0}function T(a,n=i.value){if(e.type==="year")return!1;if(e.isRange){const u=n*100+a;if(e.valueType==="end"&&e.startActivated.month&&u<100*e.startValue.year+e.startValue.month||e.valueType==="start"&&e.endActivated.month&&u>100*e.endValue.year+e.endValue.month)return!0}if(e.type==="month")return e.disabledDate(new Date(n,a-1));const o=new Date(n,a-1),c=new Date(n,a,0).getDate();for(let u=1;u<=c;++u)if(o.setDate(u),!e.disabledDate(o))return!1;return!0}function x(a){d.value=j(a)?0:a}function _(a){s.value=T(a)?0:a}function ee(a){if(!N.value||!d.value&&!e.startActivated.year&&!e.endActivated.year||e.valueType==="start"&&!e.endActivated.year||e.valueType==="end"&&!e.startActivated.year)return!1;const n=e.startValue.year,o=e.endValue.year;let m,c;if(!d.value&&e.startActivated.year&&e.endActivated.year)m=Math.min(n,o),c=Math.max(n,o);else if(d.value){if(!e.startActivated.year&&!e.endActivated.year)return!1;if(!e.startActivated.year||!e.endActivated.year){const u=e.startActivated.year?n:o;m=Math.min(d.value,u),c=Math.max(d.value,u)}else{const u=Math.min(n,o),b=Math.max(n,o);m=Math.min(d.value,u),c=Math.max(d.value,b)}}else return!1;return a>=m&&a<=c}function te(a){if(!N.value||!s.value&&!e.startActivated.month&&!e.endActivated.month||e.valueType==="start"&&!e.endActivated.month||e.valueType==="end"&&!e.startActivated.month)return!1;const n=100*e.startValue.year+e.startValue.month,o=100*e.endValue.year+e.endValue.month;let m,c;if(!s.value&&e.startActivated.month&&e.endActivated.month)m=Math.min(n,o),c=Math.max(n,o);else if(s.value){if(!e.startActivated.month&&!e.endActivated.month)return!1;const b=100*i.value+s.value;if(!e.startActivated.month||!e.endActivated.month){const Y=e.startActivated.month?n:o;m=Math.min(b,Y),c=Math.max(b,Y)}else{const Y=Math.min(n,o),ae=Math.max(n,o);m=Math.min(b,Y),c=Math.max(b,ae)}}else return!1;const u=100*i.value+a;return u>=m&&u<=c}function P(){const a=k.toDate(e.today);e.valueType==="start"?(i.value=e.startActivated.year?e.startValue.year:a.getFullYear(),v.value=e.startActivated.month?e.startValue.month:a.getMonth()+1):(i.value=e.endActivated.year?e.endValue.year:a.getFullYear(),v.value=e.endActivated.month?e.endValue.month:a.getMonth()+1)}return{nh:se.useNameHelper("date-picker"),locale:M,currentPane:y,calendarYear:i,calendarMonth:v,yearRange:f,monthRange:k.range(12,1,1),hoveredYear:d,hoveredMonth:s,isDatetime:l,dateValue:h,activated:D,calendarValue:L,calendarRange:N,calendar:A,getMonthLabel:H,togglePane:z,adjustCalendar:$,handleClick:F,handleShortcut:I,handleSelectDate:O,handleSelectYear:W,handleSelectMonth:G,toggleColumn:R,emitChange:g,handleDoublePrevClick:J,handleDoubleNextClick:K,handleCancel:Q,handleConfirm:U,handleHoverDate:X,isSelectedYear:Z,isSelectedMonth:p,isDisabledYear:j,isDisabledMonth:T,handleYearHover:x,handleMonthHover:_,isYearInRange:ee,isMonthInRange:te,refreshCalendar:P}}}),me=["title","onClick"],he={style:{display:"flex"}},ve=["onClick","onMouseenter"],fe=["onClick","onMouseenter"];function ye(e,r,E,y,i,v){const d=t.resolveComponent("AnglesLeft"),s=t.resolveComponent("Icon"),f=t.resolveComponent("AngleLeft"),A=t.resolveComponent("AngleRight"),w=t.resolveComponent("AnglesRight"),M=t.resolveComponent("CalendarPanel"),V=t.resolveComponent("TimeWheel"),C=t.resolveComponent("Button");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.nh.be("panel")),onClick:r[8]||(r[8]=(...l)=>e.handleClick&&e.handleClick(...l))},[e.shortcuts.length?(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass([e.nh.be("list"),e.nh.bem("list","sub")])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.shortcuts,(l,h)=>(t.openBlock(),t.createElementBlock("div",{key:h,class:t.normalizeClass(e.nh.be("shortcut")),title:l.name,onClick:D=>e.handleShortcut(h)},t.toDisplayString(l.name),11,me))),128))],2)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("list"))},[t.createElementVNode("div",he,[t.createElementVNode("div",null,[t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("header"))},[t.createElementVNode("div",{class:t.normalizeClass([e.nh.be("arrow"),e.nh.be("prev-year")]),onClick:r[0]||(r[0]=(...l)=>e.handleDoublePrevClick&&e.handleDoublePrevClick(...l))},[t.createVNode(s,null,{default:t.withCtx(()=>[t.createVNode(d)]),_:1})],2),t.withDirectives(t.createElementVNode("div",{class:t.normalizeClass([e.nh.be("arrow"),e.nh.be("prev-month")]),onClick:r[1]||(r[1]=l=>e.adjustCalendar("month",-1))},[t.createVNode(s,null,{default:t.withCtx(()=>[t.createVNode(f)]),_:1})],2),[[t.vShow,e.currentPane==="date"]]),t.createElementVNode("div",{key:"year",class:t.normalizeClass(e.nh.be("year")),onClick:r[2]||(r[2]=t.withModifiers(l=>e.togglePane("year"),["stop"]))},[e.currentPane==="year"?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.createTextVNode(t.toDisplayString(`${e.yearRange[0]}${e.locale.year} - ${e.yearRange[9]}${e.locale.year}`),1)],64)):(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.createTextVNode(t.toDisplayString(`${e.calendarYear}${e.locale.year}`),1)],64))],2),t.withDirectives(t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("month")),onClick:r[3]||(r[3]=t.withModifiers(l=>e.togglePane("month"),["stop"]))},t.toDisplayString(e.getMonthLabel(e.calendarMonth)),3),[[t.vShow,e.currentPane==="date"]]),t.withDirectives(t.createElementVNode("div",{class:t.normalizeClass([e.nh.be("arrow"),e.nh.be("next-month")]),onClick:r[4]||(r[4]=l=>e.adjustCalendar("month",1))},[t.createVNode(s,null,{default:t.withCtx(()=>[t.createVNode(A)]),_:1})],2),[[t.vShow,e.currentPane==="date"]]),t.createElementVNode("div",{class:t.normalizeClass([e.nh.be("arrow"),e.nh.be("next-year")]),onClick:r[5]||(r[5]=(...l)=>e.handleDoubleNextClick&&e.handleDoubleNextClick(...l))},[t.createVNode(s,null,{default:t.withCtx(()=>[t.createVNode(w)]),_:1})],2)],2),t.createElementVNode("div",{ref:"calendar",class:t.normalizeClass(e.nh.be("calendar"))},[e.currentPane==="year"?(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass(e.nh.be("year-pane")),onMouseleave:r[6]||(r[6]=l=>e.hoveredYear=0)},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.yearRange,(l,h)=>(t.openBlock(),t.createElementBlock("div",{key:h,class:t.normalizeClass({[e.nh.be("year-item")]:!0,[e.nh.bem("year-item","selected")]:e.isSelectedYear(l),[e.nh.bem("year-item","next")]:h>9,[e.nh.bem("year-item","disabled")]:e.isDisabledYear(l),[e.nh.bem("year-item","in-range")]:e.isYearInRange(l)}),onClick:t.withModifiers(D=>e.handleSelectYear(l),["stop"]),onMouseenter:D=>e.handleYearHover(l)},[t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("year-label"))},[t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("year-label-inner"))},t.toDisplayString(l),3)],2)],42,ve))),128))],34)):e.currentPane==="month"?(t.openBlock(),t.createElementBlock("div",{key:1,class:t.normalizeClass(e.nh.be("month-pane")),onMouseleave:r[7]||(r[7]=l=>e.hoveredMonth=0)},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.monthRange,l=>(t.openBlock(),t.createElementBlock("div",{key:l,class:t.normalizeClass({[e.nh.be("month-item")]:!0,[e.nh.bem("month-item","selected")]:e.isSelectedMonth(l),[e.nh.bem("month-item","disabled")]:e.isDisabledMonth(l),[e.nh.bem("month-item","in-range")]:e.isMonthInRange(l)}),onClick:t.withModifiers(h=>e.handleSelectMonth(l),["stop"]),onMouseenter:h=>e.handleMonthHover(l)},[t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("month-label"))},[t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("month-label-inner"))},t.toDisplayString(e.getMonthLabel(l)),3)],2)],42,fe))),128))],34)):(t.openBlock(),t.createBlock(M,{key:2,inherit:"",value:e.calendarValue,year:e.calendarYear,month:e.calendarMonth,"disabled-date":e.disabledDate,"is-range":e.calendarRange,"value-type":e.valueType,min:e.min,max:e.max,onSelect:e.handleSelectDate,onHover:e.handleHoverDate},null,8,["value","year","month","disabled-date","is-range","value-type","min","max","onSelect","onHover"]))],2)]),e.isDatetime?(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass(e.nh.be("time-wheel"))},[t.createElementVNode("div",{class:t.normalizeClass(e.nh.be("header"))},null,2),t.createVNode(V,{hour:e.dateValue.hour,minute:e.dateValue.minute,second:e.dateValue.second,candidate:3,steps:e.steps,"disabled-time":e.disabledTime,onToggleCol:e.toggleColumn,onChange:e.emitChange},null,8,["hour","minute","second","steps","disabled-time","onToggleCol","onChange"])],2)):t.createCommentVNode("",!0)]),e.noAction?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass(e.nh.be("action"))},[t.createVNode(C,{inherit:"",text:"",size:"small",onClick:e.handleCancel},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(e.cancelText||e.locale.cancel),1)]),_:1},8,["onClick"]),t.createVNode(C,{inherit:"",type:"primary",size:"small",disabled:e.hasError,onClick:e.handleConfirm},{default:t.withCtx(()=>[t.createTextVNode(t.toDisplayString(e.confirmText||e.locale.confirm),1)]),_:1},8,["disabled","onClick"])],2))],2)],2)}var ge=oe(ce,[["render",ye]]);module.exports=ge;
