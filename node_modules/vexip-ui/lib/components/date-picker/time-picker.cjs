"use strict";var n=require("vue"),Re=require("./time-control.cjs"),Ae=require("./time-wheel.cjs");require("../button/index.cjs");require("../icon/index.cjs");require("../portal/index.cjs");require("../form/index.cjs");var N=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var $=require("@vexip-ui/utils"),j=require("@vexip-ui/icons"),Me=require("./props.cjs"),re=require("./helper.cjs"),Ue=require("../../_virtual/plugin-vue_export-helper.cjs"),Le=require("../button/button.cjs"),He=require("../icon/icon.cjs"),De=require("../portal/portal.cjs"),We=require("../form/helper.cjs"),Oe=require("../../common/config/src/namespace.cjs"),i=require("../../common/config/src/props.cjs"),Xe=require("../../common/config/src/locale/index.cjs");const Ke=/^((?:\d{1,2}))((?::\d{1,2}))?((?::\d{1,2}))?$/,Ge=n.defineComponent({name:"TimePicker",components:{Button:Le,Icon:He,Portal:De,TimeControl:Re,TimeWheel:Ae,CircleXmark:j.CircleXmark,ArrowRightArrowLeft:j.ArrowRightArrowLeft},props:Me.timePickerProps,emits:["update:value","update:visible"],setup(e,{slots:s,emit:T}){const{idFor:G,state:J,disabled:Q,loading:b,size:P,validateField:q,clearField:R,getFieldValue:B,setFieldValue:I}=We.useFieldStore(()=>{var o;return(o=M.value)==null?void 0:o.focus()}),A=$.format(Date.now(),"HH:mm:ss"),l=Oe.useNameHelper("time-picker"),t=i.useProps("timePicker",e,{size:i.createSizeProp(P),state:i.createStateProp(J),visible:!1,placement:{default:"bottom-start",validator:o=>N.placementWhileList.includes(o)},transfer:!1,format:"HH:mm:ss",separator:":",value:{default:()=>B(""),static:!0},filler:{default:"-",validator:o=>o.length===1},noFiller:!1,clearable:!1,noAction:!1,noArrow:!1,pointer:$.USE_TOUCH,candidate:{default:3,validator:o=>[0,1,2,3].includes(o)},steps:()=>[1,1,1],labels:()=>({}),shortcuts:()=>[],isRange:!1,disabled:()=>Q.value,transitionName:()=>l.ns("drop"),confirmText:null,cancelText:null,ctrlSteps:()=>[5,5,5],prefix:null,prefixColor:"",suffix:null,suffixColor:"",noSuffix:!1,exchange:!1,loading:()=>b.value,loadingIcon:j.Spinner,loadingLock:!1,loadingSpin:!1,min:null,max:null}),Y=n.toRef(t,"placement"),se=n.toRef(t,"transfer"),c=n.ref(t.visible),S=n.ref(!1),h=n.ref(""),d=oe(),m=oe(),v=n.ref("start"),{timer:Z}=N.useSetTimeout(),z=N.useClickOutside(Fe),{reference:M,popper:ie,transferTo:ue,updatePopper:x}=N.usePopper({placement:Y,transfer:se,wrapper:z,isDrop:!0}),{isHover:_}=N.useHover(M),{isTimeDisabled:g}=re.useTimeBound(n.toRef(t,"min"),n.toRef(t,"max")),U=n.ref(),L=n.ref(),de=n.computed(()=>[l.b(),l.ns("input-vars"),l.bs("vars"),{[l.bm("inherit")]:t.inherit,[l.bm("disabled")]:t.disabled,[l.bm(t.size)]:t.size!=="default",[l.bm("no-hour")]:!d.enabled.hour,[l.bm("no-minute")]:!d.enabled.minute,[l.bm("no-second")]:!d.enabled.second,[l.bm("visible")]:c.value,[l.bm(t.state)]:t.state!=="default",[l.bm("is-range")]:t.isRange}]),ce=n.computed(()=>{const o=l.be("selector");return{[o]:!0,[`${o}--disabled`]:t.disabled,[`${o}--loading`]:t.loading&&t.loadingLock,[`${o}--${t.size}`]:t.size!=="default",[`${o}--focused`]:S.value,[`${o}--${t.state}`]:t.state!=="default"}}),me=n.computed(()=>!!(s.prefix||t.prefix)),p=n.computed(()=>{const o=[d,m].map(a=>Object.values(a.timeValue).map($.doubleDigits).join(":"));return t.isRange?o:o[0]}),pe=n.computed(()=>!t.disabled&&t.clearable&&_.value&&!!h.value),ee=n.computed(()=>{const{hour:o,minute:a,second:r}=d.timeValue;return g.hour(o)||g.minute(o,a)||g.second(o,a,r)}),ne=n.computed(()=>{if(!t.isRange)return!1;const{hour:o,minute:a,second:r}=m.timeValue;return g.hour(o)||g.minute(o,a)||g.second(o,a,r)});V(t.value,!1),t.noFiller&&(h.value=H()),n.watch(()=>t.value,o=>{V(o)}),n.watch(()=>t.format,fe,{immediate:!0}),n.watch(()=>t.visible,o=>{c.value=o}),n.watch(c,o=>{o?x():he(),i.emitEvent(t.onToggle,o),T("update:visible",o)}),n.watch(S,o=>{o?i.emitEvent(t.onFocus):i.emitEvent(t.onBlur)}),n.watch(v,o=>{c.value&&i.emitEvent(t.onChangeCol,f().column,o)}),n.watch(()=>d.column,o=>{c.value&&v.value==="start"&&i.emitEvent(t.onChangeCol,o,"start")}),n.watch(()=>m.column,o=>{c.value&&v.value==="end"&&i.emitEvent(t.onChangeCol,o,"end")}),n.watch(()=>t.disabled,o=>{o&&(c.value=!1,W())}),n.watch(()=>t.loading,o=>{o&&t.loadingLock&&(c.value=!1)}),n.watch(()=>t.loadingLock,o=>{t.loading&&o&&(c.value=!1)});function oe(){const{currentColumn:o,enabled:a,resetColumn:r,enterColumn:u}=re.useColumn(["hour","minute","second"]),k=n.reactive({hour:0,minute:0,second:0}),C=n.reactive({hour:!1,minute:!1,second:!1});return n.reactive({column:o,enabled:a,activated:C,timeValue:k,resetColumn:r,enterColumn:u})}function f(){return v.value==="start"?d:m}function V(o,a=!0){Array.isArray(o)||(o=[o,o]);for(let r=0;r<2;++r){const u=Ke.exec(o[r]||A),k=r===0?d:m,{activated:C,timeValue:w}=k;if(u){a&&(C.hour=!!u[1],C.minute=!!u[2],C.second=!!u[3]);const $e=parseInt(u[1]),je=u[2]?parseInt(u[2].slice(1)):0,qe=u[3]?parseInt(u[3].slice(1)):0,K=new Date(2e3,1,1,$e,je,qe);w.hour=K.getHours(),w.minute=K.getMinutes(),w.second=K.getSeconds()}else w.hour=0,w.minute=0,w.second=0,a&&(C.hour=!1,C.minute=!1,C.second=!1);if(!t.isRange)break}}function fe(){[d,m].forEach(o=>{o.enabled.hour=t.format.includes("H"),o.enabled.minute=t.format.includes("m"),o.enabled.second=t.format.includes("s")})}function te(o){[d,m].forEach(a=>{Object.keys(a.activated).forEach(r=>{a.activated[r]=o})})}function H(){return Array.isArray(p.value)?p.value.join("|"):p.value}function ve(){(ee.value||t.isRange&&ne.value)&&(h.value?V(h.value.split("|")):V(t.value))}function he(){ve(),h.value!==H()&&(h.value=H(),te(!0),I(p.value),i.emitEvent(t.onChange,p.value),T("update:value",p.value),q())}function D(){t.disabled||(S.value=!0,Z.focus=setTimeout(()=>{var o,a;S.value&&(v.value==="start"?(o=U.value)==null||o.focus():(a=L.value)==null||a.focus())},120))}function W(){var o,a;clearTimeout(Z.focus),S.value=!1,(o=U.value)==null||o.blur(),(a=L.value)==null||a.blur()}function Ce(o){if(t.disabled||t.loading&&t.loadingLock)return;const a=o.target,r=c.value;c.value=!0,D(),!r&&z.value&&a&&(Array.from(z.value.querySelectorAll(`.${l.be("unit")}`)).some(k=>k===a||k.contains(a))||i.emitEvent(t.onChangeCol,f().column,v.value))}function E(){c.value=!1,d.resetColumn(),m.resetColumn()}function be(){t.clearable&&(h.value="",E(),n.nextTick(()=>{V(""),i.emitEvent(t.onChange,p.value),T("update:value",p.value),i.emitEvent(t.onClear),R(p.value),n.nextTick(()=>{te(!1)})}))}function ge(o){c.value&&(f().activated[o]=!0)}function O(o){f().column=o}function Ve(o){const a=f();ke(a.column,o),a.column!=="second"&&a.timeValue[a.column]>=10&&a.enterColumn("next",!1)}function ke(o,a){const r=f(),u=r.timeValue[o];(t.noFiller||r.activated[o])&&u>0&&u<10?r.timeValue[o]=u*10+a:r.timeValue[o]=a,X(o),r.activated[o]=!0,i.emitEvent(t.onInput,o,r.timeValue[o])}function X(o){const a=f().timeValue;a[o]=$.boundRange(a[o],0,o==="hour"?23:59),a[o]=Math.round(a[o]/F(o))*F(o)}function Se(o){const a=f(),r=a.column;a.enabled[r]&&(a.timeValue[r]+=o?ae(r):F(r),X(r),i.emitEvent(t.onPlus,r,a.timeValue[r]))}function Ee(o){const a=f(),r=a.column;a.enabled[r]&&(a.timeValue[r]-=o?ae(r):F(r),X(r),i.emitEvent(t.onMinus,r,a.timeValue[r]))}function F(o){return t.steps[o==="hour"?0:o==="minute"?1:2]||1}function ae(o){return t.ctrlSteps[o==="hour"?0:o==="minute"?1:2]||1}function we(){E(),i.emitEvent(t.onEnter)}function Ne(){V(t.value),E(),i.emitEvent(t.onCancel)}function Te(o){let{value:a,name:r}=t.shortcuts[o];typeof a=="function"&&(a=a()),V(a),i.emitEvent(t.onShortcut,r,a),E()}function y(o){v.value=o}function Pe(o){if(t.isRange){const a=f(),r=a.column;if(a.enterColumn(o,!1),r===a.column){const u=v.value==="start";(u?m:d).resetColumn(o==="prev"?"second":"hour",o==="prev"),y(u?"end":"start")}}else d.enterColumn(o)}function le(o){y("start"),O(o)}function Be(o){y("end"),O(o)}function Ie(){Object.keys(d.timeValue).forEach(o=>{const a=m.timeValue[o];m.timeValue[o]=d.timeValue[o],d.timeValue[o]=a})}function ze(o){t.exchange&&(!c.value&&o.stopPropagation(),Ie())}function Fe(){i.emitEvent(t.onClickOutside),E(),W()}function ye(){const{hour:o,minute:a}=d.enabled;le(o?"hour":a?"minute":"second")}return{ClockR:j.ClockR,props:t,nh:l,locale:Xe.useLocale("timePicker"),idFor:G,isHover:_,currentVisible:c,focused:S,transferTo:ue,lastValue:h,startState:d,endState:m,currentState:v,currentValue:p,className:de,selectorClass:ce,hasPrefix:me,showClear:pe,isTimeDisabled:g,startError:ee,endError:ne,wrapper:z,reference:M,popper:ie,start:U,end:L,handleFocused:D,showPanel:Ce,handleClear:be,handleShortcut:Te,handleWheelChange:ge,handleInputFocus:O,handleInput:Ve,handlePlus:Se,handleMinus:Ee,handleEnter:we,finishInput:E,handleCancel:Ne,toggleCurrentState:y,enterColumn:Pe,handleStartInput:le,handleEndInput:Be,handleExchangeClick:ze,handlePanelClosed:ye,focus:D,blur:W,updatePopper:x}}}),Je=["id"],Qe=["title","onClick"],Ye={style:{display:"flex"}};function Ze(e,s,T,G,J,Q){const b=n.resolveComponent("Icon"),P=n.resolveComponent("TimeControl"),q=n.resolveComponent("ArrowRightArrowLeft"),R=n.resolveComponent("CircleXmark"),B=n.resolveComponent("TimeWheel"),I=n.resolveComponent("Button"),A=n.resolveComponent("Portal");return n.openBlock(),n.createElementBlock("div",{id:e.idFor,ref:"wrapper",class:n.normalizeClass(e.className),onClick:s[14]||(s[14]=(...l)=>e.showPanel&&e.showPanel(...l))},[n.createElementVNode("div",{ref:"reference",class:n.normalizeClass(e.selectorClass),tabindex:"0",onKeydown:s[6]||(s[6]=n.withKeys(n.withModifiers((...l)=>e.showPanel&&e.showPanel(...l),["prevent"]),["space"]))},[e.hasPrefix?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass([e.nh.be("icon"),e.nh.be("prefix")]),style:n.normalizeStyle({color:e.props.prefixColor})},[n.renderSlot(e.$slots,"prefix",{},()=>[n.createVNode(b,{icon:e.props.prefix},null,8,["icon"])])],6)):n.createCommentVNode("",!0),n.createElementVNode("div",{class:n.normalizeClass(e.nh.be("control"))},[n.createVNode(P,{ref:"start","unit-type":e.currentState==="start"?e.startState.column:void 0,enabled:e.startState.enabled,activated:e.startState.activated,"time-value":e.startState.timeValue,steps:e.props.steps,"ctrl-steps":e.props.ctrlSteps,focused:e.focused,visible:e.currentVisible,separator:e.props.separator,filler:e.props.filler,"no-filler":e.props.noFiller,labels:e.props.labels,"has-error":e.startError,onInput:e.handleInput,onPlus:e.handlePlus,onMinus:e.handleMinus,onEnter:e.handleEnter,onCancel:e.handleCancel,onUnitFocus:e.handleStartInput,onPrevUnit:s[0]||(s[0]=l=>e.enterColumn("prev")),onNextUnit:s[1]||(s[1]=l=>e.enterColumn("next"))},null,8,["unit-type","enabled","activated","time-value","steps","ctrl-steps","focused","visible","separator","filler","no-filler","labels","has-error","onInput","onPlus","onMinus","onEnter","onCancel","onUnitFocus"]),e.props.isRange?(n.openBlock(),n.createElementBlock(n.Fragment,{key:0},[n.createElementVNode("div",{class:n.normalizeClass([e.nh.be("exchange"),e.props.exchange?e.nh.bem("exchange","enabled"):""]),onClick:s[2]||(s[2]=(...l)=>e.handleExchangeClick&&e.handleExchangeClick(...l))},[n.renderSlot(e.$slots,"exchange",{},()=>[n.createVNode(b,{style:{"padding-top":"1px"}},{default:n.withCtx(()=>[n.createVNode(q)]),_:1})])],2),n.createVNode(P,{ref:"end","unit-type":e.currentState==="end"?e.endState.column:void 0,enabled:e.endState.enabled,activated:e.endState.activated,"time-value":e.endState.timeValue,steps:e.props.steps,"ctrl-steps":e.props.ctrlSteps,focused:e.focused,visible:e.currentVisible,separator:e.props.separator,filler:e.props.filler,"no-filler":e.props.noFiller,labels:e.props.labels,"has-error":e.endError,onInput:e.handleInput,onPlus:e.handlePlus,onMinus:e.handleMinus,onEnter:e.handleEnter,onCancel:e.handleCancel,onUnitFocus:e.handleEndInput,onPrevUnit:s[3]||(s[3]=l=>e.enterColumn("prev")),onNextUnit:s[4]||(s[4]=l=>e.enterColumn("next"))},null,8,["unit-type","enabled","activated","time-value","steps","ctrl-steps","focused","visible","separator","filler","no-filler","labels","has-error","onInput","onPlus","onMinus","onEnter","onCancel","onUnitFocus"])],64)):n.createCommentVNode("",!0)],2),e.props.noSuffix?e.props.clearable||e.props.loading?(n.openBlock(),n.createElementBlock("div",{key:2,class:n.normalizeClass([e.nh.be("icon"),e.nh.bem("icon","placeholder"),e.nh.be("suffix")])},null,2)):n.createCommentVNode("",!0):(n.openBlock(),n.createElementBlock("div",{key:1,class:n.normalizeClass([e.nh.be("icon"),e.nh.be("suffix")]),style:n.normalizeStyle({color:e.props.suffixColor,opacity:e.showClear||e.props.loading?"0%":""})},[n.renderSlot(e.$slots,"suffix",{},()=>[n.createVNode(b,{icon:e.props.suffix||e.ClockR},null,8,["icon"])])],6)),n.createVNode(n.Transition,{name:e.nh.ns("fade"),appear:""},{default:n.withCtx(()=>[!e.props.disabled&&e.props.clearable&&e.isHover&&e.lastValue?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass([e.nh.be("icon"),e.nh.be("clear")]),onClick:s[5]||(s[5]=n.withModifiers((...l)=>e.handleClear&&e.handleClear(...l),["stop"]))},[n.createVNode(b,null,{default:n.withCtx(()=>[n.createVNode(R)]),_:1})],2)):e.props.loading?(n.openBlock(),n.createElementBlock("div",{key:1,class:n.normalizeClass([e.nh.be("icon"),e.nh.be("loading")])},[n.createVNode(b,{spin:e.props.loadingSpin,pulse:!e.props.loadingSpin,icon:e.props.loadingIcon},null,8,["spin","pulse","icon"])],2)):n.createCommentVNode("",!0)]),_:1},8,["name"])],34),n.createVNode(A,{to:e.transferTo},{default:n.withCtx(()=>[n.createVNode(n.Transition,{name:e.props.transitionName,onAfterLeave:e.handlePanelClosed},{default:n.withCtx(()=>[e.currentVisible?(n.openBlock(),n.createElementBlock("div",{key:0,ref:"popper",class:n.normalizeClass([e.nh.be("popper"),e.nh.bs("vars"),e.transferTo!=="body"&&[e.nh.bem("popper","inherit")]]),onClick:s[13]||(s[13]=n.withModifiers((...l)=>e.handleFocused&&e.handleFocused(...l),["stop"]))},[n.createElementVNode("div",{class:n.normalizeClass(e.nh.be("panel"))},[e.props.shortcuts.length?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass([e.nh.be("list"),e.nh.bem("list","sub")])},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.props.shortcuts,(l,t)=>(n.openBlock(),n.createElementBlock("div",{key:t,class:n.normalizeClass(e.nh.be("shortcut")),title:l.name,onClick:Y=>e.handleShortcut(t)},n.toDisplayString(l.name),11,Qe))),128))],2)):n.createCommentVNode("",!0),n.createElementVNode("div",{class:n.normalizeClass(e.nh.be("list"))},[n.createElementVNode("div",Ye,[n.createVNode(B,{hour:e.startState.timeValue.hour,"onUpdate:hour":s[7]||(s[7]=l=>e.startState.timeValue.hour=l),minute:e.startState.timeValue.minute,"onUpdate:minute":s[8]||(s[8]=l=>e.startState.timeValue.minute=l),second:e.startState.timeValue.second,"onUpdate:second":s[9]||(s[9]=l=>e.startState.timeValue.second=l),"no-arrow":e.props.noArrow,candidate:e.props.candidate,steps:e.props.steps,pointer:e.props.pointer,"disabled-time":e.isTimeDisabled,onChange:e.handleWheelChange,onToggleCol:e.handleStartInput},null,8,["hour","minute","second","no-arrow","candidate","steps","pointer","disabled-time","onChange","onToggleCol"]),e.isRange?(n.openBlock(),n.createBlock(B,{key:0,hour:e.endState.timeValue.hour,"onUpdate:hour":s[10]||(s[10]=l=>e.endState.timeValue.hour=l),minute:e.endState.timeValue.minute,"onUpdate:minute":s[11]||(s[11]=l=>e.endState.timeValue.minute=l),second:e.endState.timeValue.second,"onUpdate:second":s[12]||(s[12]=l=>e.endState.timeValue.second=l),"no-arrow":e.props.noArrow,candidate:e.props.candidate,steps:e.props.steps,pointer:e.props.pointer,"disabled-time":e.isTimeDisabled,onChange:e.handleWheelChange,onToggleCol:e.handleEndInput},null,8,["hour","minute","second","no-arrow","candidate","steps","pointer","disabled-time","onChange","onToggleCol"])):n.createCommentVNode("",!0)]),e.props.noAction?n.createCommentVNode("",!0):(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(e.nh.be("action"))},[n.createVNode(I,{inherit:"",text:"",size:"small",onClick:n.withModifiers(e.handleCancel,["stop"])},{default:n.withCtx(()=>[n.createTextVNode(n.toDisplayString(e.props.cancelText||e.locale.cancel),1)]),_:1},8,["onClick"]),n.createVNode(I,{inherit:"",type:"primary",size:"small",disabled:e.startError||e.endError,onClick:n.withModifiers(e.finishInput,["stop"])},{default:n.withCtx(()=>[n.createTextVNode(n.toDisplayString(e.props.confirmText||e.locale.confirm),1)]),_:1},8,["disabled","onClick"])],2))],2)],2)],2)):n.createCommentVNode("",!0)]),_:1},8,["name","onAfterLeave"])]),_:1},8,["to"])],10,Je)}var xe=Ue(Ge,[["render",Ze]]);module.exports=xe;
