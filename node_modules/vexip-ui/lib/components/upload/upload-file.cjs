"use strict";var e=require("vue");require("../collapse-transition/index.cjs");require("../icon/index.cjs");require("../progress/index.cjs");require("../renderer/index.cjs");var p=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var V=require("@vexip-ui/utils"),T=require("./props.cjs"),g=require("./file-icon.cjs"),y=require("./symbol.cjs"),z=require("../../_virtual/plugin-vue_export-helper.cjs"),w=require("../collapse/collapse-transition.cjs"),R=require("../icon/icon.cjs"),j=require("../progress/progress.cjs"),q=require("../renderer/renderer.cjs"),k=require("../../common/config/src/props.cjs"),F=require("../../common/config/src/namespace.cjs"),S=require("../../common/config/src/locale/index.cjs");const B=/\.(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,E=/^data:image\//;function N(n){if(n.type)return n.type.startsWith("image/");const{name:o,url:a,base64:i}=n;return!!(B.test(o)||a&&(B.test(a)||E.test(a))||i&&E.test(i))}const $=e.defineComponent({name:"UploadFile",components:{CollapseTransition:w,Icon:R,Progress:j,Renderer:q,CircleCheck:p.CircleCheck,CircleExclamation:p.CircleExclamation,Spinner:p.Spinner,EyeR:p.EyeR,TrashCanR:p.TrashCanR},props:T.uploadFileProps,emits:[],setup(n){const o=k.useProps("uploadFile",n,{file:{default:()=>({}),static:!0},iconRenderer:{default:null,isFunc:!0},listType:{default:"name",validator:r=>y.uploadListTypes.includes(r)},loadingText:null,selectToAdd:!1,precision:2,canPreview:{default:N,isFunc:!0}}),a=F.useNameHelper("upload"),i=e.computed(()=>typeof o.iconRenderer=="function"),C=e.computed(()=>o.file.path||o.file.name),b=e.computed(()=>V.toFixed(o.file.percentage,o.precision)),c=e.computed(()=>N(o.file)&&(o.file.url||o.file.base64));function s(r){return r.name.split(".").pop().toLocaleLowerCase()}function f(r){const l=s(r);return l&&g.iconMaps[l]||g.iconMaps.default}function h(r){k.emitEvent(o.onDelete,r)}function d(r){k.emitEvent(o.onPreview,r)}function m(r){if(!r.source)return;const l=new FileReader;l.readAsDataURL(r.source),l.onload=()=>{var u,t;r.status!==y.StatusType.DELETE&&(r.base64=(t=(u=l.result)==null?void 0:u.toString())!=null?t:null)}}return{props:o,nh:a,locale:S.useLocale("upload"),useIconRenderer:i,fileName:C,percentage:b,showThumb:c,getFileIcon:f,handleDelete:h,handlePreview:d,transformfileToBase64:m}}}),D=["title"],I={style:{"margin-bottom":"0.3em"}},P=["src","alt"],L=["disabled"];function M(n,o,a,i,C,b){const c=e.resolveComponent("Renderer"),s=e.resolveComponent("Icon"),f=e.resolveComponent("CircleCheck"),h=e.resolveComponent("CircleExclamation"),d=e.resolveComponent("Spinner"),m=e.resolveComponent("TrashCanR"),r=e.resolveComponent("Progress"),l=e.resolveComponent("CollapseTransition"),u=e.resolveComponent("EyeR");return e.openBlock(),e.createElementBlock("li",{class:e.normalizeClass([n.nh.be("file"),n.nh.bem("file",n.props.listType),n.nh.bem("file",n.props.file.status),n.props.inherit&&n.nh.bem("file","inherit")]),title:n.fileName,tabindex:"-1"},[e.renderSlot(n.$slots,"default",{file:n.props.file,status:n.props.file.status,percentage:n.percentage},()=>{var t;return[n.props.listType==="name"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("div",{class:e.normalizeClass(n.nh.be("label"))},[e.createElementVNode("div",{class:e.normalizeClass([n.nh.be("icon"),n.nh.be("file-icon")])},[e.renderSlot(n.$slots,"icon",{file:n.props.file},()=>[n.useIconRenderer?(e.openBlock(),e.createBlock(c,{key:0,renderer:n.props.iconRenderer,data:{file:n.props.file}},null,8,["renderer","data"])):(e.openBlock(),e.createBlock(s,{key:1,icon:n.getFileIcon(n.props.file)},null,8,["icon"]))])],2),e.createElementVNode("span",{class:e.normalizeClass(n.nh.be("filename"))},e.toDisplayString(n.fileName),3)],2),e.createElementVNode("div",{class:e.normalizeClass(n.nh.be("actions"))},[n.props.file.status==="uploading"?(e.openBlock(),e.createElementBlock("span",{key:0,style:{"margin-right":"0.5em"},class:e.normalizeClass(n.nh.be("percentage"))},e.toDisplayString(`${n.percentage}%`),3)):e.createCommentVNode("",!0),n.props.file.status==="success"?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([n.nh.be("icon"),n.nh.be("success")])},[e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(f)]),_:1})],2)):n.props.file.status==="fail"?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass([n.nh.be("icon"),n.nh.be("fail")])},[e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(h)]),_:1})],2)):n.props.file.status==="uploading"?(e.openBlock(),e.createElementBlock("div",{key:3,class:e.normalizeClass([n.nh.be("icon"),n.nh.be("loading")])},[e.createVNode(s,{pulse:""},{default:e.withCtx(()=>[e.createVNode(d)]),_:1})],2)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:e.normalizeClass([n.nh.be("icon"),n.nh.be("close")]),onClick:o[0]||(o[0]=v=>n.handleDelete(n.props.file))},[e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(m)]),_:1})],2)],2),n.props.file.status==="uploading"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(n.nh.be("progress"))},[e.createVNode(r,{inherit:"","info-type":"none","stroke-width":2,percentage:n.props.file.percentage,precision:n.props.precision},null,8,["percentage","precision"])],2)):e.createCommentVNode("",!0)],64)):n.props.listType==="thumbnail"||n.props.listType==="card"?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(n.nh.be("card"))},[e.createElementVNode("div",{class:e.normalizeClass(n.nh.be("thumbnail"))},[n.props.file.status==="uploading"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n.props.listType==="thumbnail"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(n.nh.be("progress"))},[e.createElementVNode("span",I,e.toDisplayString((t=n.props.loadingText)!=null?t:n.locale.uploading),1),e.createVNode(r,{inherit:"","info-type":"none","stroke-width":2,percentage:n.props.file.percentage,precision:n.props.precision},null,8,["percentage","precision"]),e.createElementVNode("span",{style:{"margin-top":"3px"},class:e.normalizeClass(n.nh.be("percentage"))},e.toDisplayString(`${n.percentage}%`),3)],2)):(e.openBlock(),e.createBlock(s,{key:1,pulse:"",scale:1.8},{default:e.withCtx(()=>[e.createVNode(d)]),_:1},8,["scale"]))],64)):n.showThumb?(e.openBlock(),e.createElementBlock("img",{key:1,class:e.normalizeClass(n.nh.be("image")),src:n.props.file.url||n.props.file.base64||"",alt:n.fileName},null,10,P)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.createTextVNode(e.toDisplayString(n.transformfileToBase64(n.props.file))+" ",1),e.renderSlot(n.$slots,"icon",{file:n.props.file},()=>[n.useIconRenderer?(e.openBlock(),e.createBlock(c,{key:0,renderer:n.props.iconRenderer,data:{file:n.props.file}},null,8,["renderer","data"])):(e.openBlock(),e.createBlock(s,{key:1,icon:n.getFileIcon(n.props.file),scale:2.8},null,8,["icon","scale"]))])],64))],2),n.props.listType==="card"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(n.nh.be("info"))},[e.createElementVNode("span",{class:e.normalizeClass(n.nh.be("filename"))},e.toDisplayString(n.fileName),3),e.createVNode(l,null,{default:e.withCtx(()=>[n.props.file.status==="uploading"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(n.nh.be("progress"))},[e.createVNode(r,{inherit:"","info-type":"none","stroke-width":4,percentage:n.props.file.percentage,precision:n.props.precision},null,8,["percentage","precision"])],2)):e.createCommentVNode("",!0)]),_:1})],2)):e.createCommentVNode("",!0),n.props.listType==="card"||n.props.file.status!=="uploading"?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(n.nh.be("actions"))},[n.props.listType==="thumbnail"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(n.nh.be("mask"))},null,2)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:e.normalizeClass([n.nh.be("icon"),n.nh.be("action"),{[n.nh.bem("action","disabled")]:!n.props.canPreview(n.props.file)}]),disabled:!n.props.canPreview(n.props.file),onClick:o[1]||(o[1]=v=>n.handlePreview(n.props.file))},[e.createVNode(s,{scale:1.4},{default:e.withCtx(()=>[e.createVNode(u)]),_:1},8,["scale"])],10,L),e.createElementVNode("button",{class:e.normalizeClass([n.nh.be("icon"),n.nh.be("action")]),onClick:o[2]||(o[2]=v=>n.handleDelete(n.props.file))},[e.createVNode(s,{scale:1.4},{default:e.withCtx(()=>[e.createVNode(m)]),_:1},8,["scale"])],2)],2)):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)]})],10,D)}var U=z($,[["render",M]]);module.exports=U;
