"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var d=require("@vexip-ui/utils");function f(e,r){const s=`fail to post ${e} ${r.status}'`,a=new Error(s);return a.response=c(r),a.url=e,a.status=r.status,a.method="POST",a}function c(e){const r=e.responseText||e.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}function o(e){var l;if(typeof XMLHttpRequest=="undefined")return null;const r=new XMLHttpRequest,s=e.url;r.upload&&e.onProgress&&(r.upload.onprogress=t=>{let u=0;t.total>0&&(u=t.loaded/t.total*100),e.onProgress(u)});const a=new FormData;if(e.data){const t=e.data;Object.keys(t).forEach(u=>{a.append(u,t[u])})}a.append(e.field||"file",e.file),e.file.path&&a.append(e.pathField||"path",e.file.path),e.onError&&(r.onerror=()=>{e.onError(f(s,r))}),r.onload=()=>{var u;if(r.status<200||r.status>=300){e.onError&&e.onError(f(s,r));return}const t=c(r);(u=e.onSuccess)==null||u.call(e,t)},e.onAbort&&(r.onabort=()=>{e.onAbort()}),r.open("POST",s,!0),e.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const n=(l=e.headers)!=null?l:{};return Object.keys(n).forEach(t=>{d.has(n,t)&&d.isDefined(n[t])&&r.setRequestHeader(t,n[t])}),r.send(a),r}exports.upload=o;
