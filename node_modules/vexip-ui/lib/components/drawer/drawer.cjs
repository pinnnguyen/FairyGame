"use strict";var e=require("vue");require("../button/index.cjs");require("../icon/index.cjs");require("../masker/index.cjs");require("../../common/config/src/index.cjs");var I=require("@vexip-ui/hooks"),d=require("@vexip-ui/utils"),H=require("@vexip-ui/icons"),X=require("./props.cjs"),D=require("../../_virtual/plugin-vue_export-helper.cjs"),W=require("../button/button.cjs"),R=require("../icon/icon.cjs"),P=require("../masker/masker.cjs"),i=require("../../common/config/src/props.cjs"),A=require("../../common/config/src/namespace.cjs"),Y=require("../../common/config/src/locale/index.cjs");const F=Object.freeze(["top","right","bottom","left"]);let L=0;const O=e.defineComponent({name:"Drawer",components:{Button:W,Icon:R,Masker:P,Xmark:H.Xmark},props:X.drawerProps,emits:["update:active"],setup(o,{slots:m,emit:g}){const t=i.useProps("drawer",o,{transfer:!1,active:{default:!1,static:!0},width:{default:280,validator:r=>r>0},height:{default:280,validator:r=>r>0},placement:{default:"right",validator:r=>F.includes(r)},title:"",closable:!0,inner:!1,maskClose:!0,drawerClass:null,hideMask:!1,onBeforeClose:{default:null,isFunc:!0},resizable:!1,autoRemove:!1,footer:!1,confirmText:null,cancelText:null,loading:!1}),a=A.useNameHelper("drawer"),h=e.ref(t.active),s=e.ref(t.width),l=e.ref(t.height),u=e.ref(),f=`${L++}`,{target:p,moving:C}=I.useMoving({onStart:(r,n)=>{if(!t.resizable||n.button>0||!u.value)return!1;const c=`${s.value}`.endsWith("%")?u.value.offsetWidth:d.toNumber(s.value),v=`${l.value}`.endsWith("%")?u.value.offsetHeight:d.toNumber(l.value);r.xStart=c,r.yStart=v,i.emitEvent(t.onResizeStart,{width:c,height:v})},onMove:(r,n)=>{const c=n.clientX-r.clientX,v=n.clientY-r.clientY;let k=d.toNumber(s.value),w=d.toNumber(l.value);switch(t.placement){case"top":{w=r.yStart+v;break}case"right":{k=r.xStart-c;break}case"bottom":{w=r.yStart-v;break}default:k=r.xStart+c}s.value=Math.max(k,100),l.value=Math.max(w,100),i.emitEvent(t.onResizeMove,{width:d.toNumber(s.value),height:d.toNumber(l.value)})},onEnd:()=>{i.emitEvent(t.onResizeEnd,{width:d.toNumber(s.value),height:d.toNumber(l.value)})}}),z=e.computed(()=>[a.b(),a.bs("vars"),{[a.bm("inner")]:t.inner,[a.bm("closable")]:t.closable,[a.bm("resizable")]:t.resizable}]),y=e.computed(()=>a.ns(`move-${t.placement}`)),N=e.computed(()=>[a.be("wrapper"),a.bem("wrapper",t.placement),{[a.bem("wrapper","resizing")]:C.value},t.drawerClass]),S=e.computed(()=>{const r=t.placement;if(r==="top"||r==="bottom"){const c=l.value;return{height:`${c}`.endsWith("%")?c:`${c}px`}}const n=s.value;return{width:`${n}`.endsWith("%")?n:`${n}px`}}),$=e.computed(()=>{var r;return!!((r=m.title)!=null?r:t.title)}),E=e.computed(()=>`${a.bs(f)}__title`),q=e.computed(()=>`${a.bs(f)}__body`);e.watch(()=>t.active,r=>{h.value=r}),e.watch(h,r=>{i.emitEvent(t.onToggle,r),g("update:active",r)}),e.watch(()=>t.width,r=>{s.value=r}),e.watch(()=>t.height,r=>{l.value=r});async function b(r=!1){let n=!0;return typeof t.onBeforeClose=="function"&&(n=t.onBeforeClose(r),d.isPromise(n)&&(n=await n)),n!==!1&&e.nextTick(()=>{h.value=!1,i.emitEvent(t.onClose)}),n}function B(){if(t.maskClose)return b()}function V(){i.emitEvent(t.onShow)}function j(){i.emitEvent(t.onHide)}function T(){b(!0),i.emitEvent(t.onConfirm)}function M(){b(!1),i.emitEvent(t.onCancel)}return{props:t,nh:a,locale:Y.useLocale("modal"),currentActive:h,resizing:C,className:z,moveTransition:y,wrapperClass:N,wrapperStyle:S,hasTitle:$,titleId:E,bodyId:q,wrapper:u,resizer:p,handleClose:b,handleMaskClose:B,handleShow:V,handleHide:j,handleConfirm:T,handleCancle:M}}}),U=["aria-modal","aria-labelledby","aria-describedby"],G=["id"],J=["id"];function K(o,m,g,t,a,h){const s=e.resolveComponent("Xmark"),l=e.resolveComponent("Icon"),u=e.resolveComponent("Button"),f=e.resolveComponent("Masker");return e.openBlock(),e.createBlock(f,{active:o.currentActive,"onUpdate:active":m[1]||(m[1]=p=>o.currentActive=p),inherit:o.props.inherit,class:e.normalizeClass(o.className),inner:o.props.inner,"transition-name":o.moveTransition,closable:o.props.maskClose,disabled:o.props.hideMask,"on-before-close":o.handleMaskClose,transfer:o.props.transfer,"auto-remove":o.props.autoRemove,onShow:o.handleShow,onHide:o.handleHide},{default:e.withCtx(({show:p})=>[e.withDirectives(e.createElementVNode("section",{ref:"wrapper",class:e.normalizeClass(o.wrapperClass),style:e.normalizeStyle(o.wrapperStyle),role:"dialog","aria-modal":p?"true":void 0,"aria-labelledby":o.titleId,"aria-describedby":o.bodyId},[o.hasTitle?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(o.nh.be("header"))},[e.createElementVNode("div",{id:o.titleId,class:e.normalizeClass(o.nh.be("title"))},[e.renderSlot(o.$slots,"title",{},()=>[e.createTextVNode(e.toDisplayString(o.props.title),1)])],10,G),o.props.closable?(e.openBlock(),e.createElementBlock("button",{key:0,class:e.normalizeClass(o.nh.be("close")),onClick:m[0]||(m[0]=C=>o.handleClose())},[e.renderSlot(o.$slots,"close",{},()=>[e.createVNode(l,{scale:1.2,label:"close"},{default:e.withCtx(()=>[e.createVNode(s)]),_:1},8,["scale"])])],2)):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0),e.createElementVNode("div",{id:o.bodyId,class:e.normalizeClass(o.nh.be("content"))},[e.renderSlot(o.$slots,"default")],10,J),o.props.footer||o.$slots.footer?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(o.nh.be("footer"))},[e.renderSlot(o.$slots,"footer",{},()=>[e.createVNode(u,{inherit:"",text:"",size:"small",onClick:o.handleCancle},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.props.cancelText||o.locale.cancel),1)]),_:1},8,["onClick"]),e.createVNode(u,{inherit:"",type:"primary",size:"small",loading:o.props.loading,onClick:o.handleConfirm},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.props.confirmText||o.locale.confirm),1)]),_:1},8,["loading","onClick"])])],2)):e.createCommentVNode("",!0),o.props.resizable?(e.openBlock(),e.createElementBlock("div",{key:2,ref:"resizer",class:e.normalizeClass([o.nh.be("handler"),o.nh.bem("handler",o.props.placement),{[o.nh.bem("handler","resizing")]:o.resizing}])},[e.renderSlot(o.$slots,"handler",{resizing:o.resizing})],2)):e.createCommentVNode("",!0)],14,U),[[e.vShow,p]])]),_:3},8,["active","inherit","class","inner","transition-name","closable","disabled","on-before-close","transfer","auto-remove","onShow","onHide"])}var Q=D(O,[["render",K]]);module.exports=Q;
