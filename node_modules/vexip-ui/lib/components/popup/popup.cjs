"use strict";var o=require("vue"),x=require("./popup-item.cjs");require("../../common/config/src/index.cjs");var a=require("@vexip-ui/utils"),E=require("./symbol.cjs"),S=require("../../_virtual/plugin-vue_export-helper.cjs"),$=require("../../common/config/src/props.cjs"),B=require("../../common/config/src/namespace.cjs");const F=Object.freeze(["top-right","top-center","top-left","bottom-right","bottom-center","bottom-left"]);let N=0;function _(){return N++}const w=o.defineComponent({name:"Popup",components:{PopupItem:x},props:{transitionName:{type:String,default:null},innerClass:{type:$.classProp,default:null},startOffset:{type:Number,default:30},placement:{default:"top-right",validator:r=>F.includes(r)},itemOffset:{type:Number,default:16}},setup(r){const f=B.useNameHelper("popup"),i=o.ref([]),u=[],g=o.ref();let c=!1;const v=o.computed(()=>r.placement.split("-")),p=o.computed(()=>r.transitionName||f.ns("popup-top"));o.provide(E.DELETE_HANDLER,P),o.watch(()=>r.startOffset,(e,t)=>{i.value.forEach(n=>{n.verticalPosition+=e-t})});function d(e){const[t,n]=v.value,s={[t]:`${e.verticalPosition}px`};return n==="center"?(s.left="50%",s.transform="translateX(-50%)"):s[n]="24px",s}function k(e){return new Promise(t=>{const n=a.isFunction(e.onOpen)?e.onOpen:a.noop;e.onOpen=s=>{t(s),n()},u.push({type:"add",param:e}),c||(c=!0,h())})}function O(e){return new Promise(t=>{const n=y(e);if(!n)return t(!1);const s=a.isFunction(n.onClose)?n.onClose:a.noop;n.onClose=l=>{t(l),s(l)},u.push({type:"clear",param:e}),c||(c=!0,h())})}function h(){if(u.length){const e=u.shift();e.type==="add"?C(e.param):I(e.param),requestAnimationFrame(h)}else c=!1}function C(e){var n;let t=e.key?y(e.key):null;if(!(t!=null&&t.visible)){const s=_(),l=(n=e.key)!=null?n:f.bs(`${s}`);let m=r.startOffset;i.value.forEach(b=>{b.visible&&(m+=b.height+r.itemOffset)}),t=o.reactive(Object.assign({key:l,content:"",closable:!1,onOpen:a.noop,onClose:a.noop},e,{height:0,visible:!0,verticalPosition:m})),i.value.push(t)}a.isFunction(e.onOpen)&&e.onOpen(t.key)}function I(e){const t=i.value.findIndex(n=>n.key===e);if(~t){const n=i.value[t],s=n.height;n.visible=!1;for(let l=t+1,m=i.value.length;l<m;++l)i.value[l].verticalPosition-=s+r.itemOffset;a.isFunction(n.onClose)&&n.onClose(!0)}}function P(e){const t=i.value.findIndex(n=>n.key===e);~t&&i.value.splice(t,1)}function q(e){return!~i.value.findIndex(t=>t.key===e)}function y(e){return i.value.find(t=>t.key===e)}function j(){u.length=0,i.value=[]}return{nh:f,items:i,transition:p,wrapper:g,getItemStyle:d,add:k,remove:O,has:q,find:y,clear:j}}});function z(r,f,i,u,g,c){const v=o.resolveComponent("PopupItem");return o.openBlock(),o.createElementBlock("div",{class:o.normalizeClass([r.nh.b(),r.nh.bm(r.placement)])},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(r.items,p=>(o.openBlock(),o.createBlock(v,{key:p.key,ref_for:!0,ref:"instances",state:p,"transition-name":r.transition,"inner-class":r.innerClass,style:o.normalizeStyle(r.getItemStyle(p))},{default:o.withCtx(({item:d})=>[o.renderSlot(r.$slots,"item",{item:d})]),_:2},1032,["state","transition-name","inner-class","style"]))),128))],2)}var H=S(w,[["render",z]]);module.exports=H;
