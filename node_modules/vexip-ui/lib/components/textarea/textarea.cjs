"use strict";var o=require("vue");require("../icon/index.cjs");require("../form/index.cjs");var N=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var k=require("@vexip-ui/utils"),S=require("./props.cjs"),$=require("../../_virtual/plugin-vue_export-helper.cjs"),z=require("../icon/icon.cjs"),P=require("../form/helper.cjs"),u=require("../../common/config/src/props.cjs"),D=require("../../common/config/src/namespace.cjs"),R=require("../../common/config/src/locale/index.cjs");const T=o.defineComponent({name:"Textarea",components:{Icon:z},props:S.textareaProps,emits:["update:value"],setup(e,{emit:l}){const{idFor:f,state:g,disabled:y,loading:b,validateField:i,getFieldValue:d,setFieldValue:r}=P.useFieldStore(()=>{var a;return(a=E.value)==null?void 0:a.focus()}),n=u.useProps("textarea",e,{state:u.createStateProp(g),value:{default:()=>d(""),static:!0},placeholder:null,rows:2,noResize:!1,autofocus:!1,spellcheck:!1,autocomplete:!1,readonly:!1,disabled:()=>y.value,debounce:!1,maxLength:0,loading:()=>b.value,loadingIcon:N.Spinner,loadingLock:!1,loadingSpin:!1,sync:!1}),t=D.useNameHelper("textarea"),p=o.ref(!1),s=o.ref(n.value),C=o.ref(n.value?n.value.length:0),E=o.ref();let c=n.value;const K=o.computed(()=>({[t.b()]:!0,[t.ns("input-vars")]:!0,[t.bs("vars")]:!0,[t.bm("inherit")]:n.inherit,[t.bm("focused")]:p.value,[t.bm("disabled")]:n.disabled,[t.bm("loading")]:n.loading&&n.loadingLock,[t.bm("no-resize")]:n.noResize,[t.bm(n.state)]:n.state!=="default"})),V=o.computed(()=>n.loading&&n.loadingLock||n.readonly);o.watch(()=>n.value,a=>{s.value=a,c=a});function L(a){p.value=!0,u.emitEvent(n.onFocus,a)}function q(a){p.value=!1,u.emitEvent(n.onBlur,a)}function m(a){const v=a.type,h=a.target.value;if(n.maxLength&&h.length>n.maxLength?s.value=h.slice(0,n.maxLength):s.value=h,C.value=s.value.length,a.target.value=s.value,v==="change"){if(c===s.value)return;c=s.value,r(s.value),u.emitEvent(n.onChange,s.value),n.sync||(l("update:value",s.value),i())}else u.emitEvent(n.onInput,s.value),n.sync&&(l("update:value",s.value),i())}function w(){u.emitEvent(n.onEnter)}function B(a){u.emitEvent(n.onKeyDown,a)}function F(a){u.emitEvent(n.onKeyPress,a)}function j(a){u.emitEvent(n.onKeyUp,a)}function I(){const a=document.createElement("textarea");a.style.height="0",a.setAttribute("readonly","readonly"),a.value=s.value,document.body.appendChild(a),a.select();const v=document.execCommand("copy");return document.body.removeChild(a),v}return{props:n,nh:t,locale:R.useLocale("input"),idFor:f,currentValue:s,currentLength:C,className:K,isReadonly:V,textarea:E,handleFocus:L,handleBlur:q,handleInput:n.debounce?k.debounce(m):k.throttle(m),handleChange:m,handleEnter:w,handleKeyDown:B,handleKeyPress:F,handleKeyUp:j,copyValue:I}}}),U=["id"],H=["value","rows","autofocus","autocomplete","spellcheck","disabled","readonly","placeholder","maxlength"];function A(e,l,f,g,y,b){var d;const i=o.resolveComponent("Icon");return o.openBlock(),o.createElementBlock("div",{id:e.idFor,class:o.normalizeClass(e.className),onClick:l[8]||(l[8]=r=>{var n;return(n=e.textarea)==null?void 0:n.focus()})},[o.createElementVNode("textarea",{ref:"textarea",class:o.normalizeClass(e.nh.be("control")),value:e.currentValue,rows:e.props.rows,autofocus:e.props.autofocus,autocomplete:e.props.autocomplete?"on":"off",spellcheck:e.props.spellcheck,disabled:e.props.disabled,readonly:e.isReadonly,placeholder:(d=e.props.placeholder)!=null?d:e.locale.placeholder,maxlength:e.props.maxLength>0?e.props.maxLength:void 0,onBlur:l[0]||(l[0]=(...r)=>e.handleBlur&&e.handleBlur(...r)),onFocus:l[1]||(l[1]=(...r)=>e.handleFocus&&e.handleFocus(...r)),onKeyup:[l[2]||(l[2]=o.withKeys((...r)=>e.handleEnter&&e.handleEnter(...r),["enter"])),l[3]||(l[3]=(...r)=>e.handleKeyUp&&e.handleKeyUp(...r))],onKeypress:l[4]||(l[4]=(...r)=>e.handleKeyPress&&e.handleKeyPress(...r)),onKeydown:l[5]||(l[5]=(...r)=>e.handleKeyDown&&e.handleKeyDown(...r)),onInput:l[6]||(l[6]=(...r)=>e.handleInput&&e.handleInput(...r)),onChange:l[7]||(l[7]=(...r)=>e.handleChange&&e.handleChange(...r))},null,42,H),o.createElementVNode("div",{class:o.normalizeClass(e.nh.be("extra"))},[o.createVNode(o.Transition,{name:e.nh.ns("fade"),appear:""},{default:o.withCtx(()=>[e.props.loading?(o.openBlock(),o.createElementBlock("div",{key:0,class:o.normalizeClass(e.nh.be("loading"))},[o.createVNode(i,{spin:e.props.loadingSpin,pulse:!e.props.loadingSpin,icon:e.props.loadingIcon},null,8,["spin","pulse","icon"])],2)):o.createCommentVNode("",!0)]),_:1},8,["name"]),e.props.maxLength>0?(o.openBlock(),o.createElementBlock("div",{key:0,class:o.normalizeClass(e.nh.be("count"))},[o.renderSlot(e.$slots,"count",{value:e.currentValue},()=>[o.createTextVNode(o.toDisplayString(`${e.currentLength}/${e.props.maxLength}`),1)])],2)):o.createCommentVNode("",!0)],2)],10,U)}var G=$(T,[["render",A]]);module.exports=G;
