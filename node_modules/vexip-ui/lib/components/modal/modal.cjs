"use strict";var e=require("vue");require("../button/index.cjs");require("../icon/index.cjs");require("../masker/index.cjs");require("../../common/config/src/index.cjs");var W=require("@vexip-ui/hooks"),v=require("@vexip-ui/utils"),Q=require("@vexip-ui/icons"),Y=require("./props.cjs"),Z=require("../../_virtual/plugin-vue_export-helper.cjs"),_=require("../button/button.cjs"),ee=require("../icon/icon.cjs"),te=require("../masker/masker.cjs"),oe=require("../../common/config/src/namespace.cjs"),a=require("../../common/config/src/props.cjs"),ne=require("../../common/config/src/locale/index.cjs");const D=o=>o==="auto"||!Number.isNaN(parseFloat(o)),h={default:"auto",validator:D};let re=0;const ae=e.defineComponent({name:"Modal",components:{Button:_,Icon:ee,Masker:te,Xmark:Q.Xmark},props:Y.modalProps,emits:["update:active"],setup(o,{slots:m,emit:M}){const r=oe.useNameHelper("modal"),t=a.useProps("modal",o,{transfer:!1,active:{default:!1,static:!0},width:h,height:h,top:{default:100,validator:D},left:h,right:h,bottom:h,title:"",closable:!0,inner:!1,maskClose:!0,modalClass:null,modalStyle:null,noFooter:!1,hideMask:!1,draggable:!1,resizable:!1,onBeforeClose:{default:null,isFunc:!0},loading:!1,minWidth:150,minHeight:120,transitionName:()=>r.ns("ease"),confirmText:null,cancelText:null,autoRemove:!1}),p=e.ref(t.active),s=e.ref(v.toNumber(t.top)),u=e.ref(v.toNumber(t.left)),i=e.ref(b(t.width)),l=e.ref(b(t.height)),f=`${re++}`;let g=!1,S=!1;const c=e.ref(),z=e.ref(),{target:N,moving:$}=W.useMoving({onStart:(n,d)=>{if(!t.draggable||d.button>0)return!1;n.xStart=u.value,n.yStart=s.value,a.emitEvent(t.onDragStart,{top:s.value,left:u.value})},onMove:n=>{u.value=n.xEnd,s.value=n.yEnd,a.emitEvent(t.onDragMove,{top:s.value,left:u.value})},onEnd:()=>{a.emitEvent(t.onDragEnd,{top:s.value,left:u.value})}}),{target:P,moving:V}=W.useMoving({onStart:(n,d)=>{var B,T,j,I;if(!t.resizable||d.button>0)return!1;let y,E,H=32;i.value==="auto"?y=(T=(B=c.value)==null?void 0:B.offsetWidth)!=null?T:0:y=i.value,l.value==="auto"?E=(I=(j=c.value)==null?void 0:j.offsetHeight)!=null?I:0:E=l.value,N.value&&(H+=N.value.offsetHeight),z.value&&(H+=z.value.offsetHeight),n.xStart=y,n.yStart=E,n.minHeight=Math.max(H,t.minHeight),a.emitEvent(t.onResizeStart,{width:y,height:E})},onMove:n=>{i.value=n.xEnd,l.value=n.yEnd,i.value=Math.max(t.minWidth,n.xEnd),l.value=Math.max(n.minHeight,n.yEnd),a.emitEvent(t.onResizeMove,{width:i.value,height:l.value})},onEnd:()=>{a.emitEvent(t.onResizeEnd,{width:i.value,height:l.value})}}),R=e.computed(()=>[r.b(),r.bs("vars"),{[r.bm("inner")]:t.inner,[r.bm("draggable")]:t.draggable,[r.bm("resizable")]:t.resizable}]),F=e.computed(()=>[r.be("wrapper"),{[r.bem("wrapper","closable")]:t.closable,[r.bem("wrapper","dragging")]:$.value,[r.bem("wrapper","resizing")]:V.value},t.modalClass]),L=e.computed(()=>{const n=l.value!=="auto";return[t.modalStyle,{top:`${s.value}px`,right:n||!t.right||t.right==="auto"?void 0:`${t.right}px`,bottom:n||!t.bottom||t.bottom==="auto"?void 0:`${t.bottom}px`,left:`${u.value}px`,width:`${i.value}px`,height:n?`${l.value}px`:void 0}]}),X=e.computed(()=>!!(m.header||t.title)),A=e.computed(()=>`${r.bs(f)}__title`),U=e.computed(()=>`${r.bs(f)}__body`);e.watch(()=>t.active,n=>{p.value=n}),e.watch(p,n=>{a.emitEvent(t.onToggle,n),M("update:active",n),n&&e.nextTick(()=>{C(),w()})}),e.watch(()=>t.top,()=>{g=!1,p.value&&C()}),e.watch(()=>t.left,()=>{S=!1,p.value&&w()}),e.watch(()=>t.width,n=>{i.value=b(n),w()}),e.watch(()=>t.height,n=>{l.value=b(n),C()}),e.onMounted(()=>{e.nextTick(()=>{p.value&&(C(),w())})});function b(n){return n==="auto"?"auto":v.toNumber(n)}function q(){if(!c.value)return document.body;let n=c.value.parentElement;for(;n&&n!==document.body;){if(getComputedStyle(n).position!=="static")return n;n=n.parentElement}return n}function C(){if(!c.value||g)return;const n=c.value.offsetHeight;t.top==="auto"&&t.inner?s.value=(q().offsetHeight-n)/2:s.value=t.top==="auto"?(window.innerHeight-n)/2-20:v.toNumber(t.top),g=!0}function w(){if(!c.value||S)return;const n=c.value.offsetWidth;t.left==="auto"&&t.inner?u.value=(q().offsetWidth-n)/2:u.value=t.left==="auto"?(window.innerWidth-n)/2:v.toNumber(t.left),S=!0}function x(){k(!0),a.emitEvent(t.onConfirm)}function G(){k(!1),a.emitEvent(t.onCancel)}async function k(n){let d=!0;return typeof t.onBeforeClose=="function"&&(d=t.onBeforeClose(n),v.isPromise(d)&&(d=await d)),d!==!1&&e.nextTick(()=>{p.value=!1,a.emitEvent(t.onClose)}),d}function J(){a.emitEvent(t.onShow)}function K(){a.emitEvent(t.onHide)}function O(){if(t.maskClose)return k(!1)}return{props:t,nh:r,locale:ne.useLocale("modal"),currentActive:p,dragging:$,resizing:V,titleId:A,bodyId:U,className:R,wrapperClass:F,wrapperStyle:L,hasTitle:X,wrapper:c,header:N,footer:z,resizer:P,handleConfirm:x,handleCancle:G,handleClose:k,handleShow:J,handleHide:K,handleMaskClose:O}}}),ie=["aria-modal","aria-labelledby","aria-describedby"],le=["id"],se=["id"];function ue(o,m,M,r,t,p){const s=e.resolveComponent("Xmark"),u=e.resolveComponent("Icon"),i=e.resolveComponent("Button"),l=e.resolveComponent("Masker");return e.openBlock(),e.createBlock(l,{active:o.currentActive,"onUpdate:active":m[2]||(m[2]=f=>o.currentActive=f),inherit:o.props.inherit,class:e.normalizeClass(o.className),inner:o.props.inner,"transition-name":o.props.transitionName,closable:o.props.maskClose,disabled:o.props.hideMask,"on-before-close":o.handleMaskClose,transfer:o.props.transfer,"auto-remove":o.props.autoRemove,onShow:o.handleShow,onHide:o.handleHide},{default:e.withCtx(({show:f})=>[e.withDirectives(e.createElementVNode("section",{ref:"wrapper",class:e.normalizeClass(o.wrapperClass),role:"dialog",style:e.normalizeStyle(o.wrapperStyle),"aria-modal":f?"true":void 0,"aria-labelledby":o.titleId,"aria-describedby":o.bodyId},[o.hasTitle?(e.openBlock(),e.createElementBlock("div",{key:0,ref:"header",class:e.normalizeClass(o.nh.be("header"))},[e.renderSlot(o.$slots,"header",{},()=>[e.createElementVNode("div",{id:o.titleId,class:e.normalizeClass(o.nh.be("title"))},[e.renderSlot(o.$slots,"title",{},()=>[e.createTextVNode(e.toDisplayString(o.props.title),1)])],10,le),o.props.closable?(e.openBlock(),e.createElementBlock("button",{key:0,class:e.normalizeClass(o.nh.be("close")),onMousedown:m[0]||(m[0]=e.withModifiers(()=>{},["stop"])),onClick:m[1]||(m[1]=g=>o.handleClose(!1))},[e.renderSlot(o.$slots,"close",{},()=>[e.createVNode(u,{scale:1.2,label:"close"},{default:e.withCtx(()=>[e.createVNode(s)]),_:1},8,["scale"])])],34)):e.createCommentVNode("",!0)])],2)):e.createCommentVNode("",!0),e.createElementVNode("div",{id:o.bodyId,class:e.normalizeClass(o.nh.be("content")),style:e.normalizeStyle({overflow:o.resizing?"hidden":void 0})},[e.renderSlot(o.$slots,"default")],14,se),o.props.noFooter?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:1,ref:"footer",class:e.normalizeClass(o.nh.be("footer"))},[e.renderSlot(o.$slots,"footer",{},()=>[e.createVNode(i,{inherit:"",text:"",size:"small",onClick:o.handleCancle},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.props.cancelText||o.locale.cancel),1)]),_:1},8,["onClick"]),e.createVNode(i,{inherit:"",type:"primary",size:"small",loading:o.props.loading,onClick:o.handleConfirm},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.props.confirmText||o.locale.confirm),1)]),_:1},8,["loading","onClick"])])],2)),o.props.resizable?(e.openBlock(),e.createElementBlock("div",{key:2,ref:"resizer",class:e.normalizeClass(o.nh.be("resizer"))},null,2)):e.createCommentVNode("",!0)],14,ie),[[e.vShow,f]])]),_:3},8,["active","inherit","class","inner","transition-name","closable","disabled","on-before-close","transfer","auto-remove","onShow","onHide"])}var de=Z(ae,[["render",ue]]);module.exports=de;
