"use strict";var t=require("vue");require("../resize-observer/index.cjs");require("../../common/config/src/index.cjs");var A=require("@vexip-ui/utils"),D=require("./props.cjs"),j=require("../../common/config/src/props.cjs"),H=require("../../common/config/src/namespace.cjs"),F=require("../resize-observer/resize-observer.cjs");function M(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!t.isVNode(m)}const _=t.createTextVNode("").type;var $=t.defineComponent({name:"Overflow",inheritAttrs:!1,props:D.overflowProps,emits:[],setup(m,{attrs:w,slots:c,expose:T}){const n=j.useProps("overflow",m,{items:{default:null,static:!0},tag:"div",attrFlag:!1,static:!1,maxCount:0}),g=H.useNameHelper("overflow"),u=t.ref(0),h=t.ref(),f=t.ref(),V=t.ref(),k=t.computed(()=>[g.b(),g.bs("vars"),{[g.bm("inherit")]:n.inherit,[g.bm("manual")]:n.maxCount>0}]),R=t.computed(()=>n.attrFlag?n.attrFlag===!0?"hidden":n.attrFlag:!1);t.watch([()=>{var e;return(e=n.items)==null?void 0:e.length},()=>n.maxCount],()=>{t.nextTick(d)}),T({refresh:d}),t.onMounted(d);function y(e,o){R.value?o?e.removeAttribute(R.value):e.setAttribute(R.value,""):o?e.style.display="":e.style.display="none"}function z(e){const o=getComputedStyle(e),i=parseFloat(o.marginLeft)||0,a=parseFloat(o.marginRight)||0;return i+a}function L(e){const o=getComputedStyle(e),i=parseFloat(o.paddingLeft)||0,a=parseFloat(o.paddingRight)||0;return i+a}function P(e){return e.offsetWidth+z(e)}let q=!1,O=u.value;function d(){const e=f.value;if(!h.value||!e)return;y(e,!0);const o=h.value.children,i=o.length;let a=!1;if(n.maxCount>0){for(let r=0,b=i-1;r<b;++r){const N=o[r];N.style.display=r<n.maxCount?"":"none"}n.maxCount>i-1?(y(e,!1),u.value=0):(u.value=i-1-n.maxCount,a=u.value>0),E(a);return}const s=V.value,x=h.value.offsetWidth-L(h.value),C=[];let l=s?s.offsetWidth:0;const W=z(e),p=i-(s?2:1);for(let r=0;r<p;++r){if(r<0)continue;const b=o[r];if(a){y(b,!1);continue}else y(b,!0);const N=P(b);if(l+=N,C[r]=N,l>x){for(let v=r;v>=0;--v)if(u.value=p-v,l-=C[v],l+e.offsetWidth+W<=x||!v){a=!0,r=v-1,s&&(s.style.maxWidth=r===-1?`${x-e.offsetWidth}px`:"");break}}}E(a)}function E(e){O!==u.value&&(O=u.value,j.emitEvent(n.onRestChange,u.value)),f.value&&y(f.value,e),e!==q&&(q=e,j.emitEvent(n.onToggle,e))}function S(e){e?f.value=e.nextElementSibling:f.value=void 0}return()=>{var l;let e;const o=n.tag||"div",i=c.default,a=n.static,s=((l=c.counter)==null?void 0:l.call(c,{count:u.value})[0])||null,x=()=>(s==null?void 0:s.type)===_?t.createVNode("span",null,[s]):s,C=()=>t.createVNode(o,t.mergeProps({ref:h},w,{class:k.value}),{default:()=>[i&&A.isDefined(n.items)?n.items.map((W,p)=>{const r=i({item:W,index:p})[0];return a?(r.key=p,r):t.createVNode(F,{key:p,onResize:d},{default:()=>r})}):i==null?void 0:i(),s?t.createVNode(t.Fragment,{ref:S},[x()]):t.createVNode("span",{ref:f,style:{display:"inline-block"}},null),c.suffix?t.createVNode(F,{onResize:d},{default:()=>[t.createVNode("div",{ref:V,class:g.be("suffix")},[c.suffix()])]}):null]});return t.createVNode(F,{onResize:d},M(e=C())?e:{default:()=>[e]})}}});module.exports=$;
