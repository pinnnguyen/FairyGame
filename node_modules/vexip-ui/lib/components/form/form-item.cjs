"use strict";var e=require("vue");require("../column/index.cjs");require("../icon/index.cjs");require("../tooltip/index.cjs");var X=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var d=require("@vexip-ui/utils"),Y=require("./props.cjs"),Z=require("./validator.cjs"),m=require("./helper.cjs"),g=require("./symbol.cjs"),x=require("../../_virtual/plugin-vue_export-helper.cjs"),_=require("../row/column.cjs"),ee=require("../icon/icon.cjs"),le=require("../tooltip/tooltip.cjs"),re=require("../../common/config/src/namespace.cjs"),oe=require("../../common/config/src/props.cjs"),z=require("../../common/config/src/locale/index.cjs");const te=e.defineComponent({name:"FormItem",components:{Column:_,Icon:ee,Tooltip:le,CircleQuestionR:X.CircleQuestionR},inheritAttrs:!0,props:Y.formItemProps,setup(l,{slots:f}){const n=re.useNameHelper("form"),o=oe.useProps("formItem",l,{label:{default:"",static:!0},prop:{default:"",static:!0},rules:()=>[],labelWidth:null,required:!1,htmlFor:{default:null,static:!0},errorTransition:()=>n.ns("fade"),defaultValue:{default:null,static:!0},hideErrorTip:!1,validateAll:null,hideAsterisk:null,hideLabel:null,action:!1,help:"",pure:!1,span:24,offset:null,push:null,pull:null,order:null,xs:null,sm:null,md:null,lg:null,xl:null,xxl:null,flex:null}),t=e.inject(g.FORM_PROPS,{}),v=e.inject(g.FORM_ACTIONS,null),i=e.inject(g.FORM_FIELDS,null),h=d.createEventEmitter(),b=z.useLocale("form"),s=e.ref(o.defaultValue),p=e.ref(!1),A=e.ref(""),C=e.ref(!1),V=e.ref(!1),T=e.ref(0),q=e.ref(),k=e.computed(()=>t.allRequired||o.required),O=e.computed(()=>z.makeSentence(`${o.label||o.prop} ${b.value.notNullable}`)),F=e.computed(()=>{var c;if(!o.prop)return[];const r=k.value?[{required:k.value,message:O.value}]:[],a=Array.isArray(o.rules)?o.rules:[o.rules];let u=[];return t.rules&&(u=(c=m.getValueByPath(t.rules,o.prop))!=null?c:[]),u=Array.isArray(u)?u:[u],r.concat(u,a)}),y=e.computed(w),W=e.computed(()=>{var r;return d.isNull(o.validateAll)?(r=t.validateAll)!=null?r:!1:o.validateAll}),I=e.computed(()=>{if(o.hideAsterisk===!0||t.hideAsterisk)return!1;for(const r of F.value)if(r.required)return!0;return k.value}),N=e.computed(()=>o.action||o.hideLabel===!0||t.hideLabel),S=e.computed(()=>!(N.value||!(o.label||f.label))),j=e.computed(()=>t.labelAlign?P(t.labelAlign==="top"||N.value?0:o.labelWidth||t.labelWidth||80):P(N.value?0:o.labelWidth||80)),D=e.computed(()=>({[n.be("item")]:!0,[n.bs("vars")]:!0,[n.bem("item","inherit")]:i||o.inherit,[n.bem("item","required")]:!t.hideAsterisk&&I.value,[n.bem("item","error")]:p.value,[n.bem("item","action")]:o.action,[n.bem("item","padding")]:t.inline&&t.labelAlign==="top"&&!S.value})),M=e.computed(()=>({width:t.labelAlign==="top"?void 0:`calc(100% - ${j.value}px)`,marginLeft:S.value||t.labelAlign==="top"?void 0:`${j.value}px`})),Q=e.computed(()=>{const r=y.value;return Array.isArray(r)||typeof r=="object"?JSON.stringify(r):r}),E=new Set,R=Object.freeze({prop:e.computed(()=>o.prop),idFor:e.computed(()=>o.prop),state:e.computed(()=>p.value?"error":"default"),disabled:e.computed(()=>!!t.disabled),loading:e.computed(()=>!!t.loading),size:e.computed(()=>t.size||"default"),emitter:h,labelWidth:T,validate:J,clearError:B,reset:U,getValue:w,setValue:H,sync:r=>{E.size&&console.warn("[vexip-ui:Form]: must only be one control component under FormItem."),E.add(r)},unsync:r=>{E.delete(r)}});e.provide(g.FIELD_OPTIONS,R),e.watch(()=>o.defaultValue,r=>{s.value=r}),e.onMounted(()=>{const r=y.value;d.isNull(s.value)&&(s.value=Array.isArray(r)?Array.from(r):r),q.value&&(T.value=d.getRangeWidth(q.value)),i&&i.add(R)}),e.onBeforeUnmount(()=>{i&&i.delete(R)});function P(r){return r==="auto"?(v==null?void 0:v.getLabelWidth())||80:r}let $=!1;function w(r){if(!t.model||!o.prop)return r;try{const a=m.getValueByPath(t.model,o.prop,!0);return $=!0,a}catch{return $||(m.setValueByPath(t.model,o.prop,r,!1),$=!0),r}}function H(r,a=!1){if(!(!t.model||!o.prop))try{return m.setValueByPath(t.model,o.prop,r,a)}catch{}}function J(){return G()}function B(){p.value=!1,A.value=""}function U(){if(B(),!t.model||!o.prop)return!1;const r=y.value;let a;return Array.isArray(r)?a=Array.isArray(s.value)?Array.from(s.value):[]:a=d.isFunction(s.value)?s.value():s.value,a!==r&&(V.value=!0),m.setValueByPath(t.model,o.prop,a,!0)}async function G(){if(V.value)return V.value=!1,L(null);if(!o.prop||!t.model||C.value)return L(null);C.value=!0;const r=y.value,a=F.value,u=t.model;let c=await Z.validate(a,r,u,W.value,b.value.validateFail);return c=c.length?c:null,L(c)}function L(r){return C.value=!1,r?(p.value=!0,A.value=Array.isArray(r)?r[0]:r):B(),r}function K(){h.emit("focus")}return{props:o,nh:n,isError:p,errorTip:A,labelSuffix:e.toRef(t,"labelSuffix"),isNative:e.computed(()=>!!(t.action&&t.method)),className:D,inputValue:Q,useAsterisk:I,hasLabel:S,computedlabelWidth:j,controlStyle:M,labelEl:q,handleLabelClick:K}}}),ae=["name","value"],ne=["for"];function se(l,f,n,o,t,v){const i=e.resolveComponent("CircleQuestionR"),h=e.resolveComponent("Icon"),b=e.resolveComponent("Tooltip"),s=e.resolveComponent("Column");return l.props.pure?e.renderSlot(l.$slots,"default",{key:0}):(e.openBlock(),e.createBlock(s,e.mergeProps({key:1},l.$attrs,{class:l.className,role:"group",tag:"div",span:l.props.span,offset:l.props.offset,push:l.props.push,pull:l.props.pull,order:l.props.order,xs:l.props.xs,sm:l.props.sm,md:l.props.md,lg:l.props.lg,xl:l.props.xl,xxl:l.props.xxl,flex:l.props.flex}),{default:e.withCtx(()=>[l.isNative?(e.openBlock(),e.createElementBlock("input",{key:0,type:"hidden",name:l.props.prop,value:l.inputValue,style:{display:"none"}},null,8,ae)):e.createCommentVNode("",!0),l.hasLabel?(e.openBlock(),e.createElementBlock("label",{key:1,ref:"labelEl",class:e.normalizeClass(l.nh.be("label")),style:e.normalizeStyle({width:`${l.computedlabelWidth}px`}),for:l.props.htmlFor||l.props.prop,onClick:f[0]||(f[0]=(...p)=>l.handleLabelClick&&l.handleLabelClick(...p))},[e.renderSlot(l.$slots,"label",{},()=>[l.props.help||l.$slots.help?(e.openBlock(),e.createBlock(b,{key:0,transfer:""},{trigger:e.withCtx(()=>[e.createVNode(h,{class:e.normalizeClass(l.nh.be("help"))},{default:e.withCtx(()=>[e.createVNode(i)]),_:1},8,["class"])]),default:e.withCtx(()=>[e.renderSlot(l.$slots,"help",{},()=>[e.createElementVNode("div",{class:e.normalizeClass(l.nh.be("help-tip"))},e.toDisplayString(l.props.help),3)])]),_:3})):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(l.props.label+(l.labelSuffix||"")),1)])],14,ne)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({[l.nh.be("control")]:!0,[l.nh.bem("control","no-label")]:!l.hasLabel,[l.nh.bem("control","action")]:l.props.action}),role:"alert","aria-relevant":"all",style:e.normalizeStyle(l.controlStyle)},[e.renderSlot(l.$slots,"default"),e.createVNode(e.Transition,{name:l.props.errorTransition},{default:e.withCtx(()=>[!l.props.hideErrorTip&&l.isError?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(l.nh.be("error-tip"))},[e.renderSlot(l.$slots,"error",{tip:l.errorTip},()=>[e.createTextVNode(e.toDisplayString(l.errorTip),1)])],2)):e.createCommentVNode("",!0)]),_:3},8,["name"])],6)]),_:3},16,["class","span","offset","push","pull","order","xs","sm","md","lg","xl","xxl","flex"]))}var ue=x(te,[["render",se]]);module.exports=ue;
