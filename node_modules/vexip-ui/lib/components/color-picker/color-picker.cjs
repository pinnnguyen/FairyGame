"use strict";var e=require("vue"),Ee=require("./color-alpha.cjs"),Ve=require("./color-hue.cjs"),Be=require("./color-palette.cjs");require("../button/index.cjs");require("../icon/index.cjs");require("../input/index.cjs");require("../portal/index.cjs");require("../form/index.cjs");var V=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var c=require("@vexip-ui/utils"),B=require("@vexip-ui/icons"),Se=require("./props.cjs"),ze=require("../../_virtual/plugin-vue_export-helper.cjs"),Ne=require("../button/button.cjs"),Te=require("../icon/icon.cjs"),$e=require("../input/input.cjs"),De=require("../portal/portal.cjs"),qe=require("../form/helper.cjs"),He=require("../../common/config/src/namespace.cjs"),v=require("../../common/config/src/props.cjs"),Pe=require("../../common/config/src/locale/index.cjs");const Fe=()=>c.rgbToHsv(0,0,0),je=Object.freeze(["#2d8cf0","#19be6b","#ff9900","#ed4014","#00b5ff","#19c919","#f9e31c","#ea1a1a","#9b1dea","#00c2b1","#ac7a33","#1d35ea","#8bc34a","#f16b62","#ea4ca3","#0d94aa","#febd79","#5d4037","#00bcd4","#f06292","#cddc39","#607d8b","#000000","#ffffff"]),Ae=e.defineComponent({name:"ColorPicker",components:{Button:Ne,ColorAlpha:Ee,ColorHue:Ve,ColorPalette:Be,Icon:Te,Input:$e,Portal:De,Xmark:B.Xmark,ChevronDown:B.ChevronDown,CircleXmark:B.CircleXmark},props:Se.colorPickerProps,emits:["update:value","update:visible"],setup(o,{slots:r,emit:S}){const{idFor:F,state:j,disabled:A,loading:m,size:z,validateField:N,clearField:T,getFieldValue:$,setFieldValue:D}=qe.useFieldStore(()=>{var l;return(l=g.value)==null?void 0:l.focus()}),d=He.useNameHelper("color-picker"),n=v.useProps("colorPicker",o,{size:v.createSizeProp(z),state:v.createStateProp(j),value:{default:()=>$(""),static:!0},visible:!1,format:{default:"rgb",validator:l=>["rgb","hsl","hsv","hex"].includes(l)},alpha:!1,disabled:()=>A.value,transitionName:()=>d.ns("drop"),noInput:!1,shortcut:!1,placement:{default:"bottom",validator:l=>V.placementWhileList.includes(l)},transfer:!1,outsideClose:!0,clearable:!1,cancelText:null,confirmText:null,prefix:null,prefixColor:"",suffix:null,suffixColor:"",noSuffix:!1,staticSuffix:!1,loading:()=>m.value,loadingIcon:B.Spinner,loadingLock:!1,loadingSpin:!1}),h=e.ref(!0),i=e.ref(n.visible),a=e.ref(null),p=e.ref(1),k=e.ref(!1),Z=e.toRef(n,"placement"),x=e.toRef(n,"transfer"),b=e.ref(0),I=e.ref(!1);H(n.value);const K=e.ref(null),L=e.ref(null),M=e.ref(null),X=e.ref(null),O=e.ref(null),R=e.ref(null),U=e.ref(null),W=V.useClickOutside(ue),{reference:g,popper:_,transferTo:ee,updatePopper:oe}=V.usePopper({placement:Z,transfer:x,wrapper:W,isDrop:!0}),{isHover:le}=V.useHover(g),ne=e.computed(()=>[K.value,L.value,M.value,X.value,O.value,R.value,U.value].filter(Boolean)),w=e.ref({...a.value,a:p.value,format:"hsva"}),ae=e.computed(()=>({[d.b()]:!0,[d.ns("input-vars")]:!0,[d.bs("vars")]:!0,[d.bm("inherit")]:n.inherit,[d.bm("empty")]:h.value&&!i.value,[d.bm("focused")]:i.value,[d.bm("disabled")]:n.disabled,[d.bm("alpha")]:n.alpha,[d.bm(n.size)]:n.size!=="default",[d.bm(n.state)]:n.state!=="default"})),re=e.computed(()=>{const l=d.be("selector");return{[l]:!0,[`${l}--disabled`]:n.disabled,[`${l}--loading`]:n.loading&&n.loadingLock,[`${l}--${n.size}`]:n.size!=="default",[`${l}--focused`]:i.value,[`${l}--${n.state}`]:n.state!=="default"}}),y=e.computed(()=>{var u;const{h:l,s:t,v:s}=a.value&&i.value?a.value:(u=w.value)!=null?u:{h:0,s:0,v:0};return c.hsvToRgb(l,t,s)}),te=e.computed(()=>{const{r:l,g:t,b:s}=y.value;return n.alpha?c.rgbaToHex(l,t,s,p.value):c.rgbToHex(l,t,s)}),q=e.computed(()=>n.shortcut?Array.isArray(n.shortcut)?n.shortcut:je:[]),se=e.computed(()=>!!(r.prefix||n.prefix)),ie=e.computed(()=>!n.disabled&&n.clearable&&le.value&&!h.value);e.watch(()=>n.visible,l=>{i.value=l}),e.watch(i,l=>{l&&oe(),v.emitEvent(n.onToggle,l),S("update:visible",l)}),e.watch(()=>n.value,l=>{H(l),w.value={...a.value,a:p.value,format:"hsva"}}),e.watch(()=>n.disabled,l=>{l&&(i.value=!1)});function H(l){if(l){const{r:t,g:s,b:u,a:f}=c.parseColorToRgba(l);h.value=!1,a.value=c.rgbToHsv(t,s,u),p.value=f}else h.value=!0,a.value=Fe(),p.value=1}function ue(){k.value||(v.emitEvent(n.onClickOutside),n.outsideClose&&i.value&&(i.value=!1,v.emitEvent(n.onOutsideClose)))}function ce(){n.disabled||n.loading&&n.loadingLock||(i.value=!i.value)}function de(){n.clearable&&(i.value=!1,e.nextTick(()=>{H(null),T(),v.emitEvent(n.onClear)}))}function G(){w.value={...a.value,a:p.value,format:"hsva"},h.value=!1,i.value=!1,pe()}function J(){let l;if(n.format==="hex"){const{r:t,g:s,b:u}=y.value;n.alpha?l=c.rgbaToHex(t,s,u,p.value):l=c.rgbToHex(t,s,u)}else{switch(n.format){case"rgb":{l={...y.value},l.r=Math.round(l.r),l.g=Math.round(l.g),l.b=Math.round(l.b);break}case"hsl":{const{h:t,s,v:u}=a.value;l=c.hsvToHsl(t,s,u),l.h=Math.round(l.h),l.s=c.toFixed(l.s,3),l.l=c.toFixed(l.l,3);break}default:l={...a.value},l.h=Math.round(l.h),l.s=c.toFixed(l.s,3),l.v=c.toFixed(l.v,3)}l.a=c.toFixed(p.value,3)}return l}function pe(){const l=J();D(l),v.emitEvent(n.onChange,l),S("update:value",l),N()}function fe({s:l,v:t}){a.value.s=l,a.value.v=t}function he(l){a.value.h=l}function ve(l){p.value=l}function me(l){const{r:t,g:s,b:u,a:f}=c.parseColorToRgba(l);a.value=c.rgbToHsv(t,s,u),p.value=f}function Q(l){const{r:t,g:s,b:u,a:f}=c.parseColorToRgba(l);a.value=c.rgbToHsv(t,s,u),p.value=f,v.emitEvent(n.onShortcut,J())}function be(l){l?k.value=!0:setTimeout(()=>{k.value=!1},0)}function Ce(l){var t;if(c.isClient&&i.value){const s=document&&document.activeElement;if(!s)return;l.preventDefault();const u=l.shiftKey,f=Array.from(ne.value),E=f.findIndex(P=>{const Y=c.isElement(P)?P:P.$el;return Y===s||Y.contains(s)});let C;~E?(u?!E:E===f.length-1)?C=g.value:C=f.at(E+(u?-1:1)):C=f.at(u?-1:0),C&&(typeof C.focus=="function"?C.focus():(t=C.$el)==null||t.focus())}}function ge(){b.value=0,I.value=!0}function ke(l){const t=l.code||l.key,s=q.value.length;switch(t){case"ArrowUp":case"ArrowLeft":{b.value--;break}case"ArrowDown":case"ArrowRight":{b.value++;break}case"Enter":case"Space":case" ":{const u=q.value.at(b.value);u&&Q(u);break}}b.value=(b.value+s)%s}function we(l){var t;n.disabled?i.value=!1:(l.preventDefault(),i.value?(G(),(t=g.value)==null||t.focus()):i.value=!0)}function ye(){var l;i.value=!1,(l=g.value)==null||l.focus()}return{props:n,nh:d,locale:Pe.useLocale("colorPicker"),idFor:F,isEmpty:h,currentVisible:i,currentValue:a,currentAlpha:p,transferTo:ee,lastValue:w,shortcutHitting:b,shortcutsFocused:I,className:ae,selectorClass:re,rgb:y,hex:te,shortcutList:q,hasPrefix:se,showClear:ie,wrapper:W,reference:g,popper:_,palette:K,hue:L,alphaUnit:M,shortcutUnit:X,input:O,cancel:R,confirm:U,toggleVisible:ce,handleClear:de,handleOk:G,handlePaletteChange:fe,handleHueChange:he,handleAlphaChange:ve,handleInputColor:me,handleShortcutClick:Q,toggleEditing:be,handleTabDown:Ce,handleShrtcutsFocus:ge,handleShortcutsKeydown:ke,handleSpaceDown:we,handleEscDown:ye}}}),Ie=["id"],Ke=["onClick"];function Le(o,r,S,F,j,A){const m=e.resolveComponent("Icon"),z=e.resolveComponent("Xmark"),N=e.resolveComponent("ChevronDown"),T=e.resolveComponent("CircleXmark"),$=e.resolveComponent("ColorPalette"),D=e.resolveComponent("ColorHue"),d=e.resolveComponent("ColorAlpha"),n=e.resolveComponent("Input"),h=e.resolveComponent("Button"),i=e.resolveComponent("Portal");return e.openBlock(),e.createElementBlock("div",{id:o.idFor,ref:"wrapper",class:e.normalizeClass(o.className),onKeydown:[r[14]||(r[14]=e.withKeys(e.withModifiers((...a)=>o.handleTabDown&&o.handleTabDown(...a),["stop"]),["tab"])),r[15]||(r[15]=e.withKeys((...a)=>o.handleSpaceDown&&o.handleSpaceDown(...a),["space"])),r[16]||(r[16]=e.withKeys((...a)=>o.handleEscDown&&o.handleEscDown(...a),["escape"]))]},[e.createElementVNode("div",{ref:"reference",class:e.normalizeClass(o.selectorClass),tabindex:"0",onClick:r[1]||(r[1]=(...a)=>o.toggleVisible&&o.toggleVisible(...a))},[e.renderSlot(o.$slots,"control",{color:o.rgb,alpha:o.currentAlpha,empty:o.isEmpty},()=>[o.hasPrefix?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([o.nh.be("icon"),o.nh.be("prefix")]),style:e.normalizeStyle({color:o.props.prefixColor})},[e.renderSlot(o.$slots,"prefix",{},()=>[e.createVNode(m,{icon:o.props.prefix},null,8,["icon"])])],6)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(o.nh.be("control"))},[e.createElementVNode("div",{class:e.normalizeClass(o.nh.be("marker"))},[!o.currentVisible&&o.isEmpty?(e.openBlock(),e.createBlock(m,{key:0},{default:e.withCtx(()=>[e.createVNode(z)]),_:1})):(e.openBlock(),e.createElementBlock("div",{key:1,style:e.normalizeStyle({width:"100%",height:"100%",backgroundColor:`rgba(${o.rgb.r}, ${o.rgb.g}, ${o.rgb.b}, ${o.currentVisible?o.currentAlpha:o.lastValue.a})`})},null,4))],2)],2),o.props.noSuffix?o.props.clearable||o.props.loading?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass([o.nh.be("icon"),o.nh.bem("icon","placeholder"),o.nh.be("suffix")])},null,2)):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([o.nh.be("icon"),o.nh.be("suffix")]),style:e.normalizeStyle({color:o.props.suffixColor,opacity:o.showClear||o.props.loading?"0%":""})},[e.renderSlot(o.$slots,"suffix",{},()=>[o.props.suffix?(e.openBlock(),e.createBlock(m,{key:0,icon:o.props.suffix,class:e.normalizeClass({[o.nh.be("arrow")]:!o.props.staticSuffix})},null,8,["icon","class"])):(e.openBlock(),e.createBlock(m,{key:1,class:e.normalizeClass(o.nh.be("arrow"))},{default:e.withCtx(()=>[e.createVNode(N)]),_:1},8,["class"]))])],6)),e.createVNode(e.Transition,{name:o.nh.ns("fade"),appear:""},{default:e.withCtx(()=>[o.showClear?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([o.nh.be("icon"),o.nh.be("clear")]),onClick:r[0]||(r[0]=e.withModifiers((...a)=>o.handleClear&&o.handleClear(...a),["stop"]))},[e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(T)]),_:1})],2)):o.props.loading?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([o.nh.be("icon"),o.nh.be("loading")])},[e.createVNode(m,{spin:o.props.loadingSpin,pulse:!o.props.loadingSpin,icon:o.props.loadingIcon},null,8,["spin","pulse","icon"])],2)):e.createCommentVNode("",!0)]),_:1},8,["name"])])],2),e.createVNode(i,{to:o.transferTo},{default:e.withCtx(()=>[e.createVNode(e.Transition,{name:o.props.transitionName},{default:e.withCtx(()=>[o.currentVisible?(e.openBlock(),e.createElementBlock("div",{key:0,ref:"popper",class:e.normalizeClass([o.nh.be("popper"),o.nh.bs("vars"),o.transferTo!=="body"&&[o.nh.bem("popper","inherit")]]),onKeydown:[r[11]||(r[11]=e.withKeys(e.withModifiers((...a)=>o.handleTabDown&&o.handleTabDown(...a),["stop"]),["tab"])),r[12]||(r[12]=e.withKeys((...a)=>o.handleSpaceDown&&o.handleSpaceDown(...a),["space"])),r[13]||(r[13]=e.withKeys((...a)=>o.handleEscDown&&o.handleEscDown(...a),["escape"]))]},[e.createElementVNode("div",{class:e.normalizeClass(o.nh.be("panel"))},[e.createElementVNode("div",{class:e.normalizeClass(o.nh.be("section"))},[e.createVNode($,{ref:"palette",hue:o.currentValue.h,saturation:o.currentValue.s,value:o.currentValue.v,onEditStart:r[2]||(r[2]=a=>o.toggleEditing(!0)),onEditEnd:r[3]||(r[3]=a=>o.toggleEditing(!1)),onChange:o.handlePaletteChange},null,8,["hue","saturation","value","onChange"]),e.createVNode(D,{ref:"hue",hue:o.currentValue.h,onEditStart:r[4]||(r[4]=a=>o.toggleEditing(!0)),onEditEnd:r[5]||(r[5]=a=>o.toggleEditing(!1)),onChange:o.handleHueChange},null,8,["hue","onChange"]),o.props.alpha?(e.openBlock(),e.createBlock(d,{key:0,ref:"alphaUnit",rgb:o.rgb,alpha:o.currentAlpha,onEditStart:r[6]||(r[6]=a=>o.toggleEditing(!0)),onEditEnd:r[7]||(r[7]=a=>o.toggleEditing(!1)),onChange:o.handleAlphaChange},null,8,["rgb","alpha","onChange"])):e.createCommentVNode("",!0),o.props.shortcut?(e.openBlock(),e.createElementBlock("div",{key:1,ref:"shortcutUnit",class:e.normalizeClass(o.nh.be("shortcuts")),tabindex:"-1",onFocus:r[8]||(r[8]=(...a)=>o.handleShrtcutsFocus&&o.handleShrtcutsFocus(...a)),onBlur:r[9]||(r[9]=a=>o.shortcutsFocused=!1),onKeydown:r[10]||(r[10]=(...a)=>o.handleShortcutsKeydown&&o.handleShortcutsKeydown(...a))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.shortcutList,(a,p)=>(e.openBlock(),e.createElementBlock("div",{key:p,class:e.normalizeClass({[o.nh.be("shortcut-item")]:!0,[o.nh.bem("shortcut-item","hitting")]:o.shortcutsFocused&&o.shortcutHitting===p}),style:e.normalizeStyle({backgroundColor:a}),onClick:k=>o.handleShortcutClick(a)},null,14,Ke))),128))],34)):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass(o.nh.be("action"))},[o.props.noInput?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(n,{key:0,ref:"input",inherit:"",class:e.normalizeClass(o.nh.be("input")),size:"small",value:o.hex.toUpperCase(),respond:!1,onChange:o.handleInputColor},null,8,["class","value","onChange"])),o.props.clearable?(e.openBlock(),e.createBlock(h,{key:1,ref:"cancel",inherit:"",text:"",size:"small",onClick:o.handleClear},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.props.cancelText||o.locale.cancel),1)]),_:1},8,["onClick"])):e.createCommentVNode("",!0),e.createVNode(h,{ref:"confirm",inherit:"",type:"primary",size:"small",onClick:o.handleOk},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.props.confirmText||o.locale.confirm),1)]),_:1},8,["onClick"])],2)],2)],34)):e.createCommentVNode("",!0)]),_:1},8,["name"])]),_:1},8,["to"])],42,Ie)}var Me=ze(Ae,[["render",Le]]);module.exports=Me;
