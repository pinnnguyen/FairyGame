"use strict";var a=require("vue"),j=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var m=require("@vexip-ui/utils"),I=require("./props.cjs"),Y=require("../../_virtual/plugin-vue_export-helper.cjs"),y=require("../../common/config/src/props.cjs"),K=require("../../common/config/src/locale/index.cjs"),W=require("../../common/config/src/namespace.cjs");const O=a.defineComponent({name:"CalendarPanel",props:I.calendarPanelProps,emits:["update:value"],setup(e,{emit:k}){const r=y.useProps("calendarBase",e,{value:{default:null,static:!0},year:()=>new Date().getFullYear(),month:{default:()=>new Date().getMonth()+1,validator:n=>n>0&&n<=12},weekDays:{default:null,validator:n=>!n||n.length===0||n.length===7},weekStart:{default:0,validator:n=>n>=0&&n<7},today:{default:()=>new Date,validator:n=>!Number.isNaN(+new Date(n))},disabledDate:{default:m.toFalse,isFunc:!0},isRange:!1,valueType:{default:"start",validator:n=>n==="start"||n==="end"},min:null,max:null}),l=a.ref(null),o=a.ref(null),c=a.ref([]),t=a.ref(null),{wrapper:i,isHover:h}=j.useHover(),C=K.useLocale("calendar"),p=a.computed(()=>r.min?+m.startOfDay(r.min):-1/0),g=a.computed(()=>r.max?+m.endOfDay(r.max):1/0),S=a.computed(()=>Number.isNaN(p.value)||Number.isNaN(g.value)?!1:p.value>g.value),R=m.debounceMinor(D);N(r.value),D(),a.watch(()=>r.value,N),a.watch(()=>r.year,R),a.watch(()=>r.month,R),a.watch(h,n=>{n||(t.value=null)}),a.watch(t,n=>{y.emitEvent(r.onHover,n)});function E(n){var s;return((s=r.weekDays)==null?void 0:s[n])||C.value[`week${n||7}`]}function D(){c.value=m.rangeDate(m.startOfWeek(new Date(r.year,r.month-1,1),r.weekStart),42)}function N(n){var s;Array.isArray(n)||(n=[n,n]);for(let u=0;u<2;++u){const d=new Date((s=n[u])!=null?s:"");if(u===0?l.value=Number.isNaN(+d)?null:d:o.value=Number.isNaN(+d)?null:d,!r.isRange)break}}function $(n){return!n||!l.value&&!o.value?!1:!!(l.value&&!m.differenceDays(n,l.value)||o.value&&!m.differenceDays(n,o.value))}function T(n){if(typeof r.disabledDate=="function"&&r.disabledDate(n))return!0;const s=n.getTime();if(S.value){if(s>g.value&&s<p.value)return!0}else if(s<p.value||s>g.value)return!0;return!1}function b(n){return r.isRange&&(r.valueType==="end"&&l.value&&m.differenceDays(l.value,n)<0||r.valueType==="start"&&o.value&&m.differenceDays(n,o.value)<0)?!0:T(n)}function V(n){return!n||!t.value?!1:!m.differenceDays(n,t.value)}function q(n){const{year:s,month:u}=r,d=n.getFullYear(),v=n.getMonth();return d<s||d===s&&v<u-1}function w(n){const{year:s,month:u}=r,d=n.getFullYear(),v=n.getMonth();return d>s||d===s&&v>u-1}function z(n){return m.differenceDays(n,r.today)===0}function B(n){b(n)||(r.valueType?l.value=n:o.value=n,y.emitEvent(r.onSelect,n),k("update:value",n))}function H(n){t.value=b(n)?null:n}function P(n){var d;if(!t.value&&!l.value&&!o.value)return!1;let s,u;if(!t.value&&l.value&&o.value){const v=l.value.getTime(),f=o.value.getTime();s=Math.min(v,f),u=Math.max(v,f)}else if(t.value){if(!l.value&&!o.value)return!1;const v=t.value.getTime();if(!l.value||!o.value){const f=((d=l.value)!=null?d:o.value).getTime();s=Math.min(v,f),u=Math.max(v,f)}else{const f=l.value.getTime(),M=o.value.getTime(),F=Math.min(f,M),L=Math.max(f,M);s=Math.min(v,F),u=Math.max(v,L)}}else return!1;return n.getTime()>=s&&n.getTime()<=u}return{props:r,nh:W.useNameHelper("calendar"),startValue:l,endValue:o,dateRange:c,hoveredDate:t,body:i,getWeekLabel:E,isSelected:$,isHovered:V,isPrevMonth:q,isNextMonth:w,isDisabled:b,isToday:z,handleClick:B,handleHover:H,isInRange:P}}}),A=["onMouseenter"],G=["onClick","onKeydown"];function J(e,k,r,l,o,c){return a.openBlock(),a.createElementBlock("div",{class:a.normalizeClass([e.nh.be("panel"),e.nh.bs("vars"),e.props.inherit&&e.nh.bem("panel","inherit")])},[a.renderSlot(e.$slots,"header"),a.createElementVNode("div",{class:a.normalizeClass([e.nh.be("row"),e.nh.bem("row","week")])},[(a.openBlock(),a.createElementBlock(a.Fragment,null,a.renderList(7,t=>a.createElementVNode("div",{key:t,class:a.normalizeClass([e.nh.be("cell"),e.nh.be("cell-week")])},[a.renderSlot(e.$slots,"week",{index:t-1,label:e.getWeekLabel((t-1+e.props.weekStart)%7),week:(t-1+e.props.weekStart)%7},()=>[a.createElementVNode("div",{class:a.normalizeClass(e.nh.be("index"))},a.toDisplayString(e.getWeekLabel((t-1+e.props.weekStart)%7)),3)])],2)),64))],2),a.createElementVNode("div",{ref:"body",class:a.normalizeClass(e.nh.be("body"))},[(a.openBlock(),a.createElementBlock(a.Fragment,null,a.renderList(6,t=>a.createElementVNode("div",{key:t,class:a.normalizeClass(e.nh.be("row"))},[(a.openBlock(),a.createElementBlock(a.Fragment,null,a.renderList(7,i=>a.createElementVNode("div",{key:(t-1)*7+i,class:a.normalizeClass(e.nh.be("cell")),onMouseenter:h=>e.handleHover(e.dateRange[(t-1)*7+i-1])},[a.renderSlot(e.$slots,"item",{selected:e.isSelected(e.dateRange[(t-1)*7+i-1]),hovered:e.isHovered(e.dateRange[(t-1)*7+i-1]),date:e.dateRange[(t-1)*7+i-1],isPrev:e.isPrevMonth(e.dateRange[(t-1)*7+i-1]),isNext:e.isNextMonth(e.dateRange[(t-1)*7+i-1]),isToday:e.isToday(e.dateRange[(t-1)*7+i-1]),disabled:e.isDisabled(e.dateRange[(t-1)*7+i-1]),inRange:e.props.isRange&&e.isInRange(e.dateRange[(t-1)*7+i-1])},()=>[a.createElementVNode("div",{class:a.normalizeClass({[e.nh.be("index")]:!0,[e.nh.bem("index","selected")]:e.isSelected(e.dateRange[(t-1)*7+i-1]),[e.nh.bem("index","prev")]:e.isPrevMonth(e.dateRange[(t-1)*7+i-1]),[e.nh.bem("index","next")]:e.isNextMonth(e.dateRange[(t-1)*7+i-1]),[e.nh.bem("index","today")]:e.isToday(e.dateRange[(t-1)*7+i-1]),[e.nh.bem("index","disabled")]:e.isDisabled(e.dateRange[(t-1)*7+i-1]),[e.nh.bem("index","in-range")]:e.props.isRange&&e.isInRange(e.dateRange[(t-1)*7+i-1])}),tabindex:"0",onClick:h=>e.handleClick(e.dateRange[(t-1)*7+i-1]),onKeydown:[a.withKeys(a.withModifiers(h=>e.handleClick(e.dateRange[(t-1)*7+i-1]),["prevent"]),["enter"]),a.withKeys(a.withModifiers(h=>e.handleClick(e.dateRange[(t-1)*7+i-1]),["prevent"]),["space"])]},[a.createElementVNode("div",{class:a.normalizeClass(e.nh.be("index-inner"))},a.toDisplayString(e.dateRange[(t-1)*7+i-1].getDate()),3)],42,G)])],42,A)),64))],2)),64))],2),a.renderSlot(e.$slots,"footer")],2)}var Q=Y(O,[["render",J]]);module.exports=Q;
