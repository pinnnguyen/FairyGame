"use strict";var e=require("vue");require("../icon/index.cjs");require("../form/index.cjs");var H=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var c=require("@vexip-ui/utils"),N=require("@vexip-ui/icons"),ie=require("./props.cjs"),se=require("../../_virtual/plugin-vue_export-helper.cjs"),te=require("../icon/icon.cjs"),ue=require("../form/helper.cjs"),t=require("../../common/config/src/props.cjs"),pe=require("../../common/config/src/namespace.cjs"),de=require("../../common/config/src/locale/index.cjs");const R=n=>c.isNull(n)||Number.isNaN(n),ce=e.defineComponent({name:"NumberInput",components:{Icon:te,CaretUp:N.CaretUp,CaretDown:N.CaretDown,CircleXmark:N.CircleXmark},props:ie.numberInputProps,emits:["update:value"],setup(n,{slots:a,emit:b}){const{idFor:z,state:q,disabled:P,loading:f,size:V,validateField:h,clearField:S,getFieldValue:g,setFieldValue:i}=ue.useFieldStore(E),l=t.useProps("numberInput",n,{size:t.createSizeProp(V),state:t.createStateProp(q),prefix:null,prefixColor:"",suffix:null,suffixColor:"",formatter:{default:null,isFunc:!0},value:{default:()=>g(null),static:!0},min:-1/0,max:1/0,placeholder:null,autofocus:!1,spellcheck:!1,autocomplete:!1,precision:0,readonly:!1,step:1,ctrlStep:100,shiftStep:10,altStep:.1,disabled:()=>P.value,inputClass:null,debounce:!1,clearable:!1,loading:()=>f.value,loadingIcon:N.Spinner,loadingLock:!1,loadingSpin:!1,sync:!1,controlType:"right"}),u=pe.useNameHelper("number-input"),m=e.ref(!1),r=e.ref(l.value),y=e.ref(!1),k=e.ref(),{wrapper:X,isHover:j}=H.useHover();H.useModifier({target:k,passive:!1,onKeyDown:(o,s)=>{t.emitEvent(l.onKeyDown,o),s.up||s.down?(o.preventDefault(),B(s.up?"plus":"minus",o.ctrlKey?"ctrl":o.shiftKey?"shift":o.altKey?"alt":void 0),s.resetAll()):s.enter&&(o.preventDefault(),F("change"),s.resetAll())},onKeyUp:o=>{t.emitEvent(l.onKeyUp,o),o.key==="Enter"&&ne()}});let w=l.value;const A=e.computed(()=>{const[o,s]=(l.controlType||"right").split("-");return[u.b(),u.ns("input-vars"),{[u.bm("inherit")]:l.inherit,[u.bm("focused")]:m.value,[u.bm("disabled")]:l.disabled,[u.bm("loading")]:l.loading&&l.loadingLock,[u.bm(l.size)]:l.size!=="default",[u.bm(l.state)]:l.state!=="default",[u.bm(`control-${o}`)]:o!=="right",[u.bm("control-fade")]:s}]}),D=e.computed(()=>!!(a.prefix||l.prefix)),$=e.computed(()=>!!(a.suffix||l.suffix)),W=e.computed(()=>({paddingLeft:D.value?"2em":"",paddingRight:$.value?"2em":""})),v=e.computed(()=>!y.value&&typeof r.value=="number"&&l.precision>0?c.toFixed(r.value,l.precision):r.value),L=e.computed(()=>{var o;return typeof v.value!="number"?(o=v.value)!=null?o:"":typeof l.formatter=="function"?l.formatter(v.value):v.value.toString()}),M=e.computed(()=>!R(r.value)&&r.value>=l.max),T=e.computed(()=>!R(r.value)&&r.value<=l.min),U=e.computed(()=>r.value||r.value===0),O=e.computed(()=>!l.disabled&&l.clearable&&j.value&&U.value),G=e.computed(()=>Number.isNaN(r.value)?"":m.value?v.value:L.value),J=e.computed(()=>l.loading&&l.loadingLock||l.readonly),Q=e.computed(()=>{var o;return(o=l.controlType)==null?void 0:o.endsWith("fade")});e.watch(()=>l.value,o=>{r.value=c.isNull(o)?NaN:o,w=r.value});function E(){k.value&&k.value.focus()}function Y(o){m.value=!0,y.value=!0,t.emitEvent(l.onFocus,o)}function Z(o){m.value=!1,setTimeout(()=>{m.value||(y.value=!1,t.emitEvent(l.onBlur,o),F("change"))},120)}function x(o){M.value||(!m.value&&E(),B("plus",o.ctrlKey?"ctrl":o.shiftKey?"shift":o.altKey?"alt":void 0))}function _(o){T.value||(!m.value&&E(),B("minus",o.ctrlKey?"ctrl":o.shiftKey?"shift":o.altKey?"alt":void 0))}function B(o,s){if(l.disabled||l.loading&&l.loadingLock)return;let p=r.value||0,d;switch(s){case"ctrl":d=l.ctrlStep;break;case"shift":d=l.shiftStep;break;case"alt":d=l.altStep;break;default:d=l.step}const C=p.toString().trim();C.endsWith(".")&&(p=c.toNumber(C.slice(0,-1))),o==="plus"?p=c.plus(p,d):p=c.minus(p,d),K(p,"input")}function I(o){const s=o.type,p=o.target.value;let d=p;if(!/^-?[0-9]*\.?[0-9]*$/.test(p)){const C=parseFloat(p);Number.isNaN(C)?d="":d=C.toString(),o.target.value=d}y.value=s==="input",K(c.toNumber(d),s)}function K(o,s){s!=="input"?r.value=c.boundRange(o,l.min,l.max):r.value=o,F(s)}function F(o){if(o=o==="input"?"input":"change",o==="change"){if(w===r.value)return;w=r.value,i(r.value),t.emitEvent(l.onChange,r.value),l.sync||(b("update:value",r.value),h())}else t.emitEvent(l.onInput,r.value),l.sync&&(b("update:value",r.value),h())}function ee(){K(NaN,"change"),l.sync&&(b("update:value",r.value),h()),t.emitEvent(l.onClear),S()}function ne(){t.emitEvent(l.onEnter)}function le(o){t.emitEvent(l.onPrefixClick,o)}function oe(o){t.emitEvent(l.onSuffixClick,o)}function ae(o){t.emitEvent(l.onKeyPress,o)}const re=l.debounce?c.debounce(I):c.throttle(I);return{props:l,nh:u,locale:de.useLocale("input"),idFor:z,focused:m,isHover:j,className:A,hasPrefix:D,hasSuffix:$,inputStyle:W,preciseNumber:v,formattedValue:L,plusDisabled:M,minusDisabled:T,hasValue:U,showClear:O,inputValue:G,isReadonly:J,controlFade:Q,wrapper:X,input:k,handleFocus:Y,handleBlur:Z,plusNumber:x,minusNumber:_,handleInput:re,handleChange:I,handleClear:ee,handlePrefixClick:le,handleSuffixClick:oe,handleKeyPress:ae}}}),fe=["id"],me=["value","autofocus","autocomplete","spellcheck","disabled","readonly","placeholder","aria-valuenow","aria-valuemin","aria-valuemax"];function ve(n,a,b,z,q,P){var g;const f=e.resolveComponent("Icon"),V=e.resolveComponent("CircleXmark"),h=e.resolveComponent("CaretUp"),S=e.resolveComponent("CaretDown");return e.openBlock(),e.createElementBlock("div",{id:n.idFor,ref:"wrapper",class:e.normalizeClass(n.className),onClick:a[12]||(a[12]=i=>{var l;return(l=n.input)==null?void 0:l.focus()})},[n.hasPrefix?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([n.nh.be("icon"),n.nh.be("prefix")]),style:e.normalizeStyle({color:n.props.prefixColor}),onClick:a[0]||(a[0]=(...i)=>n.handlePrefixClick&&n.handlePrefixClick(...i))},[e.renderSlot(n.$slots,"prefix",{},()=>[e.createVNode(f,{icon:n.props.prefix},null,8,["icon"])])],6)):e.createCommentVNode("",!0),e.createElementVNode("input",{ref:"input",type:"text",class:e.normalizeClass([n.nh.be("control"),n.inputClass]),value:n.inputValue,autofocus:n.props.autofocus,autocomplete:n.props.autocomplete?"on":"off",spellcheck:n.props.spellcheck,disabled:n.props.disabled,readonly:n.isReadonly,placeholder:(g=n.props.placeholder)!=null?g:n.locale.placeholder,role:"spinbutton","aria-valuenow":n.preciseNumber,"aria-valuemin":n.props.min!==-1/0?n.props.min:void 0,"aria-valuemax":n.props.max!==1/0?n.props.max:void 0,onBlur:a[1]||(a[1]=(...i)=>n.handleBlur&&n.handleBlur(...i)),onFocus:a[2]||(a[2]=(...i)=>n.handleFocus&&n.handleFocus(...i)),onKeypress:a[3]||(a[3]=(...i)=>n.handleKeyPress&&n.handleKeyPress(...i)),onInput:a[4]||(a[4]=(...i)=>n.handleInput&&n.handleInput(...i)),onChange:a[5]||(a[5]=(...i)=>n.handleChange&&n.handleChange(...i))},null,42,me),n.hasSuffix?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([n.nh.be("icon"),n.nh.be("suffix")]),style:e.normalizeStyle({color:n.props.suffixColor,opacity:n.showClear||n.props.loading?"0%":""}),onClick:a[6]||(a[6]=(...i)=>n.handleSuffixClick&&n.handleSuffixClick(...i))},[e.renderSlot(n.$slots,"suffix",{},()=>[e.createVNode(f,{icon:n.props.suffix},null,8,["icon"])])],6)):n.props.clearable||n.props.loading?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass([n.nh.be("icon"),n.nh.bem("icon","placeholder"),n.nh.be("suffix")])},null,2)):e.createCommentVNode("",!0),e.createVNode(e.Transition,{name:n.nh.ns("fade"),appear:""},{default:e.withCtx(()=>[n.showClear?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([n.nh.be("icon"),n.nh.be("clear")]),onClick:a[7]||(a[7]=e.withModifiers((...i)=>n.handleClear&&n.handleClear(...i),["stop"]))},[e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(V)]),_:1})],2)):n.props.loading?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([n.nh.be("icon"),n.nh.be("loading")])},[e.createVNode(f,{spin:n.props.loadingSpin,pulse:!n.props.loadingSpin,icon:n.props.loadingIcon},null,8,["spin","pulse","icon"])],2)):e.createCommentVNode("",!0)]),_:1},8,["name"]),n.props.controlType!=="none"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[e.createElementVNode("div",{class:e.normalizeClass(n.nh.be("plus")),onClick:a[8]||(a[8]=(...i)=>n.plusNumber&&n.plusNumber(...i)),onMousedown:a[9]||(a[9]=e.withModifiers(()=>{},["prevent"]))},[e.createVNode(f,{scale:.8},{default:e.withCtx(()=>[e.createVNode(h)]),_:1},8,["scale"])],34),e.createElementVNode("div",{class:e.normalizeClass(n.nh.be("minus")),onClick:a[10]||(a[10]=(...i)=>n.minusNumber&&n.minusNumber(...i)),onMousedown:a[11]||(a[11]=e.withModifiers(()=>{},["prevent"]))},[e.createVNode(f,{scale:.8},{default:e.withCtx(()=>[e.createVNode(S)]),_:1},8,["scale"])],34)],64)):e.createCommentVNode("",!0)],10,fe)}var he=se(ce,[["render",ve]]);module.exports=he;
