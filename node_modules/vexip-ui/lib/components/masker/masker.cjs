"use strict";var e=require("vue");require("../portal/index.cjs");require("../../common/config/src/index.cjs");var w=require("@vexip-ui/utils"),y=require("./props.cjs"),N=require("../../_virtual/plugin-vue_export-helper.cjs"),q=require("../portal/portal.cjs"),V=require("../../common/config/src/namespace.cjs"),p=require("../../common/config/src/props.cjs");const A=e.defineComponent({name:"Masker",components:{Portal:q},props:y.maskerProps,emits:["update:active"],setup(n,{emit:s}){const a=V.useNameHelper("masker"),r=p.useProps("masker",n,{active:{default:!1,static:!0},closable:!1,inner:!1,maskTransition:()=>a.ns("fade"),transitionName:()=>a.ns("fade"),disabled:!1,onBeforeClose:{default:null,isFunc:!0},transfer:!1,autoRemove:!1}),u=e.ref(r.active),f=e.ref(r.active),i=e.ref(),t=e.ref(),d=e.ref();let m=!1,c=null;const h=e.computed(()=>r.inner?"":typeof r.transfer=="boolean"?r.transfer?"body":"":r.transfer),b=e.computed(()=>[a.b(),a.bs("vars"),{[a.bm("inherit")]:h.value!=="body"&&r.inherit,[a.bm("inner")]:r.inner,[a.bm("disabled")]:r.disabled}]);e.watch(()=>r.active,o=>{u.value=o,o&&(f.value=o)}),e.watch(u,o=>{o?c=document.activeElement:(m=!1,c&&(c.focus(),c=null)),p.emitEvent(r.onToggle,o),s("update:active",o)});function C(o){u.value=o}async function k(){if(!r.closable)return;let o=!0;typeof r.onBeforeClose=="function"&&(o=r.onBeforeClose(),w.isPromise(o)&&(o=await o)),o!==!1&&e.nextTick(()=>{C(!1),p.emitEvent(r.onClose)})}function g(){e.nextTick(()=>{f.value=!1,p.emitEvent(r.onHide)})}function E(){var l;const o=document&&document.activeElement;(!o||!i.value||!i.value.contains(o))&&((l=t.value)==null||l.focus()),e.nextTick(()=>{m=!0,p.emitEvent(r.onShow)})}function T(o){const l=o.target;if(!m||!i.value||!l||!t.value||!d.value)return;const v=w.queryTabables(i.value);!v.length||(t.value===l?v.at(-1).focus():d.value===l&&v[0].focus())}return{props:r,nh:a,currentActive:u,wrapShow:f,className:b,transferTo:h,wrapper:i,topTrap:t,bottomTrap:d,handleClose:k,afterClose:g,afterOpen:E,handleFocusIn:T}}}),j={ref:"topTrap",tabindex:"0","aria-hidden":"true",style:{width:"0",height:"0",overflow:"hidden",outline:"none"}},B={ref:"bottomTrap",tabindex:"0","aria-hidden":"true",style:{width:"0",height:"0",overflow:"hidden",outline:"none"}};function P(n,s,a,r,u,f){const i=e.resolveComponent("Portal");return!n.props.autoRemove||n.wrapShow?(e.openBlock(),e.createBlock(i,{key:0,to:n.transferTo},{default:e.withCtx(()=>[e.createElementVNode("div",e.mergeProps({ref:"wrapper",class:n.className,tabindex:"-1",style:{pointerEvents:n.wrapShow?void 0:"none",visibility:n.wrapShow?void 0:"hidden"}},n.$attrs,{onFocusin:s[1]||(s[1]=(...t)=>n.handleFocusIn&&n.handleFocusIn(...t)),onKeydown:s[2]||(s[2]=e.withKeys(e.withModifiers((...t)=>n.handleClose&&n.handleClose(...t),["prevent"]),["escape"]))}),[n.props.disabled?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.Transition,{key:0,appear:n.props.autoRemove,name:n.props.maskTransition,onAfterEnter:n.afterOpen,onAfterLeave:n.afterClose},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass(n.nh.be("mask")),onClick:s[0]||(s[0]=(...t)=>n.handleClose&&n.handleClose(...t))},[e.createElementVNode("div",{class:e.normalizeClass(n.nh.be("mask-inner"))},null,2)],2),[[e.vShow,n.currentActive]])]),_:1},8,["appear","name","onAfterEnter","onAfterLeave"])),e.createElementVNode("span",j,null,512),e.createVNode(e.Transition,{appear:n.props.autoRemove,name:n.props.transitionName},{default:e.withCtx(()=>[e.renderSlot(n.$slots,"default",{show:n.currentActive})]),_:3},8,["appear","name"]),e.createElementVNode("span",B,null,512)],16)]),_:3},8,["to"])):e.createCommentVNode("",!0)}var S=N(A,[["render",P]]);module.exports=S;
