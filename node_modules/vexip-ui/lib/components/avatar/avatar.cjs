"use strict";var e=require("vue");require("../icon/index.cjs");require("../resize-observer/index.cjs");require("../../common/config/src/index.cjs");var q=require("./props.cjs"),S=require("./symbol.cjs"),B=require("../../_virtual/plugin-vue_export-helper.cjs"),$=require("../icon/icon.cjs"),w=require("../resize-observer/resize-observer.cjs"),m=require("../../common/config/src/props.cjs"),F=require("../../common/config/src/namespace.cjs");const H=Object.freeze(["fill","contain","cover","none","scale-down"]),O=e.defineComponent({name:"Avatar",components:{Icon:$,ResizeObserver:w},props:q.avatarProps,emits:[],setup(r){const s=m.useProps("avatar",r,{size:"default",src:{default:"",static:!0},icon:null,circle:!1,alt:"",fit:{default:"cover",validator:o=>H.includes(o)},srcSet:"",gap:4,iconScale:1.4,fallbackSrc:"",color:null,background:null}),t=e.inject(S.GROUP_STATE,null),l=F.useNameHelper("avatar"),c=e.ref(!1),i=e.ref(!1),p=e.ref(),u=e.ref(),a=e.computed(()=>{var o;return(o=t==null?void 0:t.size)!=null?o:s.size}),b=e.computed(()=>({[l.b()]:!0,[l.bs("vars")]:!0,[l.bm("inherit")]:s.inherit,[l.bm(a.value)]:typeof a.value!="number"&&a.value!=="default",[l.bm("circle")]:s.circle})),k=e.computed(()=>{const o={[l.cv("color")]:s.color,[l.cv("bg-color")]:s.background,[l.cv("image-fit")]:s.fit};return typeof a.value=="number"&&(o[l.cv("size")]=`${a.value}px`),o});e.watch(()=>s.src,()=>{c.value=!1,i.value=!1,f()}),e.watch(()=>s.fallbackSrc,()=>{i.value=!1,f()}),e.watch(()=>s.gap,f);function h(o){c.value=!0,m.emitEvent(s.onError,o)}let v=null;function f(){const o=p.value,n=u.value;if(o&&n&&(v===null||v!==n.textContent)){v=n.textContent;const{offsetWidth:g,offsetHeight:C}=o,{offsetWidth:E,offsetHeight:y}=n,d=s.gap*2,j=Math.min((g-d)/(E||1),(C-d)/(y||1),1);n.style.transform=`scale(${j})`}}function z(o){m.emitEvent(s.onClick,o)}return{props:s,nh:l,loadFail:c,fallbackFail:i,wrapper:p,text:u,className:b,style:k,handleError:h,scaleText:f,handleClick:z}}}),T=["src","alt","srcset"],N=["src","alt"];function R(r,s,t,l,c,i){const p=e.resolveComponent("Icon"),u=e.resolveComponent("ResizeObserver");return e.openBlock(),e.createElementBlock("div",{ref:"wrapper",class:e.normalizeClass(r.className),style:e.normalizeStyle(r.style),onClick:s[2]||(s[2]=(...a)=>r.handleClick&&r.handleClick(...a))},[(r.props.src||r.props.srcSet)&&!r.loadFail?(e.openBlock(),e.createElementBlock("img",{key:0,class:e.normalizeClass(r.nh.be("image")),src:r.props.src,alt:r.props.alt,srcset:r.props.srcSet,onError:s[0]||(s[0]=(...a)=>r.handleError&&r.handleError(...a))},null,42,T)):r.loadFail&&r.props.fallbackSrc&&!r.fallbackFail?(e.openBlock(),e.createElementBlock("img",{key:1,class:e.normalizeClass(r.nh.be("image")),src:r.props.fallbackSrc,alt:r.props.alt,onError:s[1]||(s[1]=a=>r.fallbackFail=!0)},null,42,N)):r.icon?(e.openBlock(),e.createBlock(p,{key:2,class:e.normalizeClass(r.nh.be("icon")),icon:r.icon,scale:r.props.iconScale},null,8,["class","icon","scale"])):(e.openBlock(),e.createBlock(u,{key:3,"on-resize":r.scaleText},{default:e.withCtx(()=>[e.createElementVNode("span",{ref:"text",class:e.normalizeClass(r.nh.be("text"))},[e.renderSlot(r.$slots,"default")],2)]),_:3},8,["on-resize"]))],6)}var W=B(O,[["render",R]]);module.exports=W;
