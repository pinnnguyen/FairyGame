"use strict";var o=require("vue");require("../checkbox/index.cjs");require("../icon/index.cjs");require("../option/index.cjs");require("../virtual-list/index.cjs");var m=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var V=require("@vexip-ui/hooks"),I=require("@vexip-ui/utils"),j=require("../../_virtual/plugin-vue_export-helper.cjs"),M=require("../checkbox/checkbox.cjs"),N=require("../icon/icon.cjs"),R=require("../option/option.cjs"),T=require("../virtual-list/virtual-list.cjs"),A=require("../../common/config/src/namespace.cjs");const L=o.defineComponent({name:"CascaderPanel",components:{Checkbox:M,Icon:N,Option:R,VirtualList:T,ChevronRight:m.ChevronRight,Spinner:m.Spinner,ArrowsRotate:m.ArrowsRotate},props:{options:{type:Array,default:()=>[]},openedId:{type:Number,default:null},values:{type:Array,default:()=>[]},ready:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},checkIcon:{type:Object,default:m.Check},isAsync:{type:Boolean,default:!1},merged:{type:Boolean,default:!1},noCascaded:{type:Boolean,default:!1},visible:{type:Boolean,default:!1}},emits:["select","check","hover","open","back","close"],setup(e,{emit:r}){const y=A.useNameHelper("cascader"),s=o.ref(-1),u=o.ref(),{target:B}=V.useModifier({passive:!1,onKeyDown:(n,l)=>{if(l.up||l.down){if(n.preventDefault(),s.value<0){s.value=e.options.findIndex(C),s.value<0&&(s.value=0);return}s.value=I.boundRange(w(s.value+(l.up?-1:1),l.up?-1:1),0,e.options.length-1),S(s.value,l.up?"top":"bottom")}else if(l.left||l.right)if(n.preventDefault(),l.right){const a=e.options[s.value];a&&i(a)&&r("open",a)}else r("back");else if(l.enter||l.space){n.preventDefault(),n.stopPropagation();const a=e.options[s.value];a&&(e.multiple?b(a):g(a,s.value))}else l.escape&&r("close")}});let f=0,v;o.watch(()=>e.ready,n=>{var l;requestAnimationFrame(p),n?((l=u.value)==null||l.refresh(),s.value=e.options.findIndex(C)):s.value=-1}),o.onMounted(()=>{requestAnimationFrame(p)}),o.onBeforeUnmount(d);function i(n){var l;return!!(n.hasChild||((l=n.children)==null?void 0:l.length))}function C(n){return i(n)&&n.id===e.openedId||e.values.includes(n.fullValue)}function k(n){return n.disabled||!e.merged&&e.multiple&&e.isAsync&&i(n)&&!n.childrenLoaded}function g(n,l){n.disabled||(s.value=l,e.multiple||e.noCascaded?i(n)?r("select",n):b(n):r("select",n))}function b(n){!k(n)&&r("check",n)}function t(n){clearTimeout(v),v=setTimeout(()=>{!n.disabled&&r("hover",n)},250)}function d(){clearTimeout(v)}function p(){var l;const n=(l=u.value)==null?void 0:l.wrapper;if(n){const a=getComputedStyle(n),c=parseInt(a.paddingTop),h=parseInt(a.paddingBottom);f=n.offsetHeight-c-h}}function q(n,l){var c;const a=e.options;for(l=l/Math.abs(l);(c=a[n])!=null&&c.disabled&&(n+=l,!(n<0||n>=a.length)););return n}function w(n,l=1){var c;const a=e.options;return(c=a[n])!=null&&c.disabled&&(n=q(n,l),(l>0?n>=a.length:n<0)&&(n=q(n,-l),(l>0?n<0:n>=a.length)&&(n=-1))),n}function S(n,l){const a=e.options[n],c=32;if(!(!a||!u.value))if(l==="bottom"){const h=(n+1)*c;u.value.scrollOffset+f<h&&u.value.scrollTo(h-f)}else{const h=n*c;u.value.scrollOffset>h&&u.value.scrollTo(h)}}return{nh:y,currentHitting:s,wrapper:B,list:u,hasChildren:i,isSelected:C,isCheckboxDisabled:k,handleSelect:g,handleToggleCheck:b,handleMouseEnter:t,handleMouseLeave:d,computeListHeight:p}}});function z(e,r,y,s,u,B){const f=o.resolveComponent("Checkbox"),v=o.resolveComponent("Spinner"),i=o.resolveComponent("Icon"),C=o.resolveComponent("ArrowsRotate"),k=o.resolveComponent("ChevronRight"),g=o.resolveComponent("Option"),b=o.resolveComponent("VirtualList");return o.openBlock(),o.createElementBlock("div",{ref:"wrapper",class:o.normalizeClass(e.nh.be("panel")),tabindex:"-1",onMouseleave:r[0]||(r[0]=(...t)=>e.handleMouseLeave&&e.handleMouseLeave(...t))},[o.createVNode(b,{ref:"list",inherit:"",items:e.options,"item-size":32,height:"100%","id-key":"id","items-attrs":{class:[e.nh.be("options"),e.multiple?e.nh.bem("options","multiple"):null,e.noCascaded?e.nh.bem("options","no-cascaded"):null],role:"listbox"},onResize:e.computeListHeight},{default:o.withCtx(({item:t,index:d})=>[o.createVNode(g,{class:o.normalizeClass({[e.nh.ns("option--error")]:t.error}),value:t.value,label:t.label,disabled:t.disabled,selected:e.isSelected(t),hitting:d===e.currentHitting,onSelect:p=>e.handleSelect(t,d),onMouseenter:p=>e.handleMouseEnter(t)},{default:o.withCtx(()=>[o.renderSlot(e.$slots,"default",{option:t,index:d,selected:e.isSelected(t),canCheck:e.isCheckboxDisabled(t),hasChild:e.hasChildren(t)},()=>[e.multiple||e.noCascaded?(o.openBlock(),o.createBlock(f,{key:0,inherit:"",class:o.normalizeClass(e.nh.be("checkbox")),checked:t.checked,control:e.hasChildren(t),partial:t.partial,disabled:e.isCheckboxDisabled(t),size:"small",onClick:o.withModifiers(p=>e.handleToggleCheck(t),["prevent","stop"])},null,8,["class","checked","control","partial","disabled","onClick"])):o.createCommentVNode("",!0),o.createElementVNode("span",{class:o.normalizeClass(e.nh.be("label"))},[o.renderSlot(e.$slots,"label",{option:t,index:d,selected:e.isSelected(t),canCheck:e.isCheckboxDisabled(t),hasChild:e.hasChildren(t),handleSelect:()=>e.handleSelect(t,d)},()=>[o.createTextVNode(o.toDisplayString(t.label),1)])],2),o.createElementVNode("div",{class:o.normalizeClass(e.nh.be("icon"))},[t.loading?(o.openBlock(),o.createBlock(i,{key:0,pulse:""},{default:o.withCtx(()=>[o.createVNode(v)]),_:1})):t.error?(o.openBlock(),o.createBlock(i,{key:1},{default:o.withCtx(()=>[o.createVNode(C)]),_:1})):e.hasChildren(t)?(o.openBlock(),o.createBlock(i,{key:2},{default:o.withCtx(()=>[o.createVNode(k)]),_:1})):!e.multiple&&!e.noCascaded&&e.checkIcon&&e.values.includes(t.fullValue)?(o.openBlock(),o.createBlock(i,{key:3,icon:e.checkIcon},null,8,["icon"])):o.createCommentVNode("",!0)],2)])]),_:2},1032,["class","value","label","disabled","selected","hitting","onSelect","onMouseenter"])]),_:3},8,["items","items-attrs","onResize"])],34)}var D=j(L,[["render",z]]);module.exports=D;
