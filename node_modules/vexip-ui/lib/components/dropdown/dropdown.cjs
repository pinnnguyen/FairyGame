"use strict";var e=require("vue");require("../portal/index.cjs");var g=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var V=require("./dropdown-drop.cjs"),y=require("./props.cjs"),O=require("./hooks.cjs"),f=require("./symbol.cjs"),$=require("../../_virtual/plugin-vue_export-helper.cjs"),M=require("../portal/portal.cjs"),S=require("../../common/config/src/namespace.cjs"),u=require("../../common/config/src/props.cjs");const R=e.defineComponent({name:"Dropdown",components:{DropdownDrop:V,Portal:M},props:y.dropdownProps,emits:["update:visible"],setup(r,{emit:t}){const l=S.useNameHelper("dropdown"),n=u.useProps("dropdown",r,{visible:{default:!1,static:!0},placement:{default:"bottom",validator:i=>g.placementWhileList.includes(i)},outsideClose:!0,trigger:{default:"hover",validator:i=>["hover","click","custom"].includes(i)},label:{default:null,static:!0},transitionName:()=>l.ns("drop"),transfer:!1,dropClass:null,appear:!1,meta:null}),s=e.inject(f.DROPDOWN_STATE,null),d=!!s,c=e.toRef(n,"label"),a=e.ref(n.placement),o=e.ref(n.visible),w=e.toRef(n,"transfer"),m=g.useClickOutside(L),{reference:h,popper:k,transferTo:E,updatePopper:D}=g.usePopper({placement:a,transfer:w,wrapper:m,isDrop:!0,offset:d?[-5,0]:void 0}),N=O.useLabel(c,h),q=e.computed(()=>({[l.b()]:!0,[l.bs("vars")]:!0,[l.bm("inherit")]:n.inherit,[l.bm("visible")]:o.value}));e.provide(f.SELECT_HANDLER,null),e.provide(f.DROPDOWN_STATE,{handleSelect:j,handleTriggerEnter:C,handleTriggerLeave:b}),e.watch(()=>n.visible,i=>{o.value=i}),e.watch(()=>n.placement,i=>{T(i)}),e.watch(o,i=>{i&&D(),u.emitEvent(n.onToggle,i),t("update:visible",i)}),e.onMounted(()=>{e.nextTick(()=>{T(n.placement)})});function L(){u.emitEvent(n.onClickOutside),n.outsideClose&&n.trigger!=="custom"&&o.value&&(o.value=!1,u.emitEvent(n.onOutsideClose))}function j(i,p){n.trigger!=="custom"&&(o.value=!1,u.emitEvent(n.onSelect,i,p)),typeof(s==null?void 0:s.handleSelect)=="function"&&s.handleSelect([N.value,...i],[n.meta||{},...p])}function T(i){const[p]=i.split("-");d&&p!=="right"&&p!=="left"?a.value="right-start":a.value=i}const{timer:v}=g.useSetTimeout();function C(){n.trigger==="hover"&&(clearTimeout(v.hover),typeof(s==null?void 0:s.handleTriggerEnter)=="function"&&s.handleTriggerEnter(),v.hover=setTimeout(()=>{o.value=!0},250))}function b(){n.trigger==="hover"&&(clearTimeout(v.hover),typeof(s==null?void 0:s.handleTriggerLeave)=="function"&&s.handleTriggerLeave(),v.hover=setTimeout(()=>{o.value=!1},250))}function P(){n.trigger==="click"&&(o.value=!o.value)}return{props:n,nh:l,isNested:d,currentVisible:o,transferTo:E,wrapper:m,reference:h,popper:k,className:q,handleTriggerEnter:C,handleTriggerLeave:b,handleTriggerClick:P}}});function z(r,t,l,n,s,d){const c=e.resolveComponent("Portal"),a=e.resolveComponent("DropdownDrop");return e.openBlock(),e.createElementBlock("div",{ref:"wrapper",class:e.normalizeClass(r.className),onMouseenter:t[5]||(t[5]=(...o)=>r.handleTriggerEnter&&r.handleTriggerEnter(...o)),onMouseleave:t[6]||(t[6]=(...o)=>r.handleTriggerLeave&&r.handleTriggerLeave(...o))},[e.createElementVNode("div",{ref:"reference",class:e.normalizeClass([r.nh.be("trigger"),r.currentVisible?r.nh.bem("trigger","active"):""]),onClick:t[0]||(t[0]=(...o)=>r.handleTriggerClick&&r.handleTriggerClick(...o)),onKeydown:[t[1]||(t[1]=e.withKeys(e.withModifiers((...o)=>r.handleTriggerClick&&r.handleTriggerClick(...o),["prevent"]),["enter"])),t[2]||(t[2]=e.withKeys(e.withModifiers((...o)=>r.handleTriggerClick&&r.handleTriggerClick(...o),["prevent"]),["space"]))]},[e.renderSlot(r.$slots,"default")],34),e.createVNode(a,null,{default:e.withCtx(()=>[e.createVNode(c,{to:r.transferTo},{default:e.withCtx(()=>[e.createVNode(e.Transition,{name:r.props.transitionName,appear:r.props.appear},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{ref:"popper",class:e.normalizeClass([r.nh.be("popper"),r.nh.bs("vars"),r.isNested?r.nh.bem("popper","nested"):null,r.props.dropClass]),onMouseenter:t[3]||(t[3]=(...o)=>r.handleTriggerEnter&&r.handleTriggerEnter(...o)),onMouseleave:t[4]||(t[4]=(...o)=>r.handleTriggerLeave&&r.handleTriggerLeave(...o))},[e.renderSlot(r.$slots,"drop")],34),[[e.vShow,r.currentVisible]])]),_:3},8,["name","appear"])]),_:3},8,["to"])]),_:3})],34)}var A=$(R,[["render",z]]);module.exports=A;
