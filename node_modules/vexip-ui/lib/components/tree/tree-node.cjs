"use strict";var a=require("vue");require("../checkbox/index.cjs");require("../collapse-transition/index.cjs");require("../icon/index.cjs");require("../renderer/index.cjs");require("../../common/config/src/index.cjs");var J=require("@vexip-ui/hooks"),N=require("@vexip-ui/utils"),V=require("@vexip-ui/icons"),E=require("./symbol.cjs"),Q=require("../../_virtual/plugin-vue_export-helper.cjs"),U=require("../checkbox/checkbox.cjs"),W=require("../collapse/collapse-transition.cjs"),X=require("../icon/icon.cjs"),Y=require("../renderer/renderer.cjs"),Z=require("../../common/config/src/namespace.cjs");const x=a.defineComponent({name:"TreeNode",components:{Checkbox:U,CollapseTransition:W,Icon:X,Renderer:Y,ChevronRight:V.ChevronRight,Spinner:V.Spinner},inheritAttrs:!1,props:{node:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})},arrow:{type:[Boolean,String],default:"auto",validator:e=>typeof e=="boolean"||e==="auto"},checkbox:{type:Boolean,default:null},appear:{type:Boolean,default:!1},visible:{type:Boolean,default:!0},selected:{type:Boolean,default:!1},expanded:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},labelKey:{type:String,default:"label"},checked:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loaded:{type:Boolean,default:!1},partial:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},indent:{type:[String,Number],default:"16px"},draggable:{type:Boolean,default:!1},floorSelect:{type:Boolean,default:!1},matched:{type:Boolean,default:!0},childMatched:{type:Boolean,default:!1},upperMatched:{type:Boolean,default:!1},nodeProps:{type:Function,default:N.noop}},setup(e){const n=a.inject(E.TREE_STATE),b=a.inject(E.TREE_NODE_STATE),r=Z.useNameHelper("tree"),v=a.ref(),w=a.ref();J.useModifier({target:v,passive:!1,onKeyDown:(l,d)=>{var m;const f=()=>{l.preventDefault(),l.stopPropagation()};if(d.up||d.down)f(),n.handleHittingChange(d.up?"up":"down");else if(d.left||d.right){f();const $=((m=e.node.children)==null?void 0:m.length)>0;d.right&&e.expanded&&$?n.handleHittingChange("down"):d.left&&(!e.expanded||!$)?n.handleNodeHitting(b.el):B(d.right)}else S.value&&d.space?(f(),T()):d.enter&&(f(),D())}});const g=a.ref(e.loaded),i=a.ref(!1),p=a.ref(!1),y=a.ref(!1),t=a.computed(()=>b.disabled||e.disabled),s=a.computed(()=>b.readonly||e.readonly),u=a.computed(()=>b.depth+1),o=a.computed(()=>!e.matched&&(e.childMatched||e.upperMatched)),c=a.computed(()=>({[r.be("node")]:!0,[r.bem("node","selected")]:e.selected,[r.bem("node","expanded")]:e.expanded,[r.bem("node","disabled")]:t.value,[r.bem("node","readonly")]:s.value,[r.bem("node","secondary")]:o.value,[r.bem("node","dragging")]:i.value,[r.bem("node","drag-over")]:p.value})),k=a.computed(()=>{let l=e.indent;return typeof l=="number"&&(l=`${l}px`),{paddingLeft:u.value?u.value===1?l:`calc(${u.value} * ${l})`:0}}),j=a.computed(()=>{var l;return e.expanded&&((l=e.node.children)==null?void 0:l.length)>0}),q=a.computed(()=>{var m;const l=e.arrow;let d="auto",f=!1;return N.isNull(l)||l==="auto"?n&&(d=n.arrow,f=n.boundAsyncLoad):d=l,d==="auto"?!!((m=e.node.children)!=null&&m.length)||!g.value&&f:!!d}),S=a.computed(()=>{const l=e.checkbox;return N.isNull(l)?n.checkbox:l}),A=a.computed(()=>n.renderer),L=a.computed(()=>n.suffixCheckbox);a.provide(E.TREE_NODE_STATE,a.reactive({el:v,depth:u,disabled:t,readonly:s})),a.watch(()=>e.loaded,l=>{g.value=l});function R(){n.updateVisibleNodeEls()}function h(l,d){e.node[l]=d}function M(){n.handleNodeClick(e.node)}function T(l=!e.checked){t.value||(h("checked",l),h("partial",!1),a.nextTick(()=>{n.computeCheckedState(e.node,l)}))}async function B(l=!e.expanded){if(!(e.loading||t.value))if(l&&n.boundAsyncLoad&&!g.value){h("loading",!0);const d=await n.handleAsyncLoad(e.node);z(d)}else h("expanded",l),l?n.handleNodeExpand(e.node):n.handleNodeReduce(e.node)}function D(l=!e.selected){if(!t.value){if(e.floorSelect)return B();h("selected",!s.value&&l),s.value||l?n.handleNodeSelect(e.node):n.handleNodeCancel(e.node)}}function P(){n.handleLabelClick(e.node),D()}function z(l=!0){h("loading",!1),h("expanded",l!==!1),l&&(g.value=!0,n.handleNodeExpand(e.node))}function C(){return{el:v.value,arrow:w.value,node:e.node}}function O(){!e.draggable||(i.value=!0,n.handleNodeDragStart(C()))}function H(l){!e.draggable||!n.dragging||(l.stopPropagation(),l.preventDefault(),p.value=!0,n.handleNodeDragOver(C(),l))}function F(l){!e.draggable||(l.preventDefault(),p.value=!1)}function K(l){!e.draggable||!n.dragging||(l.stopPropagation(),l.preventDefault(),p.value=!1,n.handleNodeDrop(C()))}function I(l){!e.draggable||!n.dragging||(l.stopPropagation(),i.value=!1,n.handleNodeDragEnd(C()))}function G(l){return l.children}return{nh:r,dragging:i,focused:y,isDisabled:t,isReadonly:s,depth:u,secondary:o,className:c,contentStyle:k,showChildren:j,hasArrow:q,hasCheckbox:S,renderer:A,suffixCheckbox:L,wrapper:v,arrowEl:w,updateVisible:R,handleClick:M,handleToggleCheck:T,handleToggleExpand:B,handleToggleSelect:D,handleLabelClick:P,handleDragStart:O,handleDragOver:H,handleDragLeave:F,handleDrop:K,handleDragEnd:I,getNodeChildren:G}}}),_=["draggable","aria-disabled","aria-grabbed"],ee=["aria-hidden"];function ae(e,n,b,r,v,w){const g=a.resolveComponent("Spinner"),i=a.resolveComponent("Icon"),p=a.resolveComponent("ChevronRight"),y=a.resolveComponent("Checkbox"),t=a.resolveComponent("Renderer"),s=a.resolveComponent("TreeNode",!0),u=a.resolveComponent("CollapseTransition");return a.openBlock(),a.createElementBlock(a.Fragment,null,[e.visible&&(e.matched||e.childMatched)?(a.openBlock(),a.createElementBlock("li",a.mergeProps({key:0,ref:"wrapper"},e.$attrs,{class:e.className,draggable:e.draggable,tabindex:"-1","aria-disabled":e.isDisabled,"aria-grabbed":e.draggable&&e.dragging?"true":void 0,onClick:n[4]||(n[4]=a.withModifiers((...o)=>e.handleClick&&e.handleClick(...o),["left"])),onFocus:n[5]||(n[5]=o=>e.focused=!0),onBlur:n[6]||(n[6]=o=>e.focused=!1),onDragstart:n[7]||(n[7]=a.withModifiers((...o)=>e.handleDragStart&&e.handleDragStart(...o),["stop"])),onDragover:n[8]||(n[8]=(...o)=>e.handleDragOver&&e.handleDragOver(...o)),onDragleave:n[9]||(n[9]=(...o)=>e.handleDragLeave&&e.handleDragLeave(...o)),onDragend:n[10]||(n[10]=(...o)=>e.handleDragEnd&&e.handleDragEnd(...o)),onDrop:n[11]||(n[11]=(...o)=>e.handleDrop&&e.handleDrop(...o))}),[a.renderSlot(e.$slots,"default",{data:e.node.data,node:e.node,depth:e.depth,focused:e.focused,toggleCheck:e.handleToggleCheck,toggleExpand:e.handleToggleExpand,toggleSelect:e.handleToggleSelect},()=>{var o;return[a.createElementVNode("div",{class:a.normalizeClass(e.nh.be("content")),style:a.normalizeStyle(e.contentStyle)},[a.createElementVNode("span",{ref:"arrowEl",class:a.normalizeClass({[e.nh.be("arrow")]:!0,[e.nh.bem("arrow","transparent")]:!e.loading&&!e.hasArrow,[e.nh.bem("arrow","expanded")]:e.expanded}),"aria-hidden":!e.loading&&!e.hasArrow,onClick:n[0]||(n[0]=a.withModifiers(c=>e.handleToggleExpand(),["stop"]))},[e.loading?(a.openBlock(),a.createBlock(i,{key:0,pulse:""},{default:a.withCtx(()=>[a.createVNode(g)]),_:1})):(a.openBlock(),a.createBlock(i,{key:1},{default:a.withCtx(()=>[a.createVNode(p)]),_:1}))],10,ee),e.hasCheckbox&&!e.suffixCheckbox?(a.openBlock(),a.createBlock(y,{key:0,inherit:"",class:a.normalizeClass(e.nh.be("checkbox")),"tab-index":-1,control:e.hasArrow,checked:e.checked,disabled:e.isDisabled,partial:e.partial,onClick:n[1]||(n[1]=a.withModifiers(c=>e.handleToggleCheck(),["prevent","stop"]))},null,8,["class","control","checked","disabled","partial"])):a.createCommentVNode("",!0),a.createElementVNode("div",{class:a.normalizeClass({[e.nh.be("label")]:!0,[e.nh.bem("label","focused")]:e.focused,[e.nh.bem("label","selected")]:e.selected,[e.nh.bem("label","disabled")]:e.isDisabled,[e.nh.bem("label","readonly")]:e.isReadonly,[e.nh.bem("label","is-floor")]:e.floorSelect&&((o=e.node.children)==null?void 0:o.length),[e.nh.bem("label","secondary")]:e.secondary}),onClick:n[2]||(n[2]=c=>e.handleLabelClick())},[e.renderer?(a.openBlock(),a.createBlock(t,{key:0,renderer:e.renderer,data:{node:e.node,depth:e.depth,data:e.node.data}},null,8,["renderer","data"])):a.renderSlot(e.$slots,"label",{key:1,data:e.node.data,node:e.node,depth:e.depth,focused:e.focused},()=>[a.createTextVNode(a.toDisplayString(e.data[e.labelKey]),1)])],2),e.hasCheckbox&&e.suffixCheckbox?(a.openBlock(),a.createBlock(y,{key:1,inherit:"",class:a.normalizeClass([e.nh.be("checkbox"),e.nh.bem("checkbox","suffix")]),"tab-index":-1,control:e.hasArrow,checked:e.checked,disabled:e.isDisabled,partial:e.partial,onClick:n[3]||(n[3]=a.withModifiers(c=>e.handleToggleCheck(),["prevent","stop"]))},null,8,["class","control","checked","disabled","partial"])):a.createCommentVNode("",!0)],6)]})],16,_)):a.createCommentVNode("",!0),a.createVNode(u,{appear:e.appear,onAfterEnter:e.updateVisible,onAfterLeave:e.updateVisible},{default:a.withCtx(()=>[e.showChildren?(a.openBlock(),a.createElementBlock("ul",{key:0,class:a.normalizeClass(e.nh.be("list"))},[(a.openBlock(!0),a.createElementBlock(a.Fragment,null,a.renderList(e.node.children,(o,c)=>(a.openBlock(),a.createBlock(s,a.mergeProps({key:c},e.nodeProps(o.data,o),{node:o,data:o.data,arrow:o.arrow,checkbox:o.checkbox,appear:e.appear,visible:o.visible,selected:o.selected,expanded:o.expanded,disabled:o.disabled,"label-key":e.labelKey,checked:o.checked,loading:o.loading,loaded:o.loaded,partial:o.partial,readonly:o.readonly,indent:e.indent,draggable:e.draggable,"floor-select":e.floorSelect,matched:o.matched,"child-matched":o.childMatched,"upper-matched":o.upperMatched,"node-props":e.nodeProps}),{default:a.withCtx(k=>[a.renderSlot(e.$slots,"default",a.normalizeProps(a.guardReactiveProps(k)))]),label:a.withCtx(k=>[a.renderSlot(e.$slots,"label",a.normalizeProps(a.guardReactiveProps(k)))]),_:2},1040,["node","data","arrow","checkbox","appear","visible","selected","expanded","disabled","label-key","checked","loading","loaded","partial","readonly","indent","draggable","floor-select","matched","child-matched","upper-matched","node-props"]))),128))],2)):a.createCommentVNode("",!0)]),_:3},8,["appear","onAfterEnter","onAfterLeave"])],64)}var ne=Q(x,[["render",ae]]);module.exports=ne;
