"use strict";var t=require("vue");require("../divider/index.cjs");require("../icon/index.cjs");require("../renderer/index.cjs");var v=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var k=require("@vexip-ui/hooks"),T=require("@vexip-ui/utils"),le=require("./props.cjs"),p=require("./symbol.cjs"),re=require("../../_virtual/plugin-vue_export-helper.cjs"),ae=require("../divider/divider.cjs"),ie=require("../icon/icon.cjs"),se=require("../renderer/renderer.cjs"),i=require("../../common/config/src/props.cjs"),ue=require("../../common/config/src/namespace.cjs"),ce=require("../../common/config/src/locale/index.cjs");const de=t.defineComponent({name:"Viewer",components:{Divider:ae,Icon:ie,Renderer:se},props:le.viewerProps,emits:[],setup(n){const e=i.useProps("viewer",n,{width:"100%",height:"100%",moveDisabled:!1,zoomDisabled:!1,zoomDelta:.15,zoomMin:.1,zoomMax:1/0,rotateDisabled:!1,rotateDelta:90,flipDisabled:!1,fullDisabled:!1,toolbarPlacement:"bottom",actions:()=>[],toolbarFade:!1,noTransition:!1}),a=ue.useNameHelper("viewer"),s=ce.useLocale("viewer"),{timer:E}=k.useSetTimeout(),A=t.ref(!1),u=t.ref(1),c=t.ref(0),f=t.ref(!1),r=t.ref(!1),b=t.ref(),{supported:V,target:$,full:D,enter:j,exit:L}=k.useFullScreen(),{target:h,x:g,y,moving:R}=k.useMoving({onStart:(o,l)=>{if(e.moveDisabled||l.button>0)return!1;i.emitEvent(e.onMoveStart,q())},onMove:()=>{i.emitEvent(e.onMoveStart,q())},onEnd:()=>{i.emitEvent(e.onMoveStart,q())}}),d=t.reactive({zoom:u,rotate:c,flipX:f,flipY:r,full:D,moving:R,x:g,y}),z={x:0,y:0};k.useModifier({target:$,passive:!1,onKeyDown:(o,l)=>{if(l.up||l.down||l.left||l.right){o.preventDefault();const m=l.up||l.down?y:g,w=l.up||l.left?-10:10;m.value+=o.ctrlKey?5*w:w,l.resetAll()}}});function q(){return d}function H(o,l){const m=o[l];return typeof m=="function"?m(d):m}const W=[{name:p.InternalActionName.RotateRight,icon:v.ArrowRotateRight,process:()=>C(e.rotateDelta),title:()=>s.value.rotateRight,hidden:()=>e.rotateDisabled},{name:p.InternalActionName.RotateLeft,icon:v.ArrowRotateLeft,process:()=>C(-1*e.rotateDelta),title:()=>s.value.rotateLeft,hidden:()=>e.rotateDisabled,divided:!0},{name:p.InternalActionName.FlipHorizontal,icon:v.Repeat,process:()=>B(),title:()=>s.value.flipHorizontal,hidden:()=>e.flipDisabled},{name:p.InternalActionName.FlipVertical,icon:v.Repeat,process:()=>M(),title:()=>s.value.flipVertical,hidden:()=>e.flipDisabled,iconStyle:"transform: rotate(90deg)",divided:!0},{name:p.InternalActionName.ZoomIn,icon:v.Plus,process:()=>F(e.zoomDelta),title:()=>s.value.zoomIn,hidden:()=>e.zoomDisabled},{name:p.InternalActionName.ZoomOut,icon:v.Minus,process:()=>F(-1*e.zoomDelta),title:()=>s.value.zoomOut,hidden:()=>e.zoomDisabled,divided:!0},{name:p.InternalActionName.FullScreen,icon:v.Expand,process:()=>N(!0),title:()=>s.value.fullScreen,hidden:()=>e.fullDisabled||D.value,divided:!0},{name:p.InternalActionName.FullScreenExit,icon:v.Compress,process:()=>N(!1),title:()=>s.value.fullScreenExit,hidden:()=>e.fullDisabled||!D.value,divided:!0},{name:p.InternalActionName.Reset,icon:v.ArrowsRotate,process:I,title:()=>s.value.reset,divided:!0}],Y=t.computed(()=>({[a.b()]:!0,[a.bs("vars")]:!0,[a.bm("inherit")]:e.inherit,[a.bm("draggable")]:!e.moveDisabled,[a.bm("resizable")]:!e.zoomDisabled,[a.bm("full")]:D.value,[a.bm("moving")]:R.value,[a.bm("static")]:e.noTransition})),X=t.computed(()=>({width:/\d$/.test(`${e.width}`)?`${e.width}px`:e.width,height:/\d$/.test(`${e.height}`)?`${e.height}px`:e.height})),P=t.computed(()=>{const[o]=e.toolbarPlacement.split("-");return o==="left"||o==="right"}),Z=t.computed(()=>({[a.be("toolbar")]:!0,[a.bem("toolbar","active")]:e.toolbarFade<300||A.value,[a.bem("toolbar",e.toolbarPlacement)]:!0,[a.bem("toolbar","vertical")]:P.value})),x=t.computed(()=>({transform:`translate3d(${g.value}px, ${y.value}px, 0) scale(${u.value})`})),O=t.computed(()=>({transform:`scaleX(${f.value?-1:1}) scaleY(${r.value?-1:1}) rotate(${c.value}deg)`})),K=t.computed(()=>{const o=new Map;return W.concat(e.actions).forEach(l=>{l.name&&o.set(l.name,l)}),Array.from(o.values())});t.onMounted(()=>{if(h.value){const o=h.value.getBoundingClientRect();z.x=o.left+o.width*.5,z.y=o.top+o.height*.5}});function G(o){o.stopPropagation(),o.preventDefault();const l=o.deltaY>0?-1:1;z.x=o.clientX,z.y=o.clientY,i.emitEvent(e.onWheel,l,d),F(l*e.zoomDelta)}function C(o){e.rotateDisabled||(c.value+=o,e.noTransition&&c.value%360===0&&(c.value=0),i.emitEvent(e.onRotate,o,d))}function B(o=!f.value){e.flipDisabled||(f.value=o,i.emitEvent(e.onFlipX,o,d))}function M(o=!r.value){e.flipDisabled||(r.value=o,i.emitEvent(e.onFlipY,o,d))}function F(o){if(e.zoomDisabled||!h.value)return;const l=h.value.getBoundingClientRect(),{x:m,y:w}=z,{offsetWidth:_,offsetHeight:ee}=h.value,te=u.value;u.value=T.toFixed(T.boundRange(u.value+o,e.zoomMin,e.zoomMax),5);const S=u.value/te-1,oe=S*_*.5,ne=S*ee*.5;g.value-=S*(m-l.left-g.value)-oe,y.value-=S*(w-l.top-y.value)-ne,i.emitEvent(e.onZoom,u.value,d)}async function N(o=!D.value){o?await j():await L(),i.emitEvent(e.onFull,o,d)}function I(){y.value=0,g.value=0,c.value=0,f.value=!1,r.value=!1,u.value=1,i.emitEvent(e.onReset,d)}function J(){const o=[];c.value%360===0&&o.push(()=>{b.value&&(b.value.style.transitionDuration="0ms")},()=>{c.value=0},()=>{b.value&&(b.value.style.transitionDuration="")});const l=()=>{var m;(m=o.shift())==null||m(),o.length&&requestAnimationFrame(l)};l()}function Q(){clearTimeout(E.toolbarFade),A.value=!0}function U(){clearTimeout(E.toolbarFade);const o=typeof e.toolbarFade=="number"?e.toolbarFade:e.toolbarFade?1500:0;o>0&&(E.toolbarFade=setTimeout(()=>{A.value=!1},o))}return{props:e,nh:a,moving:R,fullSupported:V,state:d,viewer:$,container:h,transition:b,className:Y,style:X,toolbarVertical:P,toolbarClass:Z,contentStyle:x,transitionStyle:O,allActions:K,getActionProp:H,handleWheel:G,handleRotate:C,toggleFlipHorizontal:B,toggleFlipVertical:M,handleZoom:F,toggleFull:N,handleReset:I,normalizeProps:J,handleEnterToolbar:Q,handleLeaveToolbar:U}}}),me=["title","onClick"];function ve(n,e,a,s,E,A){const u=t.resolveComponent("Renderer"),c=t.resolveComponent("Icon"),f=t.resolveComponent("Divider");return t.openBlock(),t.createElementBlock("div",{ref:"viewer",class:t.normalizeClass(n.className),tabindex:"0",style:t.normalizeStyle(n.style)},[t.createElementVNode("div",{ref:"container",class:t.normalizeClass(n.nh.be("container")),onWheel:e[1]||(e[1]=(...r)=>n.handleWheel&&n.handleWheel(...r))},[t.createElementVNode("div",{class:t.normalizeClass(n.nh.be("content")),style:t.normalizeStyle(n.contentStyle)},[t.createElementVNode("div",{ref:"transition",class:t.normalizeClass(n.nh.be("transition")),style:t.normalizeStyle(n.transitionStyle),onTransitionend:e[0]||(e[0]=(...r)=>n.normalizeProps&&n.normalizeProps(...r))},[t.renderSlot(n.$slots,"default")],38)],6)],34),t.createElementVNode("div",{class:t.normalizeClass(n.toolbarClass),role:"toolbar",onMouseenter:e[2]||(e[2]=(...r)=>n.handleEnterToolbar&&n.handleEnterToolbar(...r)),onMouseleave:e[3]||(e[3]=(...r)=>n.handleLeaveToolbar&&n.handleLeaveToolbar(...r))},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.allActions,r=>(t.openBlock(),t.createElementBlock(t.Fragment,{key:r.name},[n.getActionProp(r,"hidden")?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.createElementVNode("button",{class:t.normalizeClass({[n.nh.be("action")]:!0,[n.nh.bem("action","disabled")]:n.getActionProp(r,"disabled")}),title:n.getActionProp(r,"title"),onClick:t.withModifiers(b=>r.process(n.state),["stop"])},[typeof r.icon=="function"?(t.openBlock(),t.createBlock(u,{key:0,renderer:r.icon,data:{state:n.state}},null,8,["renderer","data"])):(t.openBlock(),t.createBlock(c,{key:1,icon:r.icon,style:t.normalizeStyle(n.getActionProp(r,"iconStyle")),scale:n.getActionProp(r,"iconScale")||1},null,8,["icon","style","scale"]))],10,me),n.getActionProp(r,"divided")?(t.openBlock(),t.createBlock(f,{key:0,inherit:"",vertical:!n.toolbarVertical},null,8,["vertical"])):t.createCommentVNode("",!0)],64))],64))),128))],34)],6)}var pe=re(de,[["render",ve]]);module.exports=pe;
