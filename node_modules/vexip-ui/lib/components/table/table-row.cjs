"use strict";var t=require("vue");require("../collapse-transition/index.cjs");require("../renderer/index.cjs");require("../../common/config/src/index.cjs");var W=require("@vexip-ui/utils"),H=require("./symbol.cjs"),z=require("../../_virtual/plugin-vue_export-helper.cjs"),K=require("../collapse/collapse-transition.cjs"),U=require("../renderer/renderer.cjs"),Y=require("../../common/config/src/namespace.cjs");const G=t.defineComponent({name:"TableRow",components:{CollapseTransition:K,Renderer:U},props:{row:{type:Object,default:()=>({})},index:{type:Number,default:null},isHead:{type:Boolean,default:!1},isFixed:{type:Boolean,default:!1}},setup(e){const{state:r,mutations:l}=t.inject(H.TABLE_STORE),i=t.inject(H.TABLE_ACTION),s=Y.useNameHelper("table"),f=t.ref(),a=t.ref(),m=t.ref(),o=t.reactive({el:f,row:t.toRef(e,"row")}),h=t.computed(()=>e.isHead?H.TABLE_HEAD_KEY:e.row.key),C=t.computed(()=>{let n=null;return e.isHead||(typeof r.rowClass=="function"?n=r.rowClass(e.row.data,e.index):n=r.rowClass),[s.be("row"),{[s.bem("row","hover")]:!e.isHead&&r.highlight&&e.row.hover,[s.bem("row","stripe")]:e.index%2===1,[s.bem("row","checked")]:e.row.checked},n]}),b=t.computed(()=>{let n="";return e.isHead||(typeof r.rowStyle=="function"?n=r.rowStyle(e.row.data,e.index):n=r.rowStyle),[{minHeight:r.rowHeight?void 0:`${r.rowMinHeight}px`},n]}),R=t.computed(()=>e.isHead?null:typeof r.rowAttrs=="function"?r.rowAttrs(e.row.data,e.index):r.rowAttrs),g=t.computed(()=>!e.isHead&&r.rowDraggable),p=t.computed(()=>r.dragging),D=t.computed(()=>r.columns.find(n=>n.type==="expand")),x=t.computed(()=>r.expandRenderer),E=t.computed(()=>e.isFixed?{width:"1px",overflow:"hidden",whiteSpace:"nowrap",visibility:"hidden"}:{}),F=t.computed(()=>y(r.leftFixedColumns)),B=t.computed(()=>y(r.rightFixedColumns));function T(n){return n?(n.borderHeight||0)+(n.height||0)+(n.expandHeight||0):0}function y(n){if(!(n!=null&&n.length))return 0;const d=r.widths;let u=0;for(let c=0,I=n.length;c<I;++c){const P=n[c].key;u+=d[P]}return u}function w(){!Object.keys(e.row).length||e.row.hidden||(k(),S(),r.heightBITree&&!e.isFixed&&t.nextTick(()=>{const n=T(e.row),d=r.heightBITree,u=d.get(e.index);n!==u&&(d.add(e.index,n-u),l.updateTotalHeight())}))}t.watch(()=>e.row.hidden,n=>{!n&&w()}),t.watch(()=>e.row,()=>{w()}),t.onMounted(()=>{w(),l.updateTotalHeight()}),t.onUpdated(()=>{r.rowHeight?e.row.hidden||k():w()});function S(){r.rowHeight?(l.setRowHeight(h.value,r.rowHeight),t.nextTick(()=>{a.value&&(a.value.style.height=`${r.rowHeight}px`,a.value.style.maxHeight=`${r.rowHeight}px`)})):t.nextTick(()=>{e.isFixed?setTimeout(()=>{a.value&&(a.value.style.height=`${e.row.height}px`)},0):a.value&&l.setRowHeight(h.value,a.value.offsetHeight)})}function k(){var n;if(f.value){const d=getComputedStyle(f.value),u=parseFloat(d.borderTopWidth)+parseFloat(d.borderBottomWidth);l.setBorderHeight(h.value,u),l.setRowExpandHeight(h.value,((n=m.value)==null?void 0:n.offsetHeight)||0)}}function v(n){return{row:e.row.data,key:e.row.key,index:e.index,event:n}}function A(n){if(l.setRowHover(h.value,!0),!e.isHead&&i){const{data:d,key:u,index:c}=e.row;i.emitRowEnter({row:d,key:u,index:c,event:n})}}function j(n){l.setRowHover(h.value,!1),!e.isHead&&i&&i.emitRowLeave(v(n))}function M(n){!e.isHead&&i&&i.emitRowClick(v(n))}function q(n){!e.isHead&&i&&i.emitRowDblclick(v(n))}function N(n){!e.isHead&&i&&i.emitRowContextmenu(v(n))}function L(n){!g.value||i.handleRowDragStart(o,n)}function $(n){!g.value||!p.value||(n.stopPropagation(),n.preventDefault(),i.handleRowDragOver(o,n))}function O(n){!g.value||!p.value||(n.stopPropagation(),n.preventDefault(),i.handleRowDrop(o,n))}function V(n){!g.value||!p.value||(n.stopPropagation(),i.handleRowDragEnd(n))}return{nh:s,className:C,style:b,attrs:R,draggable:g,expandColumn:D,expandRenderer:x,expandStyle:E,leftFixed:F,rightFixed:B,wrapper:f,rowEl:a,expand:m,isFunction:W.isFunction,handleMouseEnter:A,handleMouseLeave:j,handleClick:M,handleDblclick:q,handleContextmenu:N,handleDragStart:L,handleDragOver:$,handleDrop:O,handleDragEnd:V,computeRectHeight:w}}}),J=["draggable"],Q=["aria-rowindex"];function X(e,r,l,i,s,f){const a=t.resolveComponent("Renderer"),m=t.resolveComponent("CollapseTransition");return e.row.hidden?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,ref:"wrapper",class:t.normalizeClass([e.nh.be("group"),e.row.checked&&e.nh.bem("group","checked")]),draggable:e.draggable,onMouseenter:r[0]||(r[0]=(...o)=>e.handleMouseEnter&&e.handleMouseEnter(...o)),onMouseleave:r[1]||(r[1]=(...o)=>e.handleMouseLeave&&e.handleMouseLeave(...o)),onClick:r[2]||(r[2]=(...o)=>e.handleClick&&e.handleClick(...o)),onDblclick:r[3]||(r[3]=(...o)=>e.handleDblclick&&e.handleDblclick(...o)),onContextmenu:r[4]||(r[4]=(...o)=>e.handleContextmenu&&e.handleContextmenu(...o)),onDragstart:r[5]||(r[5]=t.withModifiers((...o)=>e.handleDragStart&&e.handleDragStart(...o),["stop"])),onDragover:r[6]||(r[6]=(...o)=>e.handleDragOver&&e.handleDragOver(...o)),onDragend:r[7]||(r[7]=(...o)=>e.handleDragEnd&&e.handleDragEnd(...o)),onDrop:r[8]||(r[8]=(...o)=>e.handleDrop&&e.handleDrop(...o))},[t.createElementVNode("div",t.mergeProps({ref:"rowEl",class:e.className,role:"row",style:e.style,"aria-rowindex":e.index},e.attrs),[t.renderSlot(e.$slots,"default")],16,Q),e.expandColumn?(t.openBlock(),t.createBlock(m,{key:0,appear:"",onAfterEnter:e.computeRectHeight,onAfterLeave:e.computeRectHeight},{default:t.withCtx(()=>[e.row.expanded?(t.openBlock(),t.createElementBlock("div",{key:0,ref:"expand",class:t.normalizeClass(e.nh.be("collapse")),style:t.normalizeStyle(e.expandStyle)},[e.isFunction(e.expandColumn.renderer)?(t.openBlock(),t.createBlock(a,{key:0,renderer:e.expandColumn.renderer,data:{leftFixed:e.leftFixed,rightFixed:e.rightFixed,row:e.row.data,rowIndex:e.index}},null,8,["renderer","data"])):e.isFunction(e.expandRenderer)?(t.openBlock(),t.createBlock(a,{key:1,renderer:e.expandRenderer,data:{leftFixed:e.leftFixed,rightFixed:e.rightFixed,row:e.row.data,rowIndex:e.index}},null,8,["renderer","data"])):t.createCommentVNode("",!0)],6)):t.createCommentVNode("",!0)]),_:1},8,["onAfterEnter","onAfterLeave"])):t.createCommentVNode("",!0)],42,J))}var Z=z(G,[["render",X]]);module.exports=Z;
