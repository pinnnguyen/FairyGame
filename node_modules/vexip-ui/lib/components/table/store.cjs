"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var m=require("vue"),b=require("@vexip-ui/utils"),R=require("./symbol.cjs");let He=1;function D(){return`__vtr-${He++}`}function Se(g){return g+1}function Me(g){var Y;const n=m.reactive({columns:[],data:[],rowClass:"",rowStyle:"",rowAttrs:null,cellClass:"",cellStyle:"",cellAttrs:null,headClass:"",headStyle:"",headAttrs:null,width:0,dataKey:(Y=g.dataKey)!=null?Y:R.DEFAULT_KEY_FIELD,highlight:!1,currentPage:1,pageSize:0,rowHeight:g.rowHeight,rowMinHeight:g.rowMinHeight||36,virtual:g.virtual,rowDraggable:!!g.rowDraggable,emptyText:g.emptyText,tooltipTheme:g.tooltipTheme,tooltipWidth:g.tooltipWidth,singleSorter:g.singleSorter,singleFilter:g.singleFilter,expandRenderer:g.expandRenderer,rowData:[],rightFixedColumns:[],leftFixedColumns:[],dataMap:{},idMaps:new WeakMap,checkedAll:!1,partial:!1,widths:{},sorters:{},filters:{},bodyScroll:0,padTop:0,startRow:0,endRow:0,dragging:!1,heightBITree:null,virtualData:[],totalHeight:g.rowMinHeight*g.data.length});S(n,g.columns),M(n,g.data),T(n,g.currentPage),A(n,g.pageSize),F(n,g.rowClass),E(n,g.rowStyle),N(n,g.rowAttrs),I(n,g.cellClass),W(n,g.cellStyle),K(n,g.cellAttrs),_(n,g.headClass),B(n,g.headStyle),O(n,g.headAttrs),j(n,g.highlight),z(n,g.virtual);const v=m.computed(()=>ve(n.filters,n.rowData,n.singleFilter)),H=m.computed(()=>Ce(n.sorters,v.value,n.columns,n.singleSorter)),C=m.computed(()=>De(n.currentPage,n.pageSize,H.value)),G=m.computed(()=>{const t=C.value,e=n.columns.find(o=>o.type==="selection"),l={};if(e&&typeof e.disableRow=="function"){const o=e.disableRow;for(let a=0,r=t.length;a<r;++a){const s=t[a];o(s.data)&&(l[s.key]=!0)}}return l}),U=m.computed(()=>{const t=C.value,e=n.columns.find(o=>o.type==="expand"),l={};if(e&&typeof e.disableRow=="function"){const o=e.disableRow;for(let a=0,r=t.length;a<r;++a){const s=t[a];if(o(s.data)){const c=s.key;l[c]=!0}}}return l});m.watchEffect(()=>{n.heightBITree=m.markRaw(b.createBITree(v.value.length,n.rowHeight||n.rowMinHeight)),q(n)});const k=m.reactive({filteredData:v,sortedData:H,processedData:C,disableCheckRows:G,disableExpandRows:U}),V={setColumns:b.debounceMinor(S.bind(null,n)),setData:b.debounceMinor(M.bind(null,n)),setDataKey:$.bind(null,n),setCurrentPage:T.bind(null,n),setPageSize:A.bind(null,n),setRowClass:F.bind(null,n),setRowStyle:E.bind(null,n),setRowAttrs:N.bind(null,n),setCellClass:I.bind(null,n),setCellStyle:W.bind(null,n),setCellAttrs:K.bind(null,n),setHeadClass:_.bind(null,n),setHeadStyle:B.bind(null,n),setHeadAttrs:O.bind(null,n),setTableWidth:J.bind(null,n),setColumnWidth:Q.bind(null,n),setRowHeight:X.bind(null,n),setBorderHeight:Z.bind(null,n),setGlobalRowHeight:ee.bind(null,n),setMinRowHeight:te.bind(null,n),setVirtual:z.bind(null,n),setRowDraggable:le.bind(null,n),setRowExpandHeight:ne.bind(null,n),setBodyScroll:ie.bind(null,n),setHighlight:j.bind(null,n),setRowHover:oe.bind(null,n),setEmptyText:ae.bind(null,n),setTooltipTheme:se.bind(null,n),setTooltipWidth:re.bind(null,n),setSingleSorter:ce.bind(null,n),setSingleFilter:de.bind(null,n),setDragging:ue.bind(null,n),handleSort:fe.bind(null,n),clearSort:L.bind(null,n),handleFilter:he.bind(null,n),clearFilter:P.bind(null,n),toggleFilterItemActive:ye.bind(null,n),refreshRowIndex:ke.bind(null,n),updateTotalHeight:b.debounceMinor(q.bind(null,n)),handleCheck:ge.bind(null,n,k),handleCheckAll:be.bind(null,n,k),clearCheckAll:pe.bind(null,n,k),setRenderRows:we.bind(null,n,k),handleExpand:me.bind(null,n,k)};function S(t,e){e=Array.from(e).sort((u,h)=>(u.order||0)-(h.order||0));const{widths:l,sorters:o,filters:a}=t,r=[],s=[],c=[],f=["order","selection","expand"];for(let u=0,h=e.length;u<h;++u){const i={...e[u]};if("type"in i&&f.includes(i.type))switch(i.type){case"order":{i.truthIndex=!!i.truthIndex,typeof i.orderLabel!="function"&&(i.orderLabel=Se),b.isNull(i.width)&&(i.width=60);break}case"selection":{i.checkboxSize=i.checkboxSize||"default",typeof i.disableRow!="function"&&(i.disableRow=()=>!1),b.isNull(i.width)&&(i.width=40);break}case"expand":{typeof i.disableRow!="function"&&(i.disableRow=()=>!1),b.isNull(i.width)&&(i.width=40);break}}let d=i.key;b.isNull(d)&&(d=D(),console.error("[vexip-ui:Table] Table column requires key prop, but missing"));const p=i.fixed;l[d]=i.width||100,o[d]=xe(i.sorter),a[d]=Re(i.filter),i.key=d,p===!0||p==="left"?c.push(i):p==="right"?s.push(i):r.push(i)}t.columns=c.concat(r,s),c.length&&(t.leftFixedColumns=c),s.length&&(t.rightFixedColumns=s)}function $(t,e){const l=t.dataKey;if(!b.isNull(e)&&l!==e){const{rowData:o,idMaps:a}=t;t.dataKey=e,o.forEach(r=>{let s=r.data[e];b.isNull(s)&&(s=D()),r.key=s,a.set(r.data,s)})}}function M(t,e){const l=[],o={},{dataKey:a,idMaps:r}=t,s=t.dataMap,c=!!t.virtual;o[R.TABLE_HEAD_KEY]=s[R.TABLE_HEAD_KEY]||{key:R.TABLE_HEAD_KEY};for(let f=0,u=e.length;f<u;++f){const h=e[f];let i=h[a];b.isNull(i)&&(i=r.get(h),b.isNull(i)&&(i=D()));let d;if(s[i]){if(d=s[i],d.data!==h){const{checked:p,height:y,expanded:w}=Object.assign(d.data,h);d.checked=b.isNull(p)?d.checked:!!p,d.height=b.isNull(y)?d.height:b.toNumber(y),d.expanded=b.isNull(w)?d.expanded:!!w}}else{const{checked:p,height:y,expanded:w}=h;d={key:i,hidden:c,checked:!!p,height:b.toNumber(y),borderHeight:0,expanded:!!w,hover:!1,expandHeight:0,index:-1,data:h},r.set(h,i)}d.index=f,l.push(d),o[i]=d}t.rowData=l,t.dataMap=o,x(t)}function T(t,e){t.currentPage=e!=null?e:1}function A(t,e){t.pageSize=e||t.rowData.length}function F(t,e){t.rowClass=e!=null?e:""}function E(t,e){t.rowStyle=e!=null?e:""}function N(t,e){t.rowAttrs=e!=null?e:null}function I(t,e){t.cellClass=e!=null?e:""}function W(t,e){t.cellStyle=e!=null?e:""}function K(t,e){t.cellAttrs=e!=null?e:null}function _(t,e){t.headClass=e!=null?e:""}function B(t,e){t.headStyle=e!=null?e:""}function O(t,e){t.headAttrs=e!=null?e:null}function J(t,e){e=b.toNumber(e);const{columns:l,widths:o}=t,a=[],r=[];let s=e;for(let u=0,h=l.length;u<h;++u){const i=l[u];i.width?(s-=i.width,a.push(i)):r.push(i)}const c=r.length;let f=100;c&&(f=s/c);for(let u=0;u<c;++u){const i=r[u].key;o[i]=f}t.width=e}function Q(t,e,l){t.widths[e]&&(t.widths[e]=l)}function X(t,e,l){t.dataMap[e]&&t.dataMap[e].height!==l&&(t.dataMap[e].height=l)}function Z(t,e,l){t.dataMap[e]&&(t.dataMap[e].borderHeight=l)}function ee(t,e){t.rowHeight=e}function te(t,e){t.rowMinHeight=e}function le(t,e){t.rowDraggable=!!e}function ne(t,e,l){t.dataMap[e]&&(t.dataMap[e].expandHeight=l)}function ie(t,e){t.bodyScroll=e}function j(t,e){t.highlight=!!e}function z(t,e){t.virtual=!!e}function oe(t,e,l){t.dataMap[e]&&(t.dataMap[e].hover=l)}function ae(t,e){t.emptyText=e}function se(t,e){t.tooltipTheme=e}function re(t,e){t.tooltipWidth=e}function ce(t,e){t.singleSorter=!!e}function de(t,e){t.singleFilter=!!e}function ue(t,e){t.dragging=!!e}function fe(t,e,l){t.sorters[e]&&(t.singleSorter&&l&&L(t),t.sorters[e].type=l)}function L(t){const e=t.sorters;for(const l of Object.keys(e))e[l].type=null}function he(t,e,l){t.filters[e]&&(t.singleFilter&&(Array.isArray(l)?l.length:l)&&P(t),t.filters[e].active=l)}function P(t){const e=t.filters;for(const l of Object.keys(e)){e[l].active=null;for(const o of e[l].options)o.active=!1}}function ge(t,e,l,o){const{dataMap:a}=t,{disableCheckRows:r}=e;a[l]&&!r[l]&&(a[l].checked=!!o),x(t)}function be(t,e){const{rowData:l,checkedAll:o}=t,{disableCheckRows:a}=e;let r=!o;if(Object.keys(a).length){let s=!0;for(const c of l)if(!a[c.key]&&!c.checked){s=!1;break}r=!s}for(const s of l)a[s.key]||(s.checked=r);t.checkedAll=r,t.partial=!1,x(t)}function pe(t,e){const{rowData:l}=t,{disableCheckRows:o}=e;for(const a of l)o[a.key]||(a.checked=!1);t.checkedAll=!1,t.partial=!1,x(t)}function x(t){const e=t.rowData;let l=!1,o=!1,a=!1;for(let r=0,s=e.length;r<s;++r)if(e[r].checked?l=!0:o=!0,l&&o){a=!0;break}l&&!a?t.checkedAll=!0:t.checkedAll=!1,t.partial=a}function we(t,e,l,o){var u;const{startRow:a,endRow:r,heightBITree:s,virtualData:c}=t;if(l===a&&o===r)return;const{processedData:f}=e;if(c.length=0,f[0]){let h=f.length;for(;h--;){const i=f[h];i.hidden=!(h>=l&&h<o),!i.hidden&&c.push(i)}c.reverse(),t.padTop=(u=s==null?void 0:s.sum(l))!=null?u:0,t.startRow=l,t.endRow=o}}function me(t,e,l,o){const{dataMap:a}=t,{disableExpandRows:r}=e;a[l]&&!r[l]&&(a[l].expanded=!!o)}function ye(t,e){const{key:l,value:o,active:a=!1,disableOthers:r=!1}=e;if(t.filters[l]){const s=t.filters[l].options;if(r)for(let f=0,u=s.length;f<u;++f)s[f].active=!1;const c=s.find(f=>f.value===o);c&&(c.active=a)}}function ke(t){const e=t.rowData;for(let l=0,o=e.length;l<o;++l)e[l].index=l}function q(t){var r;const{heightBITree:e,currentPage:l,pageSize:o,rowData:a}=t;e?l&&o>0&&o<a.length?t.totalHeight=e.sum(l*o)-e.sum((l-1)*o):t.totalHeight=(r=e.sum())!=null?r:0:t.totalHeight=0}function xe(t=!1){const e=typeof t=="boolean"?{able:t}:t,{able:l=!1,type:o=null,order:a=0,method:r=null}=e;return{able:l,type:o,order:a,method:r}}function Re(t={able:!1,options:[]}){var c,f;const{able:e=!1,multiple:l=!1,active:o=null,method:a=null}=t,r=b.deepClone((c=t.options)!=null?c:[]),s=[];for(let u=0,h=r.length;u<h;++u){const i=r[u],d=typeof i=="string"?{value:i}:{...i};d.label=(f=d.label)!=null?f:d.value.toString();let p=!1;l&&Array.isArray(o)?p=o.includes(d.value):b.isNull(o)||(p=Object.is(d.value,o)),d.active=p,s.push(d)}return{able:e,options:s,multiple:l,active:o,method:a}}function ve(t,e,l){const o=Object.keys(t),a=[],r=[];for(let c=0,f=o.length;c<f;++c){const u=o[c],h=t[u],{able:i,active:d,method:p}=h;if(i&&d&&typeof p=="function"&&(a.push(h),l))break}const s=a.length;for(let c=0,f=e.length;c<f;++c){const u=e[c];let h=!0;for(let i=0;i<s;i++){const{active:d,method:p}=a[i];if(h=p(d,u.data),!h)break}h&&r.push(u)}return r}function Ce(t,e,l,o){const a=Object.keys(t),r=[];for(let s=0,c=a.length;s<c;++s){const f=a[s],{able:u,type:h,order:i,method:d}=t[f];if(u&&h){const p=l.find(w=>w.key===f),y=p==null?void 0:p.accessor;if(r.push({able:u,key:f,order:i,type:h,method:d!=null?d:void 0,accessor(w){return typeof y=="function"?y(w.data,w.index):w.data[f]}}),o)break}}return r.sort((s,c)=>s.order-c.order),b.sortByProps(e,r)}function De(t,e,l){return l.slice((t-1)*e,t*e)}return{state:n,getters:k,mutations:V}}exports.useStore=Me;
