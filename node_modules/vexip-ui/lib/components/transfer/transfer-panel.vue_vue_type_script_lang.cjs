"use strict";var n=require("vue");require("../checkbox/index.cjs");require("../collapse-transition/index.cjs");require("../icon/index.cjs");require("../input/index.cjs");require("../number-input/index.cjs");require("../renderer/index.cjs");require("../resize-observer/index.cjs");require("../virtual-list/index.cjs");var H=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var ne=require("@vexip-ui/hooks"),F=require("@vexip-ui/utils"),G=require("../checkbox/checkbox.cjs"),ue=require("../collapse/collapse-transition.cjs"),re=require("../icon/icon.cjs"),se=require("../input/input.cjs"),ie=require("../number-input/number-input.cjs"),oe=require("../renderer/renderer.cjs"),ce=require("../resize-observer/resize-observer.cjs"),fe=require("../virtual-list/virtual-list.cjs"),ve=require("../../common/config/src/props.cjs"),de=require("../../common/config/src/namespace.cjs"),pe=require("../../common/config/src/locale/index.cjs"),ge=n.defineComponent({name:"TransferPanel",components:{Checkbox:G,CollapseTransition:ue,Icon:re,Input:se,NumberInput:ie,Renderer:oe,ResizeObserver:ce,VirtualList:fe,Retweet:H.Retweet,ChevronRight:H.ChevronRight,ChevronLeft:H.ChevronLeft},props:{type:{type:String,default:null},state:{type:ve.stateProp,default:"default"},selected:{type:Set,default:()=>new Set},paged:{type:Boolean,default:!1},filter:{type:Function,default:null},disabled:{type:Boolean,default:!1},title:{type:String,default:""},options:{type:Array,default:()=>[]},emptyText:{type:String,default:"\u6682\u65E0\u6570\u636E"},optionHeight:{type:Number,default:32},deepState:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingIcon:{type:Object,default:null},loadingLock:{type:Boolean,default:!1},loadingSpin:{type:Boolean,default:!1}},emits:["update:selected","select","enter","switch"],setup(a,{slots:j,emit:k}){const c=de.useNameHelper("transfer"),K=pe.useLocale("transfer"),r=n.ref(new Set(a.selected)),d=n.ref(10),g=n.ref(1),p=n.ref(null),s=n.ref(-1),x=n.ref(""),U=n.ref(!1),_=n.ref(),B=n.ref(),J=n.ref(),Q=n.ref(),O=n.ref(),f=n.ref();let M=0,h=null,y=!1;const{target:W,modifier:T}=ne.useModifier({passive:!1,onKeyDown:(e,t)=>{if(t.up||t.down)!y&&s.value<0?(y=!0,h?s.value=a.options.findIndex(l=>l.value===h):f.value&&(s.value=Math.round(f.value.scrollOffset/a.optionHeight)),s.value=s.value===-1?0:s.value):s.value=F.boundRange(ee(s.value+(t.up?-1:1),t.up?-1:1),0,w.value.length-1),a.paged||te(s.value,t.up?"top":"bottom"),e.preventDefault();else if(a.paged&&(t.left||t.right)&&e.ctrlKey)V(g.value+(t.left?-1:1)),s.value=0,e.preventDefault();else if(a.type==="source"&&t.right||a.type==="target"&&t.left)y=!1,s.value=-1,h=null,k("switch"),e.preventDefault();else if(t.space){const l=w.value[s.value];l&&(r.value[r.value.has(l.value)?"delete":"add"](l.value),q()),e.preventDefault()}else t.enter?(e.preventDefault(),k("enter"),e.preventDefault()):typeof a.filter=="function"&&O.value&&t["ctrl+f"]&&(e.preventDefault(),e.stopPropagation(),O.value.focus(),e.preventDefault())}}),X=n.computed(()=>({[c.be("panel")]:!0,[c.bem("panel",a.state)]:a.state!=="default",[c.bem("panel","disabled")]:a.disabled})),o=n.computed(()=>{const e=a.filter,t=x.value;return e&&t?a.options.filter(l=>e(t,l)):a.options}),P=n.computed(()=>o.value.length),N=n.computed(()=>o.value.slice((g.value-1)*d.value,g.value*d.value)),w=n.computed(()=>a.paged?N.value:o.value),R=n.computed(()=>Math.ceil(P.value/(d.value||1)));n.watch(()=>a.selected,e=>{r.value=e}),n.watch(P,()=>{y=!1,s.value=-1,h=null});const C=n.ref(!1),m=n.ref(!1);n.watchEffect(()=>{const e=o.value,t=r.value;let l=!1,u=!1;for(let i=0,b=P.value;i<b;++i){const S=e[i];if(S.disabled||(t.has(S.value)?l=!0:u=!0),l&&u)break}m.value=l&&!u,C.value=!m.value&&t.size>0});function Y(){requestAnimationFrame(()=>{var t;const e=B.value||((t=f.value)==null?void 0:t.wrapper);if(e){const l=getComputedStyle(e),u=parseInt(l.paddingTop),i=parseInt(l.paddingBottom),b=e.offsetHeight-u-i;M=b,d.value=Math.floor(b/(a.optionHeight||1))}})}function z(e){if(!(a.disabled||e.disabled)){if(p.value&&T.shift){Z(p.value,e.value);return}r.value.has(e.value)?r.value.delete(e.value):r.value.add(e.value),y=!1,s.value=-1,h=e.value,p.value=e.value,q()}}function Z(e,t){var S;const l=o.value;let u=-1,i=-1;for(let v=0,I=l.length;v<I;++v){const E=l[v];if(E.value===e?u=v:E.value===t&&(i=v),u>0&&i>0)break}const b=r.value.has((S=l[u])==null?void 0:S.value)?"add":"delete";u>i&&([u,i]=[i,u]);for(let v=u;v<=i;++v){const I=l[v];I.disabled||r.value[b](I.value)}q()}function D(){if(!a.disabled){if(m.value)for(const e of o.value)!e.disabled&&r.value.delete(e.value);else for(const e of o.value)!e.disabled&&r.value.add(e.value);p.value=null,q()}}function L(){if(!a.disabled)if(C.value){const e=new Set(r.value);for(const t of o.value)t.disabled||(e.has(t.value)?r.value.delete(t.value):r.value.add(t.value));p.value=null,q()}else D()}function $(){p.value=null,T.resetAll()}function q(){k("update:selected",r.value),k("select")}function V(e){g.value=F.boundRange(e,1,R.value)}function A(e,t){var u;const l=w.value;for(t=t/Math.abs(t);(u=l[e])!=null&&u.disabled&&(e+=t,!(e<0||e>=l.length)););return e}function ee(e,t=1){var u;const l=w.value;return(u=l[e])!=null&&u.disabled&&(e=A(e,t),(t>0?e>=l.length:e<0)&&(e=A(e,-t),(t>0?e<0:e>=l.length)&&(e=-1))),e}function te(e,t){const l=a.options[e];if(!(a.paged||!l||!f.value))if(t==="bottom"){const u=(e+1)*a.optionHeight;f.value.scrollOffset+M<u&&f.value.scrollTo((e-d.value+1)*a.optionHeight)}else{const u=e*a.optionHeight;f.value.scrollOffset>u&&f.value.scrollTo(u)}}function le(){return{type:a.type,currentPage:g.value,pageSize:d.value,totalPages:R.value,allSelected:m.value,partial:C.value,selected:Array.from(r.value),options:o.value,toggleSelectAll:D,handleReverse:L}}function ae({option:e,index:t}){const l=a.disabled||e.disabled,u=i=>{i.preventDefault(),i.stopPropagation(),z(e)};return n.createVNode("li",{class:{[c.be("option")]:!0,[c.bem("option","disabled")]:l,[c.bem("option","hitting")]:s.value===t},role:"option","aria-disabled":l?"true":void 0,onClick:()=>z(e)},[j.option?j.option({type:a.type,option:e,index:t}):[n.createVNode(G,{class:c.be("checkbox"),state:a.deepState?a.state:void 0,checked:r.value.has(e.value),disabled:l,"tab-index":-1,onClick:u},null),n.createVNode("span",{class:c.be("label")},[j.label?j.label({option:e,index:t}):e.label])]])}return{MagnifyingGlass:H.MagnifyingGlass,nh:c,locale:K,currentSelected:r,pageSize:d,currentPage:g,currentMark:p,currentFilter:x,searching:U,className:X,visibleOptions:o,partial:C,allSelected:m,pagedOptions:N,totalPages:R,wrapper:W,header:_,body:B,footer:J,search:Q,input:O,list:f,computePageSize:Y,toggleSelect:z,toggleSelectAll:D,handleReverse:L,handlePageChange:V,handleBlur:$,getSlotPayload:le,renderOption:ae}}});module.exports=ge;
