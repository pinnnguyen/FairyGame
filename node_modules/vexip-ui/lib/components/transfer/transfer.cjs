"use strict";var t=require("vue"),N=require("./transfer-panel.cjs");require("../button/index.cjs");require("../icon/index.cjs");require("../form/index.cjs");var j=require("@vexip-ui/icons");require("../../common/config/src/index.cjs");var le=require("@vexip-ui/utils"),ce=require("./props.cjs"),F=require("../button/button.cjs"),ue=require("../form/helper.cjs"),T=require("../../common/config/src/props.cjs"),de=require("../../common/config/src/namespace.cjs"),se=require("../../common/config/src/locale/index.cjs"),A=require("../icon/icon.cjs");const pe={value:"value",label:"label",disabled:"disabled"};var ge=t.defineComponent({name:"Transfer",components:{Button:F,TransferPanel:N},props:ce.transferProps,emits:["update:value"],setup(B,{slots:a,emit:I,expose:M}){const{idFor:K,state:U,disabled:R,loading:D,validateField:G,getFieldValue:J,setFieldValue:Q}=ue.useFieldStore(()=>{var o,n;return(n=(o=m.value)==null?void 0:o.$el)==null?void 0:n.focus()}),e=T.useProps("transfer",B,{state:T.createStateProp(U),options:{default:()=>[],static:!0},value:{default:()=>J([]),static:!0},disabled:()=>R.value,paged:!1,filter:!1,emptyText:null,keyConfig:()=>({}),optionHeight:{default:32,validator:o=>o>0},ignoreCase:!1,sourceTitle:null,targetTitle:null,deepState:!1,loading:()=>D.value,loadingIcon:j.Spinner,loadingLock:!1,loadingSpin:!1}),c=de.useNameHelper("transfer"),v=se.useLocale("transfer"),d=t.ref(null),p=t.ref(new Set),g=t.ref(new Set),V=t.ref([]),k=t.ref([]),q=t.ref([]),m=t.ref(),w=t.ref(),W=t.computed(()=>({...pe,...e.keyConfig}));let b=new Map,s=e.value;const E=t.ref(0);t.watchEffect(()=>{e.keyConfig.value,e.keyConfig.label,e.keyConfig.disabled,e.options,E.value++}),t.watch(E,X,{immediate:!0}),t.watchEffect(()=>{if(!d.value.size){V.value=Array.from(q.value),k.value=[];return}const o=new Set(d.value),n=[],r=[];for(const i of q.value)o.has(i.value)?n.push(i):r.push(i);k.value=n,V.value=r});function X(){const{value:o,label:n,disabled:r}=W.value,i=b,u=new Map;e.options.forEach(l=>{var $,z;const S=typeof l=="string"?{[o]:l}:l,C=S[o];if(le.isNull(C))return;const ne=S[n]||String(C),{[r]:re=!1}=S,f=i.get(S.value),ie=t.reactive({disabled:re,value:C,label:ne,hidden:($=f==null?void 0:f.hidden)!=null?$:!1,hitting:(z=f==null?void 0:f.hitting)!=null?z:!1,data:l});u.set(C,ie)}),b=u,q.value=Array.from(u.values()),d.value=new Set(s)}const Y=t.computed(()=>[c.b(),c.bs("vars"),{[c.bm("inherit")]:e.inherit,[c.bm(e.state)]:e.state!=="default"}]),L=t.computed(()=>e.deepState&&e.state!=="default"?e.state:"primary"),Z=t.computed(()=>!!p.value.size),_=t.computed(()=>!!g.value.size),ee=t.computed(()=>e.ignoreCase?(o,n)=>String(n.value).toLocaleLowerCase().includes(o):(o,n)=>String(n.value).includes(o)),te=t.computed(()=>P("source")),ae=t.computed(()=>P("target"));t.watch(()=>e.value,o=>{s=o,d.value=new Set(s)}),M({handleToTarget:h,handleToSource:y,handlePanelFocus:x,handlePanelBlur:oe});function P(o){const n=e.filter;if(!!n)return typeof n=="function"?(r,i)=>n(r,i,o):ee.value}function H(){s=Array.from(d.value),Q(s),T.emitEvent(e.onChange,s),I("update:value",s),G()}function h(){for(const o of p.value)d.value.add(o);p.value.clear(),H()}function y(){for(const o of g.value)d.value.delete(o);g.value.clear(),H()}function O(o){const n={source:Array.from(p.value),target:Array.from(g.value)},r={source:n.source.map(i=>{var u,l;return(l=(u=b.get(i))==null?void 0:u.data)!=null?l:""}),target:n.target.map(i=>{var u,l;return(l=(u=b.get(i))==null?void 0:u.data)!=null?l:""})};T.emitEvent(e.onSelect,o,n,r)}function x(o){var n,r;o==="source"?(n=m.value)==null||n.$el.focus():(r=w.value)==null||r.$el.focus()}function oe(){var o,n;(o=m.value)==null||o.$el.blur(),(n=w.value)==null||n.$el.blur()}return()=>t.createVNode("div",{id:K.value,class:Y.value},[t.createVNode(N,{ref:m,selected:p.value,"onUpdate:selected":o=>p.value=o,type:"source",class:c.bem("panel","source"),state:e.state,paged:e.paged,filter:te.value,disabled:e.disabled,title:e.sourceTitle||v.value.source,options:V.value,"empty-text":e.emptyText||v.value.empty,"option-height":e.optionHeight,"ignore-case":e.ignoreCase,"deep-state":e.deepState,loading:e.loading,"loading-icon":e.loadingIcon,"loading-lock":e.loadingLock,"loading-spin":e.loadingSpin,onSelect:()=>O("source"),onEnter:h,onSwitch:()=>x("target")},{header:a["source-header"]||a.sourceHeader||a.header,title:a["source-title"]||a.sourceTitle||a.title,body:a["source-body"]||a.sourceBody||a.body,footer:a["source-footer"]||a.sourceFooter||a.footer,option:a["source-option"]||a.sourceOption||a.option}),t.createVNode("div",{class:c.be("actions")},[a.actions?a.actions({handleToTarget:h,handleToSource:y}):[t.createVNode(F,{inherit:!0,class:c.be("action"),type:L.value,size:"small",disabled:e.disabled||!Z.value,loading:e.loading&&e.loadingLock,"loading-icon":e.loadingIcon,"loading-spin":e.loadingSpin,style:{marginBottom:"6px"},onClick:h},{icon:()=>t.createVNode(A,{label:"to right"},{default:()=>[t.createVNode(j.ChevronRight,null,null)]})}),t.createVNode(F,{inherit:!0,class:c.be("action"),type:L.value,size:"small",disabled:e.disabled||!_.value,loading:e.loading&&e.loadingLock,"loading-icon":e.loadingIcon,"loading-spin":e.loadingSpin,style:{margin:"0"},onClick:y},{icon:()=>t.createVNode(A,{label:"to left"},{default:()=>[t.createVNode(j.ChevronLeft,null,null)]})})]]),t.createVNode(N,{ref:w,selected:g.value,"onUpdate:selected":o=>g.value=o,type:"target",class:c.bem("panel","target"),state:e.state,paged:e.paged,filter:ae.value,disabled:e.disabled,title:e.targetTitle||v.value.target,options:k.value,"empty-text":e.emptyText||v.value.empty,"option-height":e.optionHeight,"ignore-case":e.ignoreCase,"deep-state":e.deepState,loading:e.loading,"loading-icon":e.loadingIcon,"loading-lock":e.loadingLock,"loading-spin":e.loadingSpin,onSelect:()=>O("target"),onEnter:y,onSwitch:()=>x("source")},{header:a["target-header"]||a.targetHeader||a.header,title:a["target-title"]||a.targetTitle||a.title,body:a["target-body"]||a.targetBody||a.body,footer:a["target-footer"]||a.targetFooter||a.footer,option:a["target-option"]||a.targetOption||a.option})])}});module.exports=ge;
