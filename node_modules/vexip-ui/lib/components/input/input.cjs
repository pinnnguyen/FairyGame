"use strict";var a=require("vue");require("../icon/index.cjs");require("../form/index.cjs");var he=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var s=require("@vexip-ui/utils"),b=require("@vexip-ui/icons"),ge=require("./props.cjs"),d=require("../icon/icon.cjs"),xe=require("../form/helper.cjs"),l=require("../../common/config/src/props.cjs"),ye=require("../../common/config/src/namespace.cjs"),Ce=require("../../common/config/src/locale/index.cjs");function Ve(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!a.isVNode(i)}const Ne=Object.freeze(["text","password","date","datetime","time"]);function N(i){return s.isNull(i)?"":String(i)}var ke=a.defineComponent({name:"Input",components:{Icon:d},props:ge.inputProps,emits:["update:value"],setup(i,{slots:r,emit:h,expose:I}){const{idFor:K,state:z,disabled:A,loading:$,size:H,validateField:g,clearField:T,getFieldValue:B,setFieldValue:O}=xe.useFieldStore(()=>{var n;return(n=c.value)==null?void 0:n.focus()}),e=l.useProps("input",i,{size:l.createSizeProp(H),state:l.createStateProp(z),type:{default:"text",validator:n=>Ne.includes(n)},prefix:null,prefixColor:"",suffix:null,suffixColor:"",formatter:{default:null,isFunc:!0},value:{default:()=>B(""),static:!0},placeholder:null,autofocus:!1,spellcheck:!1,autocomplete:!1,readonly:!1,disabled:()=>A.value,inputClass:"",debounce:!1,maxLength:0,before:"",after:"",plainPassword:!1,clearable:!1,loading:()=>$.value,loadingIcon:b.Spinner,loadingLock:!1,loadingSpin:!1,transparent:!1,sync:!1}),k=N(e.value),o=ye.useNameHelper("input"),f=a.ref(!1),u=a.ref(k),m=a.ref(!1),x=a.ref(k.length),w=a.ref(!1),S=a.ref(!1),c=a.ref(),{wrapper:D,isHover:M}=he.useHover(),R=Ce.useLocale("input");let y=e.value;const p=a.computed(()=>!!(r.before||r.beforeAction||r["before-action"]||e.before)),v=a.computed(()=>!!(r.after||r.afterAction||r["after-action"]||e.after)),E=a.computed(()=>({[o.bs("wrapper")]:!0,[o.bs("vars")]:!0,[o.bm("inherit")]:e.inherit,[o.bm(e.size)]:e.size!=="default"})),U=a.computed(()=>[o.b(),o.bm(e.type),!p.value&&!v.value&&E.value,{[o.bm("focused")]:f.value,[o.bm("disabled")]:e.disabled,[o.bm("loading")]:e.loading&&e.loadingLock,[o.bm(e.state)]:e.state!=="default",[o.bm("before")]:r.beforeAction||r["before-action"],[o.bm("after")]:r.afterAction||r["after-action"],[o.bm("loading")]:e.loading,[o.bm("transparent")]:e.transparent}]),_=a.computed(()=>({...E.value,[o.bm(`wrapper--${e.size}`)]:e.size!=="default",[o.bs("wrapper--before-only")]:p.value&&!v.value,[o.bs("wrapper--after-only")]:!p.value&&v.value,[o.bm("transparent")]:e.transparent})),X=a.computed(()=>!!(r.prefix||e.prefix)),G=a.computed(()=>!!(r.suffix||e.suffix)),J=a.computed(()=>{const n=e.type;return n==="password"?m.value?"text":"password":n==="datetime"?"datetime-local":n}),Q=a.computed(()=>typeof e.formatter=="function"?N(e.formatter(u.value)):u.value),W=a.computed(()=>m.value?b.EyeR:b.EyeSlashR),Y=a.computed(()=>!(s.isNull(u.value)||u.value==="")),Z=a.computed(()=>e.loading&&e.loadingLock||e.readonly),C=a.computed(()=>!e.disabled&&e.clearable&&Y.value&&M.value);a.watch(()=>e.value,n=>{u.value=N(n),q(),y=u.value}),I({input:c,focus:()=>{var n;(n=c.value)==null||n.focus()},blur:()=>{var n;(n=c.value)==null||n.blur()}});function ee(n){f.value||(f.value=!0,l.emitEvent(e.onFocus,n))}function ne(n){f.value&&(f.value=!1,setTimeout(()=>{f.value||(l.emitEvent(e.onBlur,n),j("change"))},120))}function V(n){const t=n.type;u.value=n.target.value,q();const be=u.value;P(be,t)}function P(n,t){u.value=n,j(t)}function j(n){n=n==="input"?"input":"change";const t=typeof e.value=="number"?parseFloat(u.value):u.value;if(n==="change"){if(y===t)return;y=t,O(t),l.emitEvent(e.onChange,t),e.sync||(h("update:value",t),g())}else l.emitEvent(e.onInput,t),e.sync&&(h("update:value",t),g())}function q(){let n=u.value;if(s.isNull(n)){x.value=0;return}const t=e.maxLength;t&&n.length>t&&(n=n.slice(0,t)),x.value=n.length,u.value=n}function ae(){var n;e.disabled||(m.value=!m.value,(n=c.value)==null||n.focus())}function oe(n){n.stopPropagation(),P("","change"),e.sync&&(h("update:value",u.value),g()),l.emitEvent(e.onClear),a.nextTick(T)}function re(){l.emitEvent(e.onEnter)}function te(n){l.emitEvent(e.onPrefixClick,n)}function ue(n){l.emitEvent(e.onSuffixClick,n)}function le(n){l.emitEvent(e.onKeyDown,n)}function ie(n){l.emitEvent(e.onKeyPress,n)}function ce(n){n.key==="Enter"&&re(),l.emitEvent(e.onKeyUp,n)}const se=e.debounce?s.debounce(V):s.throttle(V);function fe(){return a.createVNode("div",{class:[o.be("icon"),o.be("prefix")],style:{color:e.prefixColor},onClick:te},[r.prefix?r.prefix():a.createVNode(d,{icon:e.prefix},null)])}function de(){return G.value?a.createVNode("div",{key:"suffix",class:[o.be("icon"),o.be("suffix")],style:{color:e.suffixColor,opacity:C.value||e.loading?"0%":""},onClick:ue},[r.suffix?r.suffix():a.createVNode(d,{icon:e.suffix},null)]):e.type==="password"&&e.plainPassword?a.createVNode("div",{key:"password",class:[o.be("icon"),o.be("password")],style:{color:e.suffixColor,opacity:C.value||e.loading?"0%":""},onClick:ae},[a.createVNode(d,{icon:W.value},null)]):e.clearable||e.loading?a.createVNode("div",{key:"placeholder",class:[o.be("icon"),o.bem("icon","placeholder")]},null):null}function pe(){return C.value?a.createVNode("div",{key:"clear",class:[o.be("icon"),o.be("clear")],onClick:oe},[a.createVNode(d,{icon:b.CircleXmark},null)]):e.loading?a.createVNode("div",{key:"loading",class:[o.be("icon"),o.be("loading")]},[a.createVNode(d,{spin:e.loadingSpin,pulse:!e.loadingSpin,icon:e.loadingIcon},null)]):null}function ve(){let n;return a.createVNode("div",{class:o.be("suffix-wrapper")},[de(),a.createVNode(a.Transition,{name:o.ns("fade"),appear:!0},Ve(n=pe())?n:{default:()=>[n]})])}function me(){return a.createVNode("div",{class:o.be("count")},[r.count?r.count({value:u.value}):`${x.value}/${e.maxLength}`])}function L(){var n;return a.createVNode("div",{id:K.value,ref:D,class:U.value,onClick:()=>{var t;return(t=c.value)==null?void 0:t.focus()}},[X.value&&fe(),a.createVNode("input",{ref:c,class:[o.be("control"),e.inputClass],type:J.value,value:Q.value,autofocus:e.autofocus,autocomplete:e.autocomplete?"on":"off",spellcheck:e.spellcheck,disabled:e.disabled,readonly:Z.value,placeholder:(n=e.placeholder)!=null?n:R.value.placeholder,maxlength:e.maxLength>0?e.maxLength:void 0,onBlur:ne,onFocus:ee,onInput:se,onChange:V,onKeypress:ie,onKeydown:le,onKeyup:ce},null),ve(),e.maxLength>0?me():null])}function F(n){const t=r[`${n}Action`]||r[`${n}-action`];return t?a.createVNode("div",{class:[o.be(n),o.bem(n,"action")],onMouseenter:()=>(n==="before"?w:S).value=!0,onMouseleave:()=>(n==="before"?w:S).value=!1},[t()]):a.createVNode("div",{class:o.be(n)},[r[n]?r[n]():e[n]])}return()=>p.value||v.value?a.createVNode("div",{class:_.value},[p.value&&F("before"),L(),v.value&&F("after")]):L()},methods:{focus:s.noop,blur:s.noop}});module.exports=ke;
