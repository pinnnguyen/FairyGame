"use strict";var e=require("vue"),W=require("./slider-trigger.cjs");require("../form/index.cjs");require("../../common/config/src/index.cjs");var x=require("@vexip-ui/hooks"),_=require("@vexip-ui/utils"),ee=require("./props.cjs"),re=require("../../_virtual/plugin-vue_export-helper.cjs"),te=require("../form/helper.cjs"),E=require("../../common/config/src/props.cjs"),ae=require("../../common/config/src/namespace.cjs");const le=e.defineComponent({name:"Slider",components:{SliderTrigger:W},props:ee.sliderProps,emits:["update:value"],setup(a,{emit:g}){const{idFor:V,state:B,disabled:P,loading:C,validateField:k,getFieldValue:s,setFieldValue:o}=te.useFieldStore(()=>{var r;return(r=y.value||S.value)==null?void 0:r.focus()}),l=E.useProps("slider",a,{state:E.createStateProp(B),value:{default:()=>s(0),static:!0},min:0,max:100,step:{default:1,validator:r=>r>0&&Math.ceil(r)===r},vertical:!1,hideTip:!1,tipTransfer:null,disabled:()=>P.value,loading:()=>C.value,loadingLock:!1,reverse:!1,range:!1,markers:()=>({}),markerOnly:!1}),d=ae.useNameHelper("slider"),v=e.ref([0,0]),f=e.ref([!1,!1]),c=e.ref(1),{timer:z}=x.useSetTimeout(),M=e.ref(),y=e.ref(),S=e.ref(),$=e.computed(()=>Object.keys(l.markers).map(parseFloat).filter(r=>!Number.isNaN(r)&&r>=0&&r<=100)),L=e.computed(()=>({[d.b()]:!0,[d.bs("vars")]:!0,[d.bm("inherit")]:l.inherit,[d.bm(l.state)]:l.state!=="default",[d.bm("vertical")]:l.vertical,[d.bm("sliding")]:f.value[1]||f.value[0],[d.bm("disabled")]:l.disabled,[d.bm("loading")]:l.loading&&l.loadingLock,[d.bm("reverse")]:l.reverse,[d.bm("with-marker")]:$.value.length})),m=e.computed(()=>Math.round(Math.min(l.min,l.max)/l.step)),q=e.computed(()=>Math.round(Math.max(l.min,l.max)/l.step)),N=e.computed(()=>[Math.round(v.value[0]*l.step),Math.round(v.value[1]*l.step)]),h=e.computed(()=>q.value-m.value||1),i=e.computed(()=>[(v.value[0]-m.value)/h.value*100,(v.value[1]-m.value)/h.value*100]),I=e.computed(()=>{const{vertical:r,reverse:t}=l,n=l.range?Math.min(i.value[0],i.value[1]):0;return{transform:`
          translate${r?"Y":"X"}(${t?"-":""}${n}%)
          translateZ(0)
          scale${r?"Y":"X"}(${Math.abs(i.value[0]-i.value[1])/100})
        `,transformOrigin:`${r?50:t?100:0}% ${r?t?100:0:50}%`}}),X=e.computed(()=>{const{vertical:r,reverse:t}=l;return{[t?"bottom":"top"]:r?`${i.value[0]}%`:"50%",[t?"right":"left"]:r?"50%":`${i.value[0]}%`,zIndex:c.value===0?1:void 0,transform:`translate(${t?"":"-"}50%, ${t?"":"-"}50%)`}}),Y=e.computed(()=>{const{vertical:r,reverse:t}=l;return{[t?"bottom":"top"]:r?`${i.value[1]}%`:"50%",[t?"right":"left"]:r?"50%":`${i.value[1]}%`,zIndex:c.value===1?1:void 0,transform:`translate(${t?"":"-"}50%, ${t?"":"-"}50%)`}});D(l.value),T(),e.watch(()=>l.value,r=>{D(r),T()});function D(r){if(l.range){const t=Array.isArray(r)?r:[r,100];v.value=[t[0]/l.step,t[1]/l.step]}else v.value=[m.value,(Array.isArray(r)?r[0]:r)/l.step]}function T(){v.value=v.value.map(r=>{let t=Math.max(m.value,Math.min(q.value,Math.round(r)));if(l.markerOnly&&$.value.length){let n=100,u=0;for(const b of $.value){const j=Math.abs((t-m.value)/h.value*100-b);n>j&&(n=j,u=b)}t=u/100*h.value+m.value}return t})}function O(){const[r,t]=N.value,n=l.range?r>t?[t,r]:[r,t]:t;o(n),E.emitEvent(l.onChange,n),g("update:value",n),k()}let p=null;function F(r){if(!p)return;const t=l.vertical,n=l.reverse,u=t?r.clientY:r.clientX;v.value[c.value]=(n?-1:1)*((u-p[t?n?"bottom":"top":n?"right":"left"])/p[t?"height":"width"])*h.value+m.value}let w;function H(r,t){return Array.isArray(r)&&Array.isArray(t)?r[0]===t[0]&&r[1]===t[1]:r===t}const Z=_.throttle(r=>{if(!p||l.disabled)return;r.preventDefault(),F(r),T(),y.value&&y.value.updateTooltip(),S.value&&S.value.updateTooltip();const[t,n]=N.value,u=l.range?t>n?[n,t]:[t,n]:n;H(w,u)||(w=u,E.emitEvent(l.onInput,u))});function G(r){if(!(!M.value||l.disabled||l.loading&&l.loadingLock)){if(clearTimeout(z.sliding),r.stopPropagation(),r.preventDefault(),p=M.value.getBoundingClientRect(),l.range){const{vertical:t,reverse:n}=l,u=t?r.clientY:r.clientX,b=(n?p[t?"bottom":"right"]-u:u-p[t?"top":"left"])/p[t?"height":"width"]*100;c.value=Math.abs(b-i.value[0])<Math.abs(b-i.value[1])?0:1}else c.value=1;f.value[c.value]=!0,F(r),T(),document.addEventListener("pointermove",A),document.addEventListener("pointerup",R)}}function A(r){Z(r)}function R(){p=null,document.removeEventListener("pointermove",A),document.removeEventListener("pointerup",R),O(),z.sliding=setTimeout(()=>{f.value[c.value]=!1},250)}function J(r){r.cancelable&&(r.stopPropagation(),r.preventDefault())}function K(r){const{vertical:t,reverse:n}=l;return{[n?"bottom":"top"]:t?`${r}%`:"50%",[n?"right":"left"]:t?"50%":`${r}%`,transform:`translate(${n?"":"-"}50%, ${n?"":"-"}50%)`}}function Q(r){const{vertical:t,reverse:n}=l;return{[n?"bottom":"top"]:t?`${r}%`:void 0,[n?"right":"left"]:t?void 0:`${r}%`,transform:`translate${t?"Y":"X"}(${n?"":"-"}50%)`}}function U(r){const t=parseFloat(r);if(Number.isNaN(t))return!1;if(l.range){const n=Math.min(i.value[0],i.value[1]),u=Math.max(i.value[0],i.value[1]);return t>=n&&t<=u}else return t<=i.value[1]}return{props:l,nh:d,idFor:V,sliding:f,markerPercent:$,className:L,truthValue:N,fillerStyle:I,startTriggerStyle:X,endTriggerStyle:Y,track:M,startTrigger:y,endTrigger:S,handleTrackDown:G,disableEvent:J,getPointStyle:K,getMarkerStyle:Q,isPercentInRange:U}}}),ne=["id"];function se(a,g,V,B,P,C){const k=e.resolveComponent("SliderTrigger");return e.openBlock(),e.createElementBlock("div",{id:a.idFor,class:e.normalizeClass(a.className),tabindex:"-1",onPointerdown:g[0]||(g[0]=(...s)=>a.handleTrackDown&&a.handleTrackDown(...s)),onTouchstart:g[1]||(g[1]=(...s)=>a.disableEvent&&a.disableEvent(...s))},[e.createElementVNode("div",{ref:"track",class:e.normalizeClass(a.nh.be("track"))},[e.createElementVNode("div",{class:e.normalizeClass(a.nh.be("filler")),style:e.normalizeStyle(a.fillerStyle)},null,6)],2),a.markerPercent.length?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("div",{class:e.normalizeClass(a.nh.be("points"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.props.markers,(s,o)=>(e.openBlock(),e.createElementBlock("div",{key:o,class:e.normalizeClass([a.nh.be("point"),a.isPercentInRange(o)&&a.nh.bem("point","in-range")]),style:e.normalizeStyle(a.getPointStyle(o))},null,6))),128))],2),e.createElementVNode("div",{class:e.normalizeClass(a.nh.be("markers"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.props.markers,(s,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:o},[typeof s=="string"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(a.nh.be("marker")),style:e.normalizeStyle(a.getMarkerStyle(o))},[e.renderSlot(a.$slots,"marker",{marker:{label:s},percent:o,inRange:a.isPercentInRange(o)},()=>[e.createTextVNode(e.toDisplayString(s),1)])],6)):(e.openBlock(),e.createElementBlock("div",e.mergeProps({key:1,class:[a.nh.be("marker"),s.class],style:[a.getMarkerStyle(o),s.style]},s.attrs),[e.renderSlot(a.$slots,"marker",{marker:s,percent:o,inRange:a.isPercentInRange(o)},()=>[e.createTextVNode(e.toDisplayString(s.label),1)])],16))],64))),128))],2)],64)):e.createCommentVNode("",!0),a.props.range?(e.openBlock(),e.createBlock(k,{key:1,ref:"startTrigger",value:a.truthValue[0],"tip-transfer":a.props.tipTransfer,"hide-tip":a.props.hideTip,vertical:a.props.vertical,min:a.props.min,max:a.props.max,disabled:a.props.disabled,loading:a.props.loading,reverse:a.props.reverse,sliding:a.sliding[0],style:e.normalizeStyle(a.startTriggerStyle)},{tip:e.withCtx(({value:s})=>[e.renderSlot(a.$slots,"tip",{value:s},()=>[e.createTextVNode(e.toDisplayString(s),1)])]),_:3},8,["value","tip-transfer","hide-tip","vertical","min","max","disabled","loading","reverse","sliding","style"])):e.createCommentVNode("",!0),e.createVNode(k,{ref:"endTrigger",value:a.truthValue[1],"tip-transfer":a.props.tipTransfer,"hide-tip":a.props.hideTip,vertical:a.props.vertical,min:a.props.min,max:a.props.max,disabled:a.props.disabled,loading:a.props.loading,reverse:a.props.reverse,sliding:a.sliding[1],style:e.normalizeStyle(a.endTriggerStyle)},{tip:e.withCtx(({value:s})=>[e.renderSlot(a.$slots,"tip",{value:s},()=>[e.createTextVNode(e.toDisplayString(s),1)])]),_:3},8,["value","tip-transfer","hide-tip","vertical","min","max","disabled","loading","reverse","sliding","style"])],42,ne)}var ie=re(le,[["render",se]]);module.exports=ie;
