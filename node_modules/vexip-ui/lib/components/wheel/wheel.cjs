"use strict";var l=require("vue"),re=require("./wheel-item.cjs");require("../icon/index.cjs");require("../scroll/index.cjs");require("../form/index.cjs");var P=require("@vexip-ui/hooks");require("../../common/config/src/index.cjs");var m=require("@vexip-ui/utils"),C=require("@vexip-ui/icons"),ae=require("./props.cjs"),oe=require("./symbol.cjs"),ne=require("../../_virtual/plugin-vue_export-helper.cjs"),te=require("../icon/icon.cjs"),se=require("../scroll/scroll.cjs"),ie=require("../form/helper.cjs"),z=require("../../common/config/src/props.cjs"),ue=require("../../common/config/src/namespace.cjs");const de=l.defineComponent({name:"Wheel",components:{WheelItem:re,Icon:te,Scroll:se},props:ae.wheelProps,emits:["update:value"],setup(r,{emit:v}){const{idFor:W,state:j,disabled:B,loading:$,validateField:w,getFieldValue:I,setFieldValue:N}=ie.useFieldStore(()=>{var e;return(e=q.value)==null?void 0:e.focus()}),a=z.useProps("wheel",r,{state:z.createStateProp(j),horizontal:!1,value:{default:()=>I(null),static:!0},candidate:{default:2,validator:e=>[0,1,2,3].includes(e)},arrow:!1,pointer:m.USE_TOUCH,options:{default:()=>[],static:!0},insertEmpty:!1,disabled:()=>B.value,loading:()=>$.value,loadingLock:!1,disabledItem:{default:m.toFalse,isFunc:!0}}),u=ue.useNameHelper("wheel"),k=l.ref(new Set),n=l.ref(0),T=l.ref(0),D=l.ref(0),d=l.ref(0),c=l.ref(0),p=l.ref(0),h=l.ref(0),F=l.ref(!1),q=P.useDisplay(Z),f=l.ref();P.useModifier({target:q,passive:!1,onKeyDown:(e,o)=>{(o.up||o.down)&&(e.preventDefault(),o.up?M():L())}});const R=l.computed(()=>{const e=a.options.map(o=>{if(typeof o=="object"){const{value:i,label:t,disabled:le=!1}=o;return{value:i,label:t||String(i),disabled:le,meta:o}}return{value:o,label:String(o),disabled:!1,meta:o}});return a.insertEmpty&&e.unshift({value:"",label:typeof a.insertEmpty=="string"?a.insertEmpty:"-",disabled:!1,meta:""}),e}),s=l.computed(()=>Array.from(k.value)),O=l.computed(()=>[u.b(),u.bs("vars"),u.bm(a.horizontal?"horizontal":"vertical"),{[u.bm("inherit")]:a.inherit,[u.bm(a.state)]:a.state!=="default",[u.bm("disabled")]:a.disabled,[u.bm("loading")]:a.loading&&a.loadingLock}]),U=l.computed(()=>a.horizontal?{paddingRight:`${p.value}px`,paddingLeft:`${p.value}px`}:{paddingTop:`${h.value}px`,paddingBottom:`${h.value}px`}),K=l.computed(()=>a.horizontal?{width:p.value?`${p.value}px`:void 0}:{height:h.value?`${h.value}px`:void 0}),X=l.computed(()=>{const e={inset:a.horizontal?`0 ${p.value-1}px`:`${h.value-1}px 0`};return a.horizontal?(e.borderTop="0",e.borderBottom="0"):(e.borderRight="0",e.borderLeft="0"),e}),A=l.computed(()=>a.disabled||!s.value.slice(0,n.value).some(e=>!E(e))),V=l.computed(()=>a.disabled||n.value>=s.value.length-1||!s.value.slice(n.value+1,s.value.length).some(e=>!E(e))),Y=l.computed(()=>a.horizontal?C.AngleLeft:C.AngleUp),G=l.computed(()=>a.horizontal?C.AngleRight:C.AngleDown);l.provide(oe.WHEEL_STATE,{increaseItem:J,decreaseItem:Q});const S=m.debounceMinor(()=>{const e=Math.max(s.value.findIndex(o=>o.value===a.value),0);n.value=y(e)}),b=m.debounceMinor(()=>{l.nextTick(()=>{const e=a.horizontal;s.value.forEach(t=>{t&&t.el&&(d.value=Math.max(d.value,t.el.offsetWidth),c.value=Math.max(c.value,t.el.offsetHeight))});const o=a.candidate,i=2*o+1;T.value=i*d.value,D.value=i*c.value,p.value=o*d.value,h.value=o*c.value,k.value.forEach(t=>{e?t.width=d.value:t.height=c.value}),setTimeout(()=>{var t;(t=f.value)==null||t.refresh()},0)})}),g=m.debounce(()=>{if(f.value){let e=0,o=0;a.horizontal?e=n.value*d.value:o=n.value*c.value,l.nextTick(()=>{var i;(i=f.value)==null||i.scrollTo(e,o)})}},20);l.watch(()=>a.value,()=>{S(),g()},{immediate:!0}),l.watch(()=>a.horizontal,b),l.watch(n,()=>{g();const e=s.value[n.value],o=e==null?void 0:e.value;N(o),z.emitEvent(a.onChange,o,e==null?void 0:e.meta),v("update:value",o),w()}),l.watch(()=>a.candidate,b);function E(e){return e.disabled||a.disabledItem(e.value,e.meta)}function H(e,o){for(o=o/Math.abs(o);s.value[e].disabled&&(e+=o,!(e<0||e>=s.value.length)););return e}function y(e,o=1){return s.value[e]&&E(s.value[e])&&(e=H(e,1*o),(o>0?e>=s.value.length:e<0)&&(e=H(m.boundRange(e,0,s.value.length-1),-1*o),(o>0?e<0:e>=s.value.length)&&(e=0))),e}function J(e){k.value.add(e),b(),S()}function Q(e){k.value.delete(e),b(),S()}function Z(){var e;b(),(e=f.value)==null||e.refresh(),l.nextTick(()=>{F.value=!0,S(),g()})}function x({signX:e,signY:o}){if(a.disabled||a.loading&&a.loadingLock)return!1;const i=a.horizontal?e:o;return!(i<0&&A.value||i>0&&V.value)}function _({clientX:e,clientY:o}){const i=a.horizontal?e/d.value:o/c.value,t=Math.round(i);t!==n.value?n.value=y(t,t>i?1:-1):g()}function ee({sign:e,clientX:o,clientY:i}){const t=a.horizontal?Math.round(o/d.value):Math.round(i/c.value);n.value=y(t,e)}function M(){if(!A.value){n.value=y(n.value-1,-1);const e=s.value[n.value];z.emitEvent(a.onPrev,e==null?void 0:e.value,e==null?void 0:e.meta)}}function L(){if(!V.value){n.value=y(n.value+1,1);const e=s.value[n.value];z.emitEvent(a.onNext,e==null?void 0:e.value,e==null?void 0:e.meta)}}return{props:a,nh:u,idFor:W,currentActive:n,isInit:F,targetWidth:d,targetHeight:c,wrapperWidth:T,wrapperHeight:D,normalizedOptions:R,itemList:s,className:O,listStyle:U,maskStyle:K,borderStyle:X,prevDisabled:A,nextDisabled:V,prevIcon:Y,nextIcon:G,wrapper:q,scroll:f,isItemDisbaled:E,beforeScroll:x,handleWheel:ee,handleScrollEnd:_,handlePrev:M,handleNext:L,refreshScroll:g}}}),ce=["id"];function ve(r,v,W,j,B,$){const w=l.resolveComponent("Icon"),I=l.resolveComponent("WheelItem"),N=l.resolveComponent("Scroll");return l.openBlock(),l.createElementBlock("div",{id:r.idFor,ref:"wrapper",class:l.normalizeClass(r.className),tabindex:"0"},[r.props.arrow?(l.openBlock(),l.createElementBlock("div",{key:0,ref:"prevArrow",class:l.normalizeClass([r.nh.be("arrow"),r.nh.bem("arrow","prev"),r.prevDisabled?r.nh.bem("arrow","disabled"):""]),onClick:v[0]||(v[0]=(...a)=>r.handlePrev&&r.handlePrev(...a))},[l.createVNode(w,{icon:r.prevIcon},null,8,["icon"])],2)):l.createCommentVNode("",!0),l.createElementVNode("div",{class:l.normalizeClass(r.nh.be("scroll"))},[l.createVNode(N,{ref:"scroll",inherit:"","scroll-x":r.props.horizontal?r.targetWidth*r.currentActive:0,"scroll-y":r.props.horizontal?0:r.targetHeight*r.currentActive,width:r.props.horizontal?r.wrapperWidth:"100%",height:r.props.horizontal?"100%":r.wrapperHeight,pointer:r.props.pointer,mode:r.props.horizontal?"horizontal":"vertical","delta-x":r.targetWidth,"delta-y":r.targetHeight,"on-before-scroll":r.beforeScroll,onWheel:r.handleWheel,onScrollEnd:r.handleScrollEnd},{default:l.withCtx(()=>[l.createElementVNode("ul",{ref:"list",class:l.normalizeClass(r.nh.be("list")),style:l.normalizeStyle(r.listStyle)},[r.isInit?(l.openBlock(!0),l.createElementBlock(l.Fragment,{key:0},l.renderList(r.normalizedOptions,(a,u)=>(l.openBlock(),l.createBlock(I,{key:u,value:a.value,disabled:a.disabled||r.props.disabledItem(a.value,a),active:r.currentActive===u,meta:a.meta},{default:l.withCtx(()=>[l.renderSlot(r.$slots,"default",{option:a,index:u},()=>[l.createTextVNode(l.toDisplayString(a.label),1)])]),_:2},1032,["value","disabled","active","meta"]))),128)):l.createCommentVNode("",!0)],6)]),_:3},8,["scroll-x","scroll-y","width","height","pointer","mode","delta-x","delta-y","on-before-scroll","onWheel","onScrollEnd"]),r.props.candidate?(l.openBlock(),l.createElementBlock(l.Fragment,{key:0},[l.createElementVNode("div",{class:l.normalizeClass([r.nh.be("mask"),r.nh.bem("mask","top")]),style:l.normalizeStyle(r.maskStyle)},null,6),l.createElementVNode("div",{class:l.normalizeClass([r.nh.be("mask"),r.nh.bem("mask","bottom")]),style:l.normalizeStyle(r.maskStyle)},null,6)],64)):l.createCommentVNode("",!0),l.createElementVNode("div",{class:l.normalizeClass({[r.nh.be("border")]:!0,[r.nh.bem("border","active")]:r.props.loading,[r.nh.bem("border","vertical")]:r.props.horizontal}),style:l.normalizeStyle(r.borderStyle)},null,6)],2),r.props.arrow?(l.openBlock(),l.createElementBlock("div",{key:1,ref:"nextArrow",class:l.normalizeClass([r.nh.be("arrow"),r.nh.bem("arrow","next"),r.nextDisabled?r.nh.bem("arrow","disabled"):""]),onClick:v[1]||(v[1]=(...a)=>r.handleNext&&r.handleNext(...a))},[l.createVNode(w,{icon:r.nextIcon},null,8,["icon"])],2)):l.createCommentVNode("",!0)],10,ce)}var pe=ne(de,[["render",ve]]);module.exports=pe;
